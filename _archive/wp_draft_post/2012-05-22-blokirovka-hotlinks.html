---
layout: post
status: publish
published: true
title: Блокировка хотлинков
author:
  display_name: SlowProg
  login: seoadmin
  email: paperplanesu@rambler.ru
  url: http://paperplane.su
author_login: seoadmin
author_email: paperplanesu@rambler.ru
author_url: http://paperplane.su
wordpress_id: 2440
wordpress_url: http://paperplane.su/?p=2440
date: '2012-05-22 17:23:15 +0400'
date_gmt: '2012-05-22 13:23:15 +0400'
categories:
- Мастерская
tags:
- apache
- снижение нагрузки
- ".htaccess"
- nginx
comments:
- id: 47501
  author: Александр
  author_email: pritsas878@gmail.com
  author_url: http://1-infobiznes.ru
  date: '2012-05-22 20:21:16 +0400'
  date_gmt: '2012-05-22 16:21:16 +0400'
  content: Спасибо, но с каким расширением должен быть файл .htaccess!
- id: 47502
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-05-22 20:25:37 +0400'
  date_gmt: '2012-05-22 16:25:37 +0400'
  content: Ни с каким. Название файла такое и должно быть ".htaccess" и вначале всегда
    точка.
- id: 48460
  author: OlegZen
  author_email: osadoleg@gmail.com
  author_url: http://art-pro100.ru/
  date: '2012-05-29 13:24:25 +0400'
  date_gmt: '2012-05-29 09:24:25 +0400'
  content: "сайты \"ленивого говно-веб-мастера\" исключать необходимо, а если картинки
    с Водяными Знаками, так благодаря поисковикам больше посетителей\r\n\r\nсейчас
    попробую в папку с изображениями файл \".htaccess\"добавить, в корне сайта как-то
    код не работал..."
- id: 48564
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-05-30 19:40:30 +0400'
  date_gmt: '2012-05-30 15:40:30 +0400'
  content: Можно с большим логотипом своим пихнуть =) В том и соль, что пихнуть вместо
    картинки можно что угодно =) Класс! =D
- id: 48565
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-05-30 19:40:59 +0400'
  date_gmt: '2012-05-30 15:40:59 +0400'
  content: Кстати все заработало? Или есть проблемы?
- id: 68213
  author: Евгений Комиссаров
  author_email: komisar0v@yandex.ru
  author_url: http://arttime.org.ua
  date: '2012-08-09 12:50:47 +0400'
  date_gmt: '2012-08-09 08:50:47 +0400'
  content: так защиту еще можно поставить в панели инструментов хост провайдера..
- id: 68215
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-08-09 12:53:06 +0400'
  date_gmt: '2012-08-09 08:53:06 +0400'
  content: Это да, если панель позволяет иметь такой функционал. А использование файла
    .htaccess обычно всегда доступно =)
- id: 97528
  author: Ильдар Хакимов
  author_email: xakimob@gmail.com
  author_url: http://ihakimov.ru/
  date: '2012-10-19 14:30:11 +0400'
  date_gmt: '2012-10-19 10:30:11 +0400'
  content: Буду пробовать. Я так понял, если RewriteEngine уже указан выше в htaccess,
    то не нужно его снова добавлять?
- id: 97531
  author: Ильдар Хакимов
  author_email: xakimob@gmail.com
  author_url: http://ihakimov.ru/
  date: '2012-10-19 14:32:55 +0400'
  date_gmt: '2012-10-19 10:32:55 +0400'
  content: "И еще вопрос: google.ru, google.com, google.kz, google.com.ua тоже отдельно
    добавлять, или можно сделать так:\r\n\r\nRewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\\.)?google\\.&#47;.*$
    [NC]"
- id: 98285
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-10-21 22:22:47 +0400'
  date_gmt: '2012-10-21 18:22:47 +0400'
  content: Да, так. Один раз включаем и всё.
- id: 98287
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-10-21 22:29:58 +0400'
  date_gmt: '2012-10-21 18:29:58 +0400'
  content: Сложно сказать. Вообще вы верно подумали, думаю можно и так сделать. Надеюсь
    все домены содержащие GOOGLE в назваании принадлежат именно им =)
- id: 98288
  author: Ильдар Хакимов
  author_email: xakimob@gmail.com
  author_url: http://ihakimov.ru/
  date: '2012-10-21 22:30:47 +0400'
  date_gmt: '2012-10-21 18:30:47 +0400'
  content: Что-то у меня не работает, куча сайтов на Ucoz используют мои картинки.
- id: 98294
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-10-21 22:44:48 +0400'
  date_gmt: '2012-10-21 18:44:48 +0400'
  content: В смысле, в чем проблема? Все сайты кроме исключений (типа гугл) не будут
    подхватывать картинки с вашего сайта. Или вы их тоже в исключения добавили, а
    они всё равно не отображают? Тогда может проблема в кэше браузера?
- id: 98495
  author: Ильдар Хакимов
  author_email: xakimob@gmail.com
  author_url: http://ihakimov.ru/
  date: '2012-10-22 07:53:03 +0400'
  date_gmt: '2012-10-22 03:53:03 +0400'
  content: Наоборот, все сайты отображают, несмотря на запрет.
- id: 100953
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-10-27 19:48:27 +0400'
  date_gmt: '2012-10-27 15:48:27 +0400'
  content: "Я тут некоторое время отсутствовал и не мог ответить. Сорри. \r\n\r\nМожет
    быть у вас просто не разрешается использовать .htaccess??? Вы наверняка уверены
    что сервер обрабатывает этот файл? есть доступ к конфигам Апача??"
- id: 100978
  author: Ильдар Хакимов
  author_email: xakimob@gmail.com
  author_url: http://ihakimov.ru/
  date: '2012-10-27 21:15:18 +0400'
  date_gmt: '2012-10-27 17:15:18 +0400'
  content: Да, я использовал .htacces, когда зеркалил сайт на новый домен.
- id: 101004
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-10-27 22:59:44 +0400'
  date_gmt: '2012-10-27 18:59:44 +0400'
  content: Ну тогда я даже не знаю что и предложить. Вы скиньте мне сайт, который
    использует этот .htaccess и всё содержимое этого файла. Может я чего там запримечу,
    заодно и сам проверю работоспособность этого кода.
- id: 101010
  author: Ильдар Хакимов
  author_email: xakimob@gmail.com
  author_url: http://ihakimov.ru/
  date: '2012-10-27 23:17:31 +0400'
  date_gmt: '2012-10-27 19:17:31 +0400'
  content: Отправил. Но нагрузка значительно уменьшилась после установки wp super
    cashe, к тому же я картинки на странице, с которой воруют сделай спрайтами, теперь
    не каждый сможет украсть, так что не очень страшно теперь.
- id: 101058
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-10-28 01:35:06 +0400'
  date_gmt: '2012-10-27 21:35:06 +0400'
  content: "Я честно немного в замешательстве. Попробуйте в самое начало файла переместить
    код. Хотя вряд ли поможет.\r\n\r\nВообще попробуйте код сгенерировать с помощью
    <a href=\"http:&#47;&#47;www.htaccesstools.com&#47;hotlink-protection&#47;\" rel=\"nofollow\">этого
    сервиса<&#47;a>. Там разберетесь - ничего сложного. Сервис для создания .htaccess
    с кодом блокировки хотлинков. Ну он там простой почти без исключений, но вы его
    проверьте работоспособность. \r\n\r\nЕще проверьте вообще работоспособность .htaccess,
    например с помощью редиректа. Напишите редирект с одной страницы на другую и если
    не сработает, то файл не обрабатывается сервером. Код редиректа примерно следующий:\r\n<code>Redirect
    &#47;blokirovka-hotlinks&#47; http:&#47;&#47;paperplane.su&#47; <&#47;code>\r\nТолько
    вы свои адреса подставьте. Этот код перекинет с этой статьи на главную, если я
    его вставлю себе =)"
- id: 123960
  author: Мухаммад
  author_email: aknada_maga@mail.ru
  author_url: http://compusers.ru/
  date: '2012-11-28 02:46:26 +0400'
  date_gmt: '2012-11-27 22:46:26 +0400'
  content: Припоминаю одну историю услышанную кажется по телевизору. Давным-давно
    один парень на своем не очень популярном сайте выложил какое-то интересное видео(или
    изображение точно не помню, скорее видео), а другой хорошо посещаемый ресурс взял
    и поставил себе посредством хотлинка это видео. И тут набежало нагрузки на  сервер
    одного парня. А в то давнее время хостингу за трафик еще платили. Так вот и пришел
    бедолаге счет от хостинговой компании с ооочень кругленькой суммой. Прикиньте
    как тупо работал интернет в то время. У тебя классное видео, и ты вынужден за
    это платить.
- id: 124016
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-28 03:38:14 +0400'
  date_gmt: '2012-11-27 23:38:14 +0400'
  content: Хаха, да уж. Бедалага. Новые технологии всегда приходят дорого, а уходят
    дешево =)
- id: 127006
  author: Otshelnik-fm
  author_email: Otshelnik-Fm@yandex.ru
  author_url: http://beoff.ru
  date: '2012-12-01 19:04:51 +0400'
  date_gmt: '2012-12-01 15:04:51 +0400'
  content: "Можно добавить:\r\nЧтобы посмотреть список сайтов использующих картинки
    прямиком с вашего сайта задайте в поисковике такой запрос\r\n\r\n<strong>\"вашСайт.ru&#47;wp-content&#47;uploads&#47;\"<&#47;strong>\r\n\r\nЯ
    не стал закрывать их. Просто все картинки пересохранил автоматом с водяным знаком
    указывающим сайт. Пусть рекламируют :)"
- id: 127009
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-12-01 19:13:48 +0400'
  date_gmt: '2012-12-01 15:13:48 +0400'
  content: Э как хитро! Молодец! И есть же смекалка у нашего народа =) Надо будет
    на досуге тоже поглядеть, кто меня пытается копировать (хотя пару копипастеров
    я и так знаю)
- id: 132235
  author: Татьяна Чиронова
  author_email: tattyyy7@gmail.com
  author_url: http://chironova.ru
  date: '2013-01-05 22:21:07 +0400'
  date_gmt: '2013-01-05 18:21:07 +0400'
  content: "У меня на блоге не работал ни один код для защиты от холинка, пока я не
    обратилась к хостеру. Оказывается надо было поставить галочку напротив обработки
    файлов апач.\r\nА теперь всё заработало.\r\nСпасибо за статью, всего доброго!"
- id: 132242
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-01-06 00:09:19 +0400'
  date_gmt: '2013-01-05 20:09:19 +0400'
  content: Саппот всегда поможет, если хостинг нормальный =)
- id: 133503
  author: Евгений
  author_email: homealone81@rambler.ru
  author_url: ''
  date: '2013-01-14 16:51:03 +0400'
  date_gmt: '2013-01-14 12:51:03 +0400'
  content: Подскажите пожалуйста в какой именно папке нужно создать данный файл? В
    папку images в теме или др. место?
- id: 133522
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-01-14 20:21:26 +0400'
  date_gmt: '2013-01-14 16:21:26 +0400'
  content: Этот файл .htaccess нужно создавать в корне сайта
- id: 133667
  author: Алекс
  author_email: vodoley213@ngs.ru
  author_url: ''
  date: '2013-01-15 16:54:24 +0400'
  date_gmt: '2013-01-15 12:54:24 +0400'
  content: А как сделать, чтобы хотлинки были ЗАПРЕЩЕНЫ только для определенных сайтов
    из списка? Возможно ли так сделать?
- id: 133823
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-01-17 10:23:23 +0400'
  date_gmt: '2013-01-17 06:23:23 +0400'
  content: "Извините, что долго не отвечал. Был занят.\r\n\r\nВ конце статьи добавил
    подобную возможность."
- id: 133830
  author: Алекс
  author_email: kjhkjhk@mail.ru
  author_url: ''
  date: '2013-01-17 10:56:48 +0400'
  date_gmt: '2013-01-17 06:56:48 +0400'
  content: Вот спасибо!
- id: 134703
  author: pessimist
  author_email: kenga1969@narod.ru
  author_url: http://begomotbed.ru
  date: '2013-01-25 20:24:42 +0400'
  date_gmt: '2013-01-25 16:24:42 +0400'
  content: Я прозрел, когда посмотрел сколько таких ГВБастеров развелось :) Спасибо
    за статью, поставлю в план борьбу с этим делом. А счетчик посещаемости в Яндекс-метрике
    считает такие прямые запросы к картинкам, как запросы к страницам или нет ?
- id: 134705
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-01-25 20:36:56 +0400'
  date_gmt: '2013-01-25 16:36:56 +0400'
  content: Нет не считает, т.к. их код находится в коде страницы, а отдается сервером
    только сама картинка. Грубо говоря, браузер запрашивает картинку и получает картинку,
    запрашивает страницу и получает страницу, запрашивает файл и получает файл. не
    больше, не меньше.
- id: 134713
  author: pessimist
  author_email: kenga1969@narod.ru
  author_url: http://begomotbed.ru
  date: '2013-01-25 21:21:14 +0400'
  date_gmt: '2013-01-25 17:21:14 +0400'
  content: "Мне показалось, или статья и правда - только что была дополнена ?\r\nДавно
    у Вас не был, а Вы уже тут столько всего классного наваяли.\r\nПо PHP урок номер
    дыва не планируете писать ? \r\n\r\nВ глаза бросилось : В блоке \"использую\"
    правого сайдбара в описании сервиса userator допущена опечатка в слове раскрутить.
    Пропущена буква \"а\"."
- id: 134721
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-01-25 22:11:27 +0400'
  date_gmt: '2013-01-25 18:11:27 +0400'
  content: "Статью я не трогал. Показалось =) Про PHP пока не думал, на очереди другие,
    но вообще набросок статьи уже давно весит, надо будет его довести как-нибудь до
    ума.\r\n\r\nСпасибо за замеченную ошибку =)"
- id: 196657
  author: Мухаммад
  author_email: aknada_maga@mail.ru
  author_url: http://besplatnyeprogramy.ru/
  date: '2013-11-21 14:26:11 +0400'
  date_gmt: '2013-11-21 10:26:11 +0400'
  content: "ПРиветствую всех. Недавно начал получать письма от хостинга о чрезмерной
    нагрузке. Нашел целый сайт скопированный с моего и соответственно все картинки
    идут хотлинками.\r\n\r\nВопрос такой: в начале статьи пишется что .htaccess надо
    выложить в папку с изображениями, а ближе к концу что он должен быть в корне сайта.
    У меня на WP картинки идут в папках по годам и месяцам (зря я так настраивал).
    Мне куда ставить .htaccess в каждую папку изображений или в корень?"
- id: 196661
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-11-21 14:58:00 +0400'
  date_gmt: '2013-11-21 10:58:00 +0400'
  content: Вообще по идеи он должен работать везде. Точнее файл этот работает в ту
    директорию в которой расположен. Но можно и в корень сайта всё это пихнуть, чтобы
    один раз было и норм. Но это только при условии, что картинки у вас отдаёт Apache,
    а не какой другой сервер.
- id: 196684
  author: Мухаммад
  author_email: aknada_maga@mail.ru
  author_url: http://besplatnyeprogramy.ru/
  date: '2013-11-21 19:58:04 +0400'
  date_gmt: '2013-11-21 15:58:04 +0400'
  content: "Привет, оказывается мой хостер (а именно таймвеб) настроен чтобы обрабатывать
    изображения не apache'м а  nginx'ом. Поэтому тест на обработку с перенаправлением
    у меня сработал, а блокирование хотлинков не действует.\r\n\r\nНет ли решения
    в таком случае?"
- id: 225948
  author: Ярослав
  author_email: jariv@bk.ru
  author_url: http://kuhnyaholostyaka.ru/
  date: '2014-03-03 23:29:21 +0400'
  date_gmt: '2014-03-03 19:29:21 +0400'
  content: "Хм... такая же ситуация...\r\nПодождем ответа Андрея"
- id: 225953
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2014-03-04 01:01:22 +0400'
  date_gmt: '2014-03-03 21:01:22 +0400'
  content: "да, ситуация знакома, сейчас в основном все хостинг отдают статику (css,
    js, картинки) с помощью nginx. и это хорошо. но довольно редко на шаред хостингах
    доступна правка конфигов nginx. нельзя написать .htaccess как у Apache. Если вы
    можете править конфиги nginx (обычно это некий файл типа nginx.conf лежащий недалеко
    от корня вашей файловой системы), то вам нужно вставить нечто подобное:\r\n\r\n<code>location
    ~ \\.(jpe?g|png|gif)$ {\r\n     valid_referers none blocked mysite.ru *.mysite.ru;\r\n
    \    if ($invalid_referer) {\r\n       return 403;\r\n     }\r\n}<&#47;code>\r\n\r\nгде
    mysite.ru заменить на ваш сайт и на другие сайты через пробел. *.mysite.ru означает
    все поддомены вашего сайта. так же и для других поддоменов если потребуется. а
    через \"|\" можете ещё надобавлять нужных расширений\r\n\r\nВ случае если конфиги
    вам нельзя править, то можете попросить вашу поддержку запретить вам хотлинки.
    Другое дело что они могут не пойти на встречу т.к. обычно на весь сервер используется
    один общий конфиг. А на одном сервер может быть сотни и тысячи сайтов."
- id: 225962
  author: Ярослав
  author_email: jariv@bk.ru
  author_url: http://kuhnyaholostyaka.ru/
  date: '2014-03-04 02:08:08 +0400'
  date_gmt: '2014-03-03 22:08:08 +0400'
  content: Спасибо за быстрый ответ! Будет день - буду пробовать (сейчас уже спать
    охота)
- id: 227181
  author: Denys
  author_email: info@wpixel.ru
  author_url: http://wpixel.ru
  date: '2014-03-19 00:06:45 +0400'
  date_gmt: '2014-03-18 20:06:45 +0400'
  content: Столкнулся тоже с этой бедой, правка .htaccess не спасает, хостинг Бегет.
- id: 227184
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2014-03-19 00:16:48 +0400'
  date_gmt: '2014-03-18 20:16:48 +0400'
  content: Потому что .htaccess для Apache, а у вас nginx. И поэтому, к сожалению,
    у меня ответ всё <a href="http:&#47;&#47;paperplane.su&#47;blokirovka-hotlinks&#47;#div-comment-225953"
    rel="nofollow">тот же<&#47;a>
- id: 227185
  author: Denys
  author_email: info@wpixel.ru
  author_url: http://wpixel.ru
  date: '2014-03-19 00:18:30 +0400'
  date_gmt: '2014-03-18 20:18:30 +0400'
  content: сенкс за ответ, буду хостера терзать
- id: 251523
  author: 'Now You See It: Studies in Lesbian and Gay Film - Richard Dyer downloads'
  author_email: ''
  author_url: http://www.onlinebooksclub.com/Now-You-See-It-Studies-in-Lesbian-and-Gay-Film/p1965815975/
  date: '2015-06-13 20:09:04 +0300'
  date_gmt: '2015-06-13 16:09:04 +0300'
  content: |-
    <strong>Now You See It: Studies in Lesbian and Gay Film - Richard Dyer<&#47;strong>

    About the AuthorRichard Dyer is Professor of Film Studies at the University of Warwick. He is the author of Only Entertainment, 2nd edition (2002), Culture
- id: 281105
  author: артем
  author_email: lodka1972@mail.ru
  author_url: ''
  date: '2016-07-27 15:52:43 +0300'
  date_gmt: '2016-07-27 11:52:43 +0300'
  content: "у меня на виртуальном хостинге таймвеб тоже внесение кода в .htaccess
    от хотлинка не избавляет. обратился в техподдержку, ответили вот что: \r\n\r\n\"На
    наших серверах используется схема работы, при которой запросы к статичным файлам
    обрабатываются с помощью Nginx, а остальные запросы передаются Apache. Поэтому
    файл .htaccess не может использоваться для отключения доступа к статическим файлам,
    так как он обрабатывается только на уровне Apache.\r\n\r\nДля решения вопроса
    рекомендуется использовать следующий вариант:\r\n- в скриптах сайта можно использовать
    ссылки на файлы, которые физически отсутствуют (например, для файлов на сервере
    использовать формат pdx);\r\n- осуществлять перенаправления с таких файлов на
    существующие при помощи .htaccess.\r\n\r\nПри использовании описанного способа
    запрос будет обрабатываться Apache, и ограничения в .htaccess будут вступать в
    силу.\"\r\n\r\nПравить nginx не разрешают на виртуалке. рекомендуют перейти на
    VDS."
---
<p><a href="http:&#47;&#47;image.paperplane.su&#47;2012&#47;05&#47;hot-links.png"><img class="alignleft size-medium wp-image-2503" title="Блокировка хотлинков" src="http:&#47;&#47;image.paperplane.su&#47;2012&#47;05&#47;hot-links-300x300.png" alt="Блокировка хотлинков" width="300" height="300" &#47;><&#47;a> Вы только представьте, вы корпите над контентом, делаете красивые изображения и у вас это все крадут! Не очень приятно. А если у вас не просто крадут контент, а еще и грузят ваш сервер. Это просто возмутительно! Именно так бывает при хотлинках. <strong>Хотлинки<&#47;strong> - это включение в страницу файлов-изображений или других ресурсов с чужого сервера путём обращения к нему. Так что это не просто воровство, а наглое воровство ленивого говно-веб-мастера, которому даже лень закачать к себе на сервер ворованное изображение. Будем же бороться с этим, кому не лень!</p>
<p>На самом деле бороться с хотлинками не так сложно, ведь хотлинк это всего лишь обращение к вашему серверу, чтобы он вернул в ответ определенный ресурc. А любое обращение можно перехватить по какому-нибудь условию настаивая сервер определённым способом. Но есть небольшая проблема. В зависимости от того какой сервер у вас отдаёт стату (css, js, картинки) его конфигурация будет отличаться или вообще может быть не доступна. В начале рассмотри редкий вариант, но самый простой.</p>
<h2>Блокировка хотлинков на Apache<&#47;h2></p>
<p>Раньше часть использовался Apache для всего и в том числе для отдачи статы. Кое-где и сейчас он используется, но довольно редко. И если у вас он, то вы можете легко повлиять на его конфигурацию из файла <em>.htaccess<&#47;em>, который будет находится в папке с вашими изображениями. Дык, создадим же его там!</p>
<p>Для тех кто с этим не очень знаком, я напоминаю, что точка в начале названия обязательна - <em>.htaccess<&#47;em>! Далее в этот файл необходимо разместить следующий код:<br />
[cce lang="text"]RewriteEngine On<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?yandex\.ru&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?google\.ru&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?yourdomain\.ru&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^$ [NC]<br />
RewriteRule .*\.(jpe?g|gif|bmp|png)$ wait.png [L][&#47;cce]<br />
Тут все вроде бы просто, первая строчка включает модуль mod_rewrite. Это такой хитрый модуль сервера Apache, который преобразовывает URL. Этот код будет работать следующим образом: когда браузер запрашивает у сервера картинку, он посылает специальный http-заголовок с инфой о том, с какой страницы пользователь попал на эту картинку. Этот заголовок-то и палит вора, кстати, он (заголовок) называется реферером (от англ. refer &mdash; напрявлять, отсылать).</p>
<p>Следующие три строки - это сайты-исключения, которым можно воровать ваши картинки. Очень важно исключить свой сайт так же (4я строка), а то заблокируете доступ и сами себе, что не очень хорошо. Строка под номером пять пропустит запрос пользователя, если рефера нет.</p>
<p>И последняя строка говорит на какие картинки (с каким расширением) это правило будет распространяться. При этом картинка <em>wait.png<&#47;em> будет показываться вместо запрошенной, кстати, эта картинка должна находится в той же папки, что и файл <em>.htaccess<&#47;em>. Если вы не хотите показывать вообще картинку, то можете возвратить ответ 403 (Forbidden), заменив последнюю строку на следующую:<br />
[cce lang="text"]RewriteRule .*\.(jpe?g|gif|bmp|png)$ - [F][&#47;cce]<br />
Могу дать небольшой совет. Можно добавить больше сайтов-исключений, т.к. довольно много поисковиков (хоть и не все) ведут учет картинок и можно постараться найти хотя бы часть поисковиков, которые стоит разрешить забирать картинки. Для этого идем в любую систему учета трафика типа Метрики у Яндекса (надеюсь хоть какая-то у вас подключена) и смотрим источники трафика, среди которых вам нужны поисковики. Составя список поисковиков с которых на вас заходили, вы можете его добавить в исключения. Например в моем случаи исключения получились следующими:<br />
[cce lang="text"]RewriteEngine On<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?yandex\.ru&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?google\.ru&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?feedburner\.com&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?mail\.ru&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?poisk\.ru&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?rambler\.ru&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?nigma\.ru&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?ask\.com&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?qip\.ru&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?ukr\.net&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?conduit\.com&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?tut\.by&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?bing\.com&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?webalta\.ru&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?yahoo\.com&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?babylon\.com&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?conduit\.com&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^http:&#47;&#47;(.+\.)?paperplane\.su&#47;.*$ [NC]<br />
RewriteCond %{HTTP_REFERER} !^$ [NC]<br />
RewriteRule .*\.(jpe?g|gif|bmp|png)$ wait.png [L][&#47;cce]</p>
<p>Также можно поступить обратным способом и сделать черный список сайтов с которых будут запрещены хотлинки, а со всех остальных разрешены:</p>
<p>[cce lang="text"]RewriteEngine On<br />
RewriteCond %{HTTP_REFERER} ^http:&#47;&#47;(www\.)?site_1\.ru&#47; [NC,OR]<br />
RewriteCond %{HTTP_REFERER} ^http:&#47;&#47;(www\.)?site_2\.ru&#47; [NC,OR]<br />
RewriteCond %{HTTP_REFERER} ^http:&#47;&#47;(www\.)?site_3\.com&#47; [NC]<br />
RewriteRule \.(jpe?g|gif|bmp|png)$ wait.png [L][&#47;cce]</p>
<h2>Блокировка хотлинков на nginx<&#47;h2></p>
<p>Очень часто теперь используется nginx для возвращения статы с сервера. Это и хорошо и плохо. Он это делает гораздо быстрее, чем тот же Apache, но повлиять на его конфигурацию гораздо сложнее.</p>
<p>Если у вас шаред хостинг, то скорее всего единственный возможный вариант &ndash; это переговоры со службой поддержки с целью устранения хотлинков, которое они уже сами должны сделать сконфигурировав nginx по вашему требованию. Другое дело, что они могут не пойти на встречу т.к. обычно на весь сервер используется один общий конфиг, который влияет на всех. А на одном сервер могут быть сотни и тысячи сайтов. Так что это как повезёт. Трясите поддержку.</p>
<p>Но если же у вас <a href="http:&#47;&#47;paperplane.su&#47;reg-vps" title="Отличные VPS" target="_blank">свой VPS<&#47;a> или каким-то чудом на шареде вы можете править конфиги nginx (обычно это некий файл типа nginx.conf лежащий недалеко от корня вашей файловой системы, но это крайне редко), то вам нужно вставить нечто подобное:</p>
<p>[cce lang="text"]<br />
location ~ \.(jpe?g|png|gif)$ {<br />
     valid_referers none blocked mysite.ru *.mysite.ru;<br />
     if ($invalid_referer) {<br />
       return 403;<br />
     }<br />
}<br />
[&#47;cce]</p>
<p>В данном коде <em>mysite.ru<&#47;em> необходимо заменить на свой сайт и на любые другие сайты через пробел (те же поисковики др.). Плюс можно разрешать отдельно для своих или чужих поддоменов (<em>*.mysite.ru<&#47;em>). А в условии <em>location<&#47;em> можно через трубу "|" надобавлять ещё необходимых вам расширений файлов.</p>
<p>Все! Теперь с хотлинками покончено. Хватит отдавать ресурсы своего сервера всяким незнакомцам. Надеюсь этот мануал снизит нагрузку на ваш сервер и поможет в целом. Свои мнения пишите в комментарии, пожалуйста. Всем удачи!</p>

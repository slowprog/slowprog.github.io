---
layout: post
status: publish
published: true
title: Cпам на сайте
author:
  display_name: SlowProg
  login: seoadmin
  email: paperplanesu@rambler.ru
  url: http://paperplane.su
author_login: seoadmin
author_email: paperplanesu@rambler.ru
author_url: http://paperplane.su
wordpress_id: 2621
wordpress_url: http://paperplane.su/?p=2621
date: '2012-11-14 15:07:57 +0400'
date_gmt: '2012-11-14 11:07:57 +0400'
categories:
- Мастерская
tags:
- спам
- безопасность
comments:
- id: 112927
  author: ТОха
  author_email: onjeerss@gmail.com
  author_url: http://onjee.ru
  date: '2012-11-14 19:50:30 +0400'
  date_gmt: '2012-11-14 15:50:30 +0400'
  content: Что то слишком  замороченно))  Надо будет обмозговать дома)
- id: 112977
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-14 21:07:09 +0400'
  date_gmt: '2012-11-14 17:07:09 +0400'
  content: Ну вот! А я наоборот писал, старался разжевать каждый момент, чтобы не
    осталось недопонимания. Но походу слог получился кое-где чересчур запаренный =)
    Зато все моменты что хотел рассмотрел.
- id: 118370
  author: Людмила
  author_email: morosh-lyudmila@yandex.ru
  author_url: http://lmoroshkina.ru/
  date: '2012-11-19 22:42:12 +0400'
  date_gmt: '2012-11-19 18:42:12 +0400'
  content: Все очень и очень заумно, лично для меня.
- id: 118373
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-19 23:00:36 +0400'
  date_gmt: '2012-11-19 19:00:36 +0400'
  content: 'Безусловно, содержание имеет свою специфику и поймет ее только тот кто
    хоть раз делал вручную форму и обработку данных для нее. Но по сути, для понимания
    требуются только начальные знания о HTML и PHP. А сама идея проста как 5 копеек:
    робот видит поле, которого не видит настоящий пользователь, он в него пишет и
    на этом мы его ловим. Это почти как ловля на живца =)))))'
- id: 168020
  author: Sandro
  author_email: beta.com7@gmail.com
  author_url: http://tef.co.ua/
  date: '2013-06-20 00:41:46 +0400'
  date_gmt: '2013-06-19 20:41:46 +0400'
  content: "А у меня к Вам интересный вопрос. Или глупый... \r\nА возможно ли прописать
    для спамботов редирект на какую-то \"левую\" страницу, за основу взяв признак,
    что у них генереные мейлы, типо y5543hvs769@powered.im  (подобные адреса можно
    также получить на сервисах наподобие   https:&#47;&#47;temp-mail.ru&#47;   )"
- id: 168023
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-06-20 01:26:18 +0400'
  date_gmt: '2013-06-19 21:26:18 +0400'
  content: Возможно, если адекватно распознавать такие мыла. Если касательно подобных
    сервисов, то распознавать по доменам во всех остальных случаях распознать, я полагаю,
    не получится.
- id: 169170
  author: Юрий
  author_email: boluiv@gmail.com
  author_url: ''
  date: '2013-06-27 11:34:40 +0400'
  date_gmt: '2013-06-27 07:34:40 +0400'
  content: "Здравствуйте, Андрей!\r\nВ своей теме оформления не нашел стандартный
    html код формы для комментирования.\r\nЕсть только вот это: <code><?php comment_form();
    ?><&#47;code><code>\r\nСкажите, пожалуйста, как и куда пристроить рекомендуемый
    Вами код?\r\nСпасибо."
- id: 169177
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-06-27 12:44:19 +0400'
  date_gmt: '2013-06-27 08:44:19 +0400'
  content: У меня в начале статьи написано, что конкретно для WordPress я уже описывал
    алгоритм, потому передите по ссылке и <a href="http:&#47;&#47;paperplane.su&#47;wordpress-i-spam&#47;"
    rel="nofollow">читайте там<&#47;a>.
- id: 169269
  author: Юрий
  author_email: boluiv@gmail.com
  author_url: ''
  date: '2013-06-27 20:36:26 +0400'
  date_gmt: '2013-06-27 16:36:26 +0400'
  content: "По статье, куда Вы меня направили, вопросов нет. \r\nНо там скрытие поля
    для комментария выполняется с помощью css.\r\nВ этой статье Вы сообщаете, что
    метод с css уже не работает, и предлагаете метод с применением javaScript.  \r\nТак
    как в моей теме вывод формы комментирования выполняется с помощью функции comment_form,
    то я вставил в файл functions.php предлагаемый Вами код для этого варианта.\r\nВопрос:
    как связать этот код с javaScript, чтобы всё правильно работало?"
- id: 169282
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-06-27 21:09:16 +0400'
  date_gmt: '2013-06-27 17:09:16 +0400'
  content: "Просто вместе с дополнительными стоками добавляющимися в функции change_comment_form_defaults
    прибавьте и JS. Вроде так должно работать. Было:\r\n<code>function change_comment_form_defaults($default)
    {\r\n  $commenter = wp_get_current_commenter();\r\n  $default['comment_notes_after']
    .=\r\n  '<p class=\"comment-form-real-comment\">\r\n  <label for=\"real-comment\">Комментарий<&#47;label><textarea
    id=\"real-comment\"\r\n  aria-required=\"true\" rows=\"8\" cols=\"45\" name=\"real-comment\"><&#47;textarea>\r\n
    \ <&#47;p>';\r\n  return $default;\r\n}<&#47;code>\r\nи стало:\r\n<code>function
    change_comment_form_defaults($default) {\r\n  $commenter = wp_get_current_commenter();\r\n
    \ $default['comment_notes_after'] .=\r\n  '<p class=\"comment-form-real-comment\">\r\n
    \ <label for=\"real-comment\">Комментарий<&#47;label><textarea id=\"real-comment\"\r\n
    \ aria-required=\"true\" rows=\"8\" cols=\"45\" name=\"real-comment\"><&#47;textarea>\r\n
    \ <&#47;p><script>$(document).ready(function(){$('.comment-form-comment').hide();});<&#47;script>';\r\n
    \ return $default;\r\n}<&#47;code>\r\nМожет чего с селекторами напутал, но думаю
    разберётесь."
---
<p><a href="http:&#47;&#47;image.paperplane.su&#47;2012&#47;11&#47;spam-site.png"><img src="http:&#47;&#47;image.paperplane.su&#47;2012&#47;11&#47;spam-site-300x300.png" alt="Спам на сайте" title="Спам на сайте" width="300" height="300" class="alignleft size-medium wp-image-2651" &#47;><&#47;a>Почти каждый пользователь интернета не по наслышке знает о <strong>спаме на сайтах<&#47;strong> и его последствиях. Почти все ресурсы без исключения подвергаются нападениям безжалостного спама. Он не щадит ни женские блоги ни порталы для детей. Он ужасен и страшен, им можно пугать детей. Но не всё так плохо, как может показаться. У нас есть одно преимущество: мы знаем, что спам везде! Одно печалит: некоторые создатели сайтов настолько пренебрегают элементарной безопасностью, что спаму дорога открыта во все формы сайта. А обычно на сайте бывает по несколько форм (в зависимости от тематики и типа): от контактных форм до форм заказа и комментирования. И как говорится, у страха глаза, что плошки, а не видят ни крошки. Дык, давайте же защитим наши HTML-формы от спамных ботов!</p>
<p>В одной из предыдущий публикации я уже рассказывал, как бороться со <a title="WordPress и спам" href="http:&#47;&#47;paperplane.su&#47;wordpress-i-spam&#47;" target="_blank">спамом в WordPress<&#47;a>. И в принципе, там рассказан и показан способ борьбы (как с плагином, так и без). Но он касается конкретно только WordPress и нигде более работать не будет. Потому я вынес саму идею в отдельную статью, чтобы поподробней разобрать и обыграть. Она заключается в том, чтобы подпихнуть боту-спамеру поле, которое будет видеть только он и будет заполнять его, а раз только он её и видеть, то значит при обработке данных от формы мы легко сможем отличить настоящего пользователя (который не видит это поле) от бота. А почему бот будет видеть, а пользователь нет? Всё просто: боты не умеют интерпретировать JavaScript код, а браузеры пользователей умеют. На этом мы и сыграем. Мы сделаем фиктивное поле невидимым для пользователя с помощью JS.</p>
<p>Сделаю небольшое лирическое отступление и скажу, что можно сделать поле невидимым и с помощью CSS. Это достаточно просто, нужно прописать всего лишь один стиль для поля формы: [cci lang="css"]display: none;[&#47;cci]. Но этот метод почему-то перестал иметь результативность. Я на собственной шкуре ощутил, что боты всё равно понимают какие поля видимы, а какие нет и пишут куда надо. Потому я такой вариант даже рассматривать не буду, и скажу, что он устарел (если позволите мне так выразится).</p>
<p>Теперь ближе к делу. Вот стандартный HTML-код небольшой формы для комментирования:</p>
<pre>[cc escaped="true" lang="html"]</p>
<form action="comment_send.php" method="post">
	<label>Имя:<&#47;label><br />
	<input id="name" type="text" &#47;><br />
	<label>Комментарий:<&#47;label><br />
	<input id="comment-this" name="comment-this" type="text" &#47;><br />
	<input id="comment" name="comment" type="text" &#47;><br />
	<input type="submit" value="Послать" &#47;><br />
<&#47;form>[&#47;cc]<&#47;pre><br />
В этой форме нет ничего необычного, всё как нужно: есть поле для имени комментатора, поле для сообщения и кнопка отправки формы. Но как вы могли заметить, есть еще дополнительное поле <em>comment-this<&#47;em>, которое как раз и предназначается для бота. Обращаю ваше внимание на некоторые моменты, которые должны быть соблюдены, чтобы не облегчать жизнь спамеру:</p>
<ul>
<li>В названиях идентификатора, класса или чего-бы то ни было не должно присутствовать ни намека на то, что поле предназначено для спама. Например исключены названия <em>comment-spam<&#47;em> или <em>for_spam<&#47;em>. Если бы я писал спам-бота, то я обязательно отсеивал бы такие поля, т.к. они сами за себя говорят.<&#47;li>
<li>Во всех своих последующих реализациях используйте различные наименования идентификаторов (а не как у меня <em>comment-this<&#47;em>), чтобы бот не мог обучаться. Опять же, если бы я писал спам-бота, то я обязательно прошелся по подобным статейкам и собрал бы все названия полей для спама, которые использует автор статьи.<&#47;li>
<li>Я не рекомендую использовать атрибут <em>for<&#47;em> для тега <em>label<&#47;em>. Ведь он напрямую показывает какое поле из двух настоящее. Например, в данном коде для 2ого лейбола этот атрибут выглядел бы так [cci lang="html"]for="comment"[&#47;cci]. Это означает, что лейбл приписан к полю <em>comment<&#47;em>, которым и является настоящее поле для комментирования. И снова, если бы я писал спам-бота, то я бы учел эти мелочи.<&#47;li>
<li>И напоследок, максимально делайте поле для спама похожим на ваше настоящее поле, если есть какие-то дополнительные атрибуты, то их так же устанавливайте. И ставьте фиктивное поле перед настоящим, чтобы при прохождении по дереву <a title="Document Object Model" href="http:&#47;&#47;ru.wikipedia.org&#47;wiki&#47;Document_Object_Model" rel="nofollow" target="_blank">DOM<&#47;a> на него бот натыкался первым. Это будет предавать дополнительного реализма.<&#47;li>
<p><&#47;ul><br />
Соблюдая эти нехитрые правила, вы значительно усложните спамеру задачу определения настоящего поля для сообщения. И если бы я писал спам-ботов, то скорее всего, от них вы уже будете защищены.</p>
<p>Далее нужно определить каким образом лучше сделать поле невидимым. Сегодня очень часто применяется для всего подряд библиотека <em>jQuery<&#47;em>. И тут она тоже может быть очень кстати. Но я бы вам не рекомендовал её использовать только для этих целей. Это как из пушки по воробьям, зачем тащить за собой огромную библиотеку для одного нехитрого действия. Но если у вас на данной странице уже как-то использована <em>jQuery<&#47;em>, то это будет хоть как-то оправдано. И тогда вам нужно просто написать следующий код:</p>
<pre>[cc escaped="true" lang="js"]<br />
<script type="text&#47;javascript"><br />
    $(document).ready(function(){<br />
        $('#comment-this').hide();<br />
    });<br />
<&#47;script><br />
[&#47;cc]<&#47;pre><br />
А если вы не хотите из пушки по воробьям (что правильно), то можно использовать голый JS без каких либо библиотек:</p>
<pre>[cc escaped="true" lang="js"]<br />
<script><br />
    window.onload = function(){<br />
        document.getElementById('comment-this').style.display ='none';<br />
    }<br />
<&#47;script><br />
[&#47;cc]<&#47;pre><br />
Решать вам, какой код использовать. Но так или иначе мы сделали наше фейковое поле невидимым для настоящих пользователей (у которых включен JS) и на этом, в принципе, всё готово. Теперь в вашем скрипте по обработки данных формы, если в поле <em>comment-this<&#47;em> будут обнаружены данные, то вы можете смело игнорировать данное сообщение. Обработку можно провести примерно следующим образом:</p>
<pre>
[cc escaped="true" lang="php"]<br />
if($_POST['comment-this'] != '') {<br />
    die("Get out!");<br />
}<br />
[&#47;cc]<br />
<&#47;pre><br />
Код очень простой и думаю не вызовет затруднений: если фиктивное поле не пустое, то прекращаем выполнение кода и отсылаем сообщение спам-боту, чтобы он убирался.</p>
<p>На этому у меня на сегодня всё. Если есть какие-то замечания, предложения или пожелания, то пишите их в комментарии. Постараюсь помочь, чем смогут. И не теряйте бдительность, спам где-то рядом. Удачи!</p>

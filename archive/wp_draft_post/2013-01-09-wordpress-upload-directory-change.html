---
layout: post
status: publish
published: true
title: Изменить папку загрузки файлов в WordPress
author:
  display_name: SlowProg
  login: seoadmin
  email: paperplanesu@rambler.ru
  url: http://paperplane.su
author_login: seoadmin
author_email: paperplanesu@rambler.ru
author_url: http://paperplane.su
wordpress_id: 2751
wordpress_url: http://paperplane.su/?p=2751
date: '2013-01-09 02:56:26 +0400'
date_gmt: '2013-01-08 22:56:26 +0400'
categories:
- Без плагина
tags:
- сниппет
- админка
comments:
- id: 132651
  author: Сергей
  author_email: antoshkin_80@mail.ru
  author_url: ''
  date: '2013-01-09 06:27:23 +0400'
  date_gmt: '2013-01-09 02:27:23 +0400'
  content: О, нужная вещь, забираю. Мне первый способ подходит. <strong>Спасибо<&#47;strong>
    большое.
- id: 132652
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-01-09 06:29:25 +0400'
  date_gmt: '2013-01-09 02:29:25 +0400'
  content: еп! Не за что =) Думал еще писать об этом или нет, но раз одному человеку
    уже пригодилось, то я доволен =))))
- id: 132665
  author: Сергей
  author_email: antoshkin_80@mail.ru
  author_url: ''
  date: '2013-01-09 09:23:42 +0400'
  date_gmt: '2013-01-09 05:23:42 +0400'
  content: "Да это отличная вещь, вот если бы еще этот скрипт мог уже загруженное
    отсортировывать,  вообще был бы шоколад.\r\n\r\nПлохо когда не знаешь PHP, пытаюсь
    что-то читать, вникать, но пока знаю только основы, html и css я хорошо знаю,
    а вот php трудновато дается, да и времени нет, сесть и конкретно заняться, тут
    пол часа, там час..., разве так выучишь."
- id: 132696
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-01-09 17:15:04 +0400'
  date_gmt: '2013-01-09 13:15:04 +0400'
  content: "Что значит <strong>отсортировывать<&#47;strong>? В принципе, что бы это
    не было, но думаю это можно сделать. Правда придется другой фильтр использовать,
    т.к. этот перехватывает только пути загрузки.\r\n\r\nА PHP можно изучить постепенно,
    особенно это просто на основе WordPress. По чуть-чуть там, тут и в конце будут
    накопленные знания. Не мастерские конечно знания, но хоть какие-то =)"
- id: 132723
  author: Сергей
  author_email: antoshkin_80@mail.ru
  author_url: ''
  date: '2013-01-09 22:38:28 +0400'
  date_gmt: '2013-01-09 18:38:28 +0400'
  content: я имел ввиду - разложить по папкам, ранее загруженное.
- id: 132725
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-01-09 22:43:38 +0400'
  date_gmt: '2013-01-09 18:43:38 +0400'
  content: ммммм. Ну все зависит от конечной структуры каталогов. Например, если был
    добавлен день (первый вариант), то теоретически можно написать код, который просмотрит
    каждый файл, определит дату его создания (из атрибутов файла) и запихает его в
    нужную папку. Но нужно ли это делать, это другой вопрос =)))
- id: 132726
  author: Сергей
  author_email: antoshkin_80@mail.ru
  author_url: ''
  date: '2013-01-09 22:57:16 +0400'
  date_gmt: '2013-01-09 18:57:16 +0400'
  content: Я когда первый раз зашел в папку с картинками, меня чуть кандрашка не хватила,
    wordpres нарезал их огромную кучу, и все в одой папке. А благодаря вам будут в
    отдельных папках, по дням. Удобней находить и удалять не нужные.
- id: 132727
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-01-09 23:00:29 +0400'
  date_gmt: '2013-01-09 19:00:29 +0400'
  content: Если честно, то я вообще туда не хожу. Чего там WordPress делает это уже
    его дело =)))) Хотя если волею судеб часто приходится заходить и проводить некую
    ручную модерацию, то по дням определенно гораздо удобнее организовывать.
- id: 132729
  author: Сергей
  author_email: antoshkin_80@mail.ru
  author_url: ''
  date: '2013-01-09 23:08:17 +0400'
  date_gmt: '2013-01-09 19:08:17 +0400'
  content: Кстати, вы не знаете как остановить это бесмысленное размножение картинок.
    Блин загружаешь одну, а на выходе получаешь , аж целых пять?
- id: 132730
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-01-09 23:12:51 +0400'
  date_gmt: '2013-01-09 19:12:51 +0400'
  content: Готовых решений у меня нет. Может быть как и можно, но это не бессмысленное
    размножение. Каждая из вариантов картинки нужна для WordPress. Хотя может не каждая
    будет использоваться. Сложно сказать. Погуглите =)
- id: 132731
  author: Сергей
  author_email: antoshkin_80@mail.ru
  author_url: ''
  date: '2013-01-09 23:21:11 +0400'
  date_gmt: '2013-01-09 19:21:11 +0400'
  content: Еще раз спасибо. Мое мнение - ваш хак(хук), удобная вещь!
- id: 133025
  author: Иван
  author_email: popekka@mail.ru
  author_url: ''
  date: '2013-01-12 02:14:09 +0400'
  date_gmt: '2013-01-11 22:14:09 +0400'
  content: "размножение картинок говорите. наверное имеете ввиду разные разрешения?
    я пока решил так: админка-> параметры -> медиафайлы\r\n\r\nРазмер миниатюры:  Ширина
    [0]  Высота [0]\r\nСредний размер:       Макс.Ширина [0] Макс.Высота [0]\r\nКрупный
    размер:        Макс.Ширина [622] Макс.Высота [0]\r\n\r\n[v] - Помещать загруженные
    мной файлы в папки по месяцу и году\r\n\r\nминиатюры и среднего размера изобразения
    в моей лично теме не использую, поэтому по нулям, чтоб вообще не создавались.\r\n\r\n622
    - такая ширина нужна именно мне, посмотрите ширину своего поста (чтоб картинка
    за него не вылазила)\r\n\r\nтеперь при загрузке: 1.если картинка меньшей ширины
    чем 622пикселя то она загружается в одном эксемпляре\r\n2.Если же картинка большей
    ширины чем 622 то загружаются две картинки (оригинального и ресайзнутого до ширины
    622), а в постах отображаются именно ресайзнутые до 622.\r\n\r\np&#47;s&#47; прошу
    прощения за \"ресайзнутые\" голова не варит как правильно написать, наверное \"отмашштабированные\":)
    \   \r\n\r\nконечно решение не идеальное, но все же избавились от нескольких экземпляров.
    \r\n\r\nа вот как избавится от последнего звена (вдруг нам нужна только ресайзнутая
    картинка и не нужна совсем полная?) нужно спросить у уважаемого SlowProg в какую
    сторону копать, может он подскажет.\r\n\r\np&#47;p&#47;s что ваш ник, уважаемый
    SlowProg, значит?  медленное но верное программирование? :)))"
- id: 133038
  author: Иван
  author_email: popekka@mail.ru
  author_url: ''
  date: '2013-01-12 04:35:58 +0400'
  date_gmt: '2013-01-12 00:35:58 +0400'
  content: "Опять назрел вопрос! Надеюсь я вас еще не достал? :)\r\nКак у вас организованно
    что рекламный блок (гугловский скролицца вниз при скроле страницы) ? не можете
    поделиться? кстати понажимал его и всем рекомендую, чтоб как- то помочь, ведь
    известно что хостинг сам не оплачивается)))"
- id: 133058
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-01-12 08:09:39 +0400'
  date_gmt: '2013-01-12 04:09:39 +0400'
  content: "Этот блок с рекламой от эдсенс построен полностью на JS. Его код можно
    глянуть в исходнике страницы, сразу рядом с баннером (сверху или снизу, точно
    не помню, а заглянуть лень).\r\n\r\nНа счет решения с картинками, то оно очень
    интересное. Мне понравилось. И оно имеет право на существование, ведь WordPress
    это одна из тех CMS, которые пытаются покрыть, как можно больший класс задач.
    Отсюда как раз вытекло то что картинок нужно много в разных разрешениях для использования
    в разных ситуациях. Но да, тем кому не нужны лишние картинки данный метод организации
    не подходит. И решение норм.\r\n\r\nНо есть более изящное решение. Обо всём по
    порядку. Вначале я немного огорчу: нельзя не закачивать большой экземпляр картинки
    т.к. именно из него генерируются все остальные, потому закачивать нужно обязательно.
    Но можно поступить очень хитро и после генерации остальных удалять ненужную большую
    картинку:\r\n\r\n<code>function sp_delete_fullsize( $data ) {\r\n    $uploadDir
    = wp_upload_dir();\r\n    unlink(trailingslashit( $uploadDir['basedir'] ) . $data['file']);\r\n
    \   return $data;\r\n}\r\nadd_filter( 'wp_generate_attachment_metadata', 'sp_delete_fullsize'
    );<&#47;code>\r\n\r\nТак же есть более изящное решения не создавать ненужные картинки
    отменив их. Нужно просто перед загрузкой получить все размеры и ненужные удалить
    по их названию (thumbnail, medium, large). В вашем случаи нужно не создавать первые
    два:\r\n\r\n<code>function sp_image_sizes($sizes) {\r\n    unset( $sizes['thumbnail']);\r\n
    \   unset( $sizes['medium']);\r\n    return $sizes;\r\n}\r\nadd_filter('intermediate_image_sizes_advanced',
    'sp_image_sizes');<&#47;code>\r\n\r\nВсё это пихаем в <em>functions.php<&#47;em>
    и наслаждаемся."
- id: 133160
  author: Иван
  author_email: popekka@mail.ru
  author_url: ''
  date: '2013-01-12 16:58:51 +0400'
  date_gmt: '2013-01-12 12:58:51 +0400'
  content: "<code>function sp_delete_fullsize( $data ) {\r\n    $uploadDir = wp_upload_dir();\r\n
    \   unlink(trailingslashit( $uploadDir['basedir'] ) . $data['file']);\r\n    return
    $data;\r\n}\r\nadd_filter( 'wp_generate_attachment_metadata', 'sp_delete_fullsize'
    );<&#47;code>\r\n\r\nздесь есть два минуса\r\n1. Если загружать картинку заведомо
    меньшую то она удалится, так как мы удаляем full size image (ведь она загружается
    в полноразмерном варианте)\r\n\r\n2. В менеджере файлов отображаются загруженные
    полноразмерные картинки. если полноразмер удалить и оставить только 622 то в менеджере
    медиафайлов будет отображатся пустой квадрат, что правда никак не повлияет на
    отображение картинки в самом посте, ведь туда то мы вставляем 622.\r\n\r\nТак
    вот у меня мысль по поводу этого такова: \r\n\r\n1. перед загрузкой ресайзнуть
    изображение до нужного, если оно больше \r\n2. оставить как есть картинки меньшего
    размера\r\n\r\nи соответственно не создавать картинки других размеров:\r\n<code>\r\nfunction
    sp_image_sizes($sizes) {\r\n    unset( $sizes['thumbnail']);\r\n    unset( $sizes['medium']);\r\n
    \   unset( $sizes['large']);\r\n    return $sizes;\r\n}\r\nadd_filter('intermediate_image_sizes_advanced',
    'sp_image_sizes');\r\n<&#47;code>\r\nтак у нас будет загружаться только файлы
    полного размера\r\n\r\nтеперь спросим у уважаемого SlowProg какие зацепки и какую
    функцию использовать перед загрузкой для ресайза до заданного размера заведомо
    большей картинки а меньшей оставить как есть)))"
- id: 133182
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-01-12 18:20:39 +0400'
  date_gmt: '2013-01-12 14:20:39 +0400'
  content: "Хах, хм... ммм... эм... Ну то что они не отображаются в админке - это
    необходимая жертва. Это пифиг. А вот на счет второй проблемы, то тут можно поступить
    очень просто: функция <em>sp_image_sizes<&#47;em> останется как и была (large
    будет создаваться), а в функции <em>sp_delete_fullsize<&#47;em> мы будем проверять
    не является ли полноразмерная картинка единственной в своем роде и если нет, то
    удалим, в противном случае не трогаем её. Вторая функция изменится следующим образом:\r\n<code>function
    sp_delete_fullsize( $data ) {\r\n\tif (!empty($data['sizes'])) {\r\n\t\t$uploadDir
    = wp_upload_dir();\r\n\t\tunlink(trailingslashit( $uploadDir['basedir'] ) . $data['file']);\r\n\t}\r\n
    \   return $data;\r\n}\r\nadd_filter( 'wp_generate_attachment_metadata', 'sp_delete_fullsize'
    );<&#47;code>"
- id: 133216
  author: Иван
  author_email: popekka@mail.ru
  author_url: ''
  date: '2013-01-12 21:01:37 +0400'
  date_gmt: '2013-01-12 17:01:37 +0400'
  content: а не подскажете какая функция отвечает за загрузку изображений? хочется
    все-таки к ней сделать зацепку и перед ней запустить функцию ресайза изображения
    а потом уже загрузить
- id: 133238
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-01-12 22:45:07 +0400'
  date_gmt: '2013-01-12 18:45:07 +0400'
  content: "В поисках данного фильтра покопайтесь <a href=\"http:&#47;&#47;codex.wordpress.org&#47;Plugin_API&#47;Filter_Reference\"
    rel=\"nofollow\">тут<&#47;a>. \r\n\r\nНо никакого резайза перед загрузкой быть
    не может. Я же говорил уже, что для того чтобы ресайзить в начале картинку залить
    нужно, иначе ресайзить будет нечего."
- id: 134125
  author: Павел
  author_email: chusovitin@gmail.com
  author_url: http://rblogger.ru
  date: '2013-01-20 21:59:46 +0400'
  date_gmt: '2013-01-20 17:59:46 +0400'
  content: "Добрый день.\r\n\r\nА нет способа создавать для каждого поста свою папку
    с изображениями?"
- id: 134136
  author: Павел
  author_email: chusovitin@gmail.com
  author_url: http://rblogger.ru
  date: '2013-01-21 00:06:48 +0400'
  date_gmt: '2013-01-20 20:06:48 +0400'
  content: Все, нашел плагин крутой - Custom Upload Dir
- id: 135407
  author: Olunka
  author_email: olunka-com@ya.ru
  author_url: http://www.olunka.ru/
  date: '2013-01-31 05:55:26 +0400'
  date_gmt: '2013-01-31 01:55:26 +0400'
  content: А вывести загрузки на отдельный домен в новой версии вордпресса там и не
    удалось?
- id: 135433
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-01-31 13:00:25 +0400'
  date_gmt: '2013-01-31 09:00:25 +0400'
  content: Если честно, то я не пытался. Руки не доходят. Нет у меня проектов на WP,
    где нужно это сделать. Если вдруг появятся такие проекты или руки на локалке дойдут
    это сделать, то я оповещу и статью обновлю =))) Но галочку в голове поставлю,
    что как-нибудь этим надо заняться =)
- id: 135789
  author: Otshelnik-fm
  author_email: Otshelnik-Fm@yandex.ru
  author_url: http://beoff.ru
  date: '2013-02-04 01:36:57 +0400'
  date_gmt: '2013-02-03 21:36:57 +0400'
  content: "Я как-то избавлялся от дублей нарзанных картинок - дело в том что они
    создаются вида: <strong>название-162x162.jpg<&#47;strong> - то есть размер пишется
    в имя картинки. \r\n\r\nИ вот в тотал коммандер есть удобная кнопка ctrl+b разворачивает
    все подпапки. Я зашел в папку uploads и нажав сочетание клавиш получил все файлы
    одним списком. Затем воспользовался простой маской (в тотал командере: выделение
    - выделить группу ) *162x162.jpg и выделил все ненужные файлы. Смело их удалил.
    Ну а затем админка-> параметры -> медиафайлы и удалил \"Размер миниатюры: Ширина
    [0] Высота [0]\"\r\n\r\nБольше у меня миниатюры этого размера найдены небыли (а
    удалил я более 2000 джипегов и освободил себе места)"
- id: 135973
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-02-04 18:33:40 +0400'
  date_gmt: '2013-02-04 14:33:40 +0400'
  content: Отличная идея! Возьму на заметку и другие думаю тоже =)
- id: 136794
  author: Иван
  author_email: popekka@mail.ru
  author_url: ''
  date: '2013-02-10 22:55:45 +0400'
  date_gmt: '2013-02-10 18:55:45 +0400'
  content: "Здравствуйте! Это снова я. Есть идея(возможно для вас новый пост) но мозгов
    не хватает.\r\nСуть вот в чем. хочу каждое изображение поста завернуть в , чтобы
    поверх изображения потом выводить слой с соц кнопками\"поделиться\" при наведении,
    и плюсом еще пронумеровать картинки в посте. \r\nделаю так:\r\n<code>  add_filter(
    'the_content' , 'img_in_div' );\r\n\r\nfunction img_in_div($content) {\r\nglobal
    $post;\r\n$num = 1;\r\n$attachments = get_children(array('post_parent' => $post->ID,\r\n'post_status'
    => 'inherit',\r\n'post_type' => 'attachment',\r\n'post_mime_type' => 'image',\r\n'order'
    => 'ASC',\r\n'orderby' => 'menu_order ID'));\r\n\tforeach($attachments as $attachments)
    {\r\n\t\t$full_img_url = wp_get_attachment_url($attachment->ID);\r\n\t\t$content
    .= '<div class=\"block_img\"><p>'.$num.'<&#47;p>';\r\n\t\t$content .= '<a href=\"'.$full_img_url.'\"
    title=\"'.$attachment->post_title.'\" target=\"_blank\"><img src=\"'.$full_img_url.'\"
    &#47;><&#47;a>';\r\n\t\t$content .= '<div class=\"block_social\">СОЦ,КНОПКЕ БЛЕАТЬ!!!<&#47;div><&#47;div>';\r\n\t\t$num++;\r\n\t}\r\nreturn
    $content;\r\n}<&#47;code>\r\n\r\nно при этом получается так, идет весь контент
    с картинками, а потом после этого уже DIV'ы, их число равно количеству картинок.
    понимаю что я беру весь контент а потом еще к нему прибавляю дивы, а как поменять
    аттачи на аттачи завернутые в див?\r\n\r\nтобишь мне нужно взять аттачмент, проверить
    картинка ли он, и заменить его на <code><div>аттачмент<&#47;div><&#47;code>. что-то
    я совсем видимо делаю не так, подскажите может я совсем не в том направлении двигаюсь
    и проще сделать например jquery?"
- id: 136795
  author: Иван
  author_email: popekka@mail.ru
  author_url: ''
  date: '2013-02-10 23:01:46 +0400'
  date_gmt: '2013-02-10 19:01:46 +0400'
  content: может Jquery просто как-то к классу SCC "post img" прицепиться и показывать
    заранее созданную форму? ато получается надо "взрывать" весь контент и заменять
    в нем нужное
- id: 136830
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-02-11 20:24:05 +0400'
  date_gmt: '2013-02-11 16:24:05 +0400'
  content: |-
    Всё зависит от того на кого вы хотите нагрузку дать. Если на клиента (браузер), то подключайте jquery. Если на свой сервер, то делайте через хуки. Если я вас правильно понял. Вы хотите обернуть все изображения именно в посте, а не на отдельных страницах для прикрепленных изображений? Если первое, то я вижу решение только через регулярное выражение:
    <code>function sp_wrap_images($content){
        return preg_replace('&#47;<img (.*) \&#47;>\s*&#47;iU', '<div class="block_img"><img \1 &#47;><div class="block_social">кнопки<&#47;div><&#47;div>', $content);
    }
    add_filter('the_content', 'sp_wrap_images');<&#47;code>
- id: 136847
  author: Otshelnik-fm
  author_email: Otshelnik-Fm@yandex.ru
  author_url: http://beoff.ru
  date: '2013-02-12 00:28:28 +0400'
  date_gmt: '2013-02-11 20:28:28 +0400'
  content: Хотите сделать как картинки в одноклассниках? или в вконтакте. Интересно
    было бы узнать про это. С учетом того что картинки публикуется не каждая на отдельной
    странице, а миниатюры с ссылками на полную версию
- id: 136897
  author: Иван
  author_email: popekka@mail.ru
  author_url: ''
  date: '2013-02-12 17:21:50 +0400'
  date_gmt: '2013-02-12 13:21:50 +0400'
  content: весь кодекс перерыл а в итоге не нашел, спасибо за подсказку <code>preg_replace<&#47;code>
    это именно то что нужно! огромнейщий сэнькс!
- id: 136898
  author: Иван
  author_email: popekka@mail.ru
  author_url: ''
  date: '2013-02-12 17:25:38 +0400'
  date_gmt: '2013-02-12 13:25:38 +0400'
  content: ну как показывать картинки миниатюрами это на каждом втором сайте о WP
    есть если поискать, я же хочу сделать чтобы пользователь мог поделится картинкой
    из поста а не всем постом целиком.
- id: 136910
  author: Иван
  author_email: popekka@mail.ru
  author_url: ''
  date: '2013-02-12 20:48:46 +0400'
  date_gmt: '2013-02-12 16:48:46 +0400'
  content: все замечательно но есть одно !НО!, таким методом пронумировать картинки
    не получится
- id: 136912
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-02-12 21:15:28 +0400'
  date_gmt: '2013-02-12 17:15:28 +0400'
  content: 'Если это принципиально, то можно jquery подключить, думаю подойдет функция
    each. Хотя думаю и средствами WordPress можно обойтись. Я не скажу как, но скажу
    в какую сторону копать: <a href="http:&#47;&#47;php.net&#47;manual&#47;ru&#47;class.domdocument.php"
    rel="nofollow">DOMDocument<&#47;a>. Этот класс позволит парсить контент довольно
    быстро. Грубо говоря, нужно взять весь контент, получить все картинки, обернуть
    их, подсчитать и вернуть исправленный контнт. Гуглите, читайте, изучайте, пробуйте
    и может чего сделаете =)'
- id: 136919
  author: Иван
  author_email: popekka@mail.ru
  author_url: ''
  date: '2013-02-12 23:16:10 +0400'
  date_gmt: '2013-02-12 19:16:10 +0400'
  content: И как всегда спасибо!
- id: 147598
  author: Анатолий
  author_email: anatliyvereshagin@gmail.com
  author_url: ''
  date: '2013-04-18 11:44:37 +0400'
  date_gmt: '2013-04-18 07:44:37 +0400'
  content: Подскажите, а как вместо id юзера получить title поста в который загружается
    фото?
- id: 147607
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-04-18 12:52:48 +0400'
  date_gmt: '2013-04-18 08:52:48 +0400'
  content: "Код, который будет помещать загруженные картинки в отдельную попку для
    каждого поста выглядит следующим образом:\r\n<code>add_filter('upload_dir', 'sp_upload_dir');\r\n\r\nfunction
    sp_upload_dir($upload) {\r\n\tif (isset($_REQUEST['post_id'])) { \r\n\t\t$id =
    $_REQUEST['post_id'];\r\n\t\t$post = get_post($id);\r\n\r\n        $upload['subdir']=\"&#47;\".$post->post_title;\r\n\t\t$upload['path']
    = substr($upload['path'], 0, strlen($upload['path'])-8) . $upload['subdir'];\r\n\t\t$upload['url']
    = substr($upload['url'], 0, strlen($upload['url'])-8) . $upload['subdir'];\r\n
    \   }\r\n    return $upload;\r\n}<&#47;code>\r\nСоответственно в переменной <em>$post<&#47;em>
    лежат все данные о посте, можно поизвращаться как душе угодно."
- id: 147611
  author: Анатолий
  author_email: anatliyvereshagin@gmail.com
  author_url: ''
  date: '2013-04-18 13:36:51 +0400'
  date_gmt: '2013-04-18 09:36:51 +0400'
  content: Ты гений! Спасибо
- id: 150126
  author: Николай
  author_email: 561054@bk.ru
  author_url: ''
  date: '2013-04-26 11:44:58 +0400'
  date_gmt: '2013-04-26 07:44:58 +0400'
  content: "Хорошие фишки.\r\nА не подскажите, как можно менять имя файла?\r\nА то
    пользователи загружают файлы с совершенно невероятными именами."
- id: 150131
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-04-26 12:01:00 +0400'
  date_gmt: '2013-04-26 08:01:00 +0400'
  content: |-
    Этот код будет давать всем файлам уникальные имена с помощью PHP-функции md5():

    <code>function sp_filename_md5($filename) {
        $info = pathinfo($filename);
        $ext  = empty($info['extension']) ? '' : '.' . $info['extension'];
        $name = basename($filename, $ext);
        return md5($name) . $ext;
    }
    add_filter('sanitize_file_name', 'sp_filename_md5', 10);<&#47;code>
- id: 150134
  author: Николай
  author_email: 561054@bk.ru
  author_url: ''
  date: '2013-04-26 12:32:04 +0400'
  date_gmt: '2013-04-26 08:32:04 +0400'
  content: "Спасибо большое. Принцип понятен.\r\nВместо md5 хэша буду свои уникальные
    имена делать"
- id: 159947
  author: Павел
  author_email: mrsusua@gmail.com
  author_url: ''
  date: '2013-05-24 19:48:22 +0400'
  date_gmt: '2013-05-24 15:48:22 +0400'
  content: Здравствуйте! Подскажите пожалуйста функцию, чтобы все прикрепленные файлы
    (mp3) из рубрики с ID5 сыпались в одну папку. Буду крайне и неимоверно признателен!
- id: 160112
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-05-25 01:14:02 +0400'
  date_gmt: '2013-05-24 21:14:02 +0400'
  content: Рекомендую пользоваться поиском при возникновении подобных вопросов. Вот
    к примеру 30 секунд гугления привели меня <a href="http:&#47;&#47;wordpress.stackexchange.com&#47;questions&#47;47415&#47;change-upload-directory-for-pdf-files"
    rel="nofollow">сюда<&#47;a>. Надеюсь по аналогии сможете сделать. Удачи. Пользуйтесь
    гуглом =)
- id: 160785
  author: Павел
  author_email: mrsusua@gmail.com
  author_url: ''
  date: '2013-05-25 22:27:13 +0400'
  date_gmt: '2013-05-25 18:27:13 +0400'
  content: Оперативно. Благодарю. Приятно когда человек действительно занимается своим
    блогом не для галочки а для помощи людям. Подпишусь на обновления.
- id: 160890
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-05-26 01:15:59 +0400'
  date_gmt: '2013-05-25 21:15:59 +0400'
  content: "Не за что, рад подсобить, когда есть время =))))\r\n\r\nPS: если есть
    возможность, то можете подписаться на <a href=\"http:&#47;&#47;vk.com&#47;itecka\"
    rel=\"nofollow\">падблик ВКонтакте<&#47;a>. Там я и анонсы статей выкидываю и
    много чего интересного из мира интернет-технологий, да и вообще много чего другого
    =)"
- id: 196558
  author: Сергей
  author_email: sergey.avilov@gmail.com
  author_url: ''
  date: '2013-11-20 16:09:05 +0400'
  date_gmt: '2013-11-20 12:09:05 +0400'
  content: Спасибо, очень много интересных примеров, но ситуация у меня такая, что
    храниться наоборот много картинок разных размеров, отсюда появилась необходимость
    и идея как то их упорядочить, например было бы очень здорово что бы копии картинок
    хранились в отдельных папка с наименованием соответственно их типу (thumbnail,
    medium, large итд дру..) или например в папках соответственно их размерам (150x150,
    300x300, 1024x1024 итд..). Но как это сделать ума не приложу, целый день рылся
    в файлах движка...увы без результатно, такое вообще возможно? Спасибо.
- id: 196652
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-11-21 13:15:29 +0400'
  date_gmt: '2013-11-21 09:15:29 +0400'
  content: Думаю данная задача не имеет простого решения. В примере из статьи загружается
    файл до создания различных размеров. А размеры соответственно создаются уже там,
    где основной файл лежит. Думаю можно как-то перехватить создание размеров и их
    уже раскидать по папкам, но при этом генерация ссылки на различные размеры так
    же должна быть переписана с учётом новой иерархии. Это в общем случаи. Как конкретно
    реализовывать я не знаю. Нужно копать =)
- id: 196882
  author: Сергей
  author_email: sergej.avilov@gmail.com
  author_url: ''
  date: '2013-11-23 00:39:58 +0400'
  date_gmt: '2013-11-22 20:39:58 +0400'
  content: "Ясно...спасибо что ответили! Решил использовать один из ваших примеров
    кода, пытаюсь под под себя себя...Я загружаю картинки через медиа загрузчик без
    прикрепления к посту и хочу что бы все картинки сыпались в папку с оригинальным
    id. На деле создается пустая с наименованием id, но почему то картинки туда не
    попадают, а загружаются как обычно...\r\nваот код\r\n<code>\r\nadd_filter('upload_dir',
    'sp_upload_dir');\r\n\r\nfunction sp_upload_dir($upload) {\r\n    if (isset($_REQUEST['attachment_id']))
    {\r\n        $id = $_REQUEST['attachment_id'];\r\n\r\n        $upload['subdir']=
    \"&#47;\" . $id ;\r\n        $upload['path'] = \"&#47;\" . $id ;\r\n        $upload['url']
    = \"&#47;\" . $id ;\r\n    }\r\n    return $upload;\r\n}\r\n<&#47;code>"
- id: 197409
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-11-23 15:10:20 +0400'
  date_gmt: '2013-11-23 11:10:20 +0400'
  content: "Точно не понял вашу проблему, но вижу несостыковку в коде. <em>$_REQUEST['attachment_id']<&#47;em>
    не существует. И вообще, при загрузке картинки массив <em>$_REQUEST<&#47;em> содержит
    примерно следующие элементы:\n<code>Array\n(\n    [name] => name_of_pic.png\n
    \   [post_id] => 0\n    [_wpnonce] => ff8a3a527d\n    [type] => \n    [tab] =>
    \n    [short] => 1\n)<&#47;code>\nКак видите <em>attachment_id<&#47;em> нет. Но
    прошу обратить внимание на <em>post_id<&#47;em>. Если загружается через пост,
    то эта картинка сразу к нему цепляется и этот элемент массива содержит идентификатор
    поста. Если загружается через медиафайлы без прикрепления к посту, то этот элемент
    содержит 0 (как в примере выше). Соответственно, если вы бы использовали мой код
    выше (что в <a href=\"#div-comment-147607\" rel=\"nofollow\">комментариях<&#47;a>),
    то все не прикреплённые картинки складывались бы в папку с id = 0. \n\nВот. Дальше
    думайте сами. Если что, то спрашивайте, но лучше чтобы с примером кода =)"
- id: 197437
  author: Сергей
  author_email: sergej.avilov@gmail.com
  author_url: ''
  date: '2013-11-23 16:10:27 +0400'
  date_gmt: '2013-11-23 12:10:27 +0400'
  content: Огромное спасибо! Не ожидал такого оперативного ответа, будем думать))
    Блог супер!
- id: 222142
  author: Сергей
  author_email: smurzhak@ya.ru
  author_url: http://www.photoluch.com
  date: '2014-02-03 07:19:23 +0400'
  date_gmt: '2014-02-03 03:19:23 +0400'
  content: ни одному, искал долгу, нашёл у Вас, буду пробывать. Спасибо
- id: 222243
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2014-02-03 14:36:42 +0400'
  date_gmt: '2014-02-03 10:36:42 +0400'
  content: <a href="http:&#47;&#47;paperplane.su&#47;change-uploads-folder&#47;#comment-222127"
    target="_blank" rel="nofollow">Предыдущий вопрос<&#47;a> на счёт папок в другом
    посте отменяется? Просто не совсем я понля тот вопрос. Через форму создавать?
    Если да, то это будет довольно сложно и это уже будет целая гелерея. Можно легко
    создавать на основе имеющихся данных типа id пользователя, как в статье.
- id: 222510
  author: Рашида
  author_email: srgarifulina@gmail.com
  author_url: http://rashidagarifulina.ru/
  date: '2014-02-04 13:21:05 +0400'
  date_gmt: '2014-02-04 09:21:05 +0400'
  content: Сергей, я решила этот вопрос откорректировала в настройках медиафайлов
    и удалила лишние картинки плагином
- id: 246364
  author: Надежда
  author_email: gukikabasi@rambler.ru
  author_url: http://www.vkusgizni.ru
  date: '2015-01-28 20:24:38 +0300'
  date_gmt: '2015-01-28 16:24:38 +0300'
  content: Здравствуйте! Изучаю программирование сама, перевожу рукописный блог на
    вордпресс. Сижу туплю 2 дня. Нужно перенести все старые файлы в шаблон с сохранением
    пути. Скажите пожалуйста ваш код будет работать в WordPress 4.1 , и подойдет ли
    он для моих папок (сайт http:&#47;&#47;www.vkusgizni.ru) ? Может можно другой
    код выдумать, или какой плагин скачать? Прошу не кидаться сильно тапками, понимаю,
    что вопрос детский, но кроме вас спросить не у кого... Заранее спасибо за ответ!
- id: 246369
  author: Надежда
  author_email: gukikabasi@rambler.ru
  author_url: http://www.vkusgizni.ru
  date: '2015-01-28 21:43:12 +0300'
  date_gmt: '2015-01-28 17:43:12 +0300'
  content: Подскажите пожалуйста какой плагин лучше для этого скачать, или где почитать,
    что именно вставить в php чтобы сохранить путь папок, какой был раньше до перехода
    на вордпресовский шаблон 4.1 ???
- id: 246715
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2015-02-05 14:33:08 +0300'
  date_gmt: '2015-02-05 10:33:08 +0300'
  content: Не совсем понимаю о чём речь. Наверно об этом <a href="https:&#47;&#47;wordpress.org&#47;plugins&#47;wp-original-media-path&#47;"
    rel="nofollow">плагине<&#47;a>? А что сам код для 4.1 не работает, не пробовали?
- id: 252502
  author: gurik
  author_email: 1751984@gmail.com
  author_url: http://world-life.info
  date: '2015-07-13 20:38:26 +0300'
  date_gmt: '2015-07-13 16:38:26 +0300'
  content: Спасибо за первый сниппет!
- id: 269409
  author: Валерий
  author_email: wgcenter-reg1@yahoo.com
  author_url: ''
  date: '2016-02-12 00:27:12 +0300'
  date_gmt: '2016-02-11 20:27:12 +0300'
  content: "Подскажите, а можно ли сделать так, чтоб картинки при необходимости загрузились
    в конкретную папку?\r\nТ.е. вот если сейчас (февраль 2016) грузить их, то WordPress
    создаст папку &#47;upload&#47;2016&#47;02&#47; и кинет файлы туда, а нужно, чтоб
    он закинул скажем в существующую уже папку &#47;upload&#47;2014&#47;11&#47;\r\nИли,
    во втором случае - в новую папку с конкретным именем, скажем &#47;upload&#47;test&#47;"
- id: 275727
  author: Alexy
  author_email: ifaton@mail.ru
  author_url: ''
  date: '2016-05-23 23:10:22 +0300'
  date_gmt: '2016-05-23 19:10:22 +0300'
  content: "Zdravsvuyte, ya poproboval vash perviy variant s functions.php no ne srabotol...
    pomogite pojaluysta. ya xochu chtobi kogda ya galochku stavlyu na worpdresse media
    settings \"Organize my uploads into month- and year-based folders\" bilo\r\n&#47;uploads&#47;2016&#47;05&#47;01
    to est chto bil dobavlen i den &#47;god&#47;mesyac&#47;den\r\ngde kakoy file nado
    menyat? chto gde nado dobavit..? spasibo..budu ochen rad esli pomojete..ya plugini
    proboval \"Custom upload dir\" no etot mne ne pomog... ya vruchnuyu xochu pomenyat
    kod... jdu vashego pomosha..spasibo"
- id: 276384
  author: Alexy
  author_email: ifaton@mail.ru
  author_url: ''
  date: '2016-05-31 16:20:38 +0300'
  date_gmt: '2016-05-31 12:20:38 +0300'
  content: "Zdravsvuyte, pomogite pojaluysta. ya xochu chtobi kogda ya galochku stavlyu
    na worpdresse \"Organize my uploads into month- and year-based folders\" bilo\r\n&#47;uploads&#47;2016&#47;05&#47;01
    to est chto bil dobavlen i den &#47;god&#47;mesyac&#47;den\r\ngde kakoy file nado
    menyat? chto gde nado dobavit..? spasibo..budu ochen rad esli pomojete..ya plugini
    proboval \"Custom upload dir\" no etot mne ne pomog... ya vruchnuyu xochu pomenyat
    kod..ya znayu chto posle wordpress update mojet izchesnut ..no potom eshe raz
    ispravlu... jde vashego pomosha..spasibo"
- id: 277279
  author: Alexey
  author_email: ifaton@mail.ru
  author_url: ''
  date: '2016-06-12 03:59:05 +0300'
  date_gmt: '2016-06-11 23:59:05 +0300'
  content: "hello, thanks for your post&hellip;\r\nis there any way to change in code
    and make it when you click(enable) &ldquo;Organize my uploads into month- and
    year-based folders. &rdquo; it to be default year&#47;month&#47;day &hellip;&hellip;&hellip;
    without any plugin.. Can anyone find for this solution please..?\r\n\r\nthank
    you in advance"
- id: 282005
  author: Sheff
  author_email: zeusmax@mail.ru
  author_url: http://design.sheffart.com
  date: '2016-08-08 09:20:54 +0300'
  date_gmt: '2016-08-08 05:20:54 +0300'
  content: Добрый день. Все никак не могу найти в интернете информации по следующему
    вопросу (может вы сможете помочь) &ndash; может я немного параноик, но ищу путь
    помимо изображений из тела постов перенести в облако еще и миниатюры, так как
    в перспективе потом с хостинга на хостинг перекидывать гигабайт, а то и больше,
    не совсем прикольно. Простого способа не нашел. Есть способ правки шаблонов на
    загрузку изображений по определенному пути. Нашел в шаблоне, где вставляется пост.
    И в functions.php нашел блок кода про thumbnails. Куда дальше копать, не представляю.
- id: 282098
  author: Sheff
  author_email: zeusmax@mail.ru
  author_url: http://design.sheffart.com
  date: '2016-08-09 05:31:30 +0300'
  date_gmt: '2016-08-09 01:31:30 +0300'
  content: Вы так помогаете, подтирая комментарии?
- id: 282099
  author: Sheff
  author_email: zeusmax@mail.ru
  author_url: http://design.sheffart.com
  date: '2016-08-09 05:32:18 +0300'
  date_gmt: '2016-08-09 01:32:18 +0300'
  content: Ниче не пойму. То нет комментария, то есть. Думал, вы удалили его.
- id: 291359
  author: Сергей
  author_email: sergey.gronov@tut.by
  author_url: ''
  date: '2016-11-17 20:58:46 +0300'
  date_gmt: '2016-11-17 16:58:46 +0300'
  content: Буду очень благодарен, если подскажете функцию как создавать папку для
    загрузки изображений, при этом чтобы имя папки формировалось автоматически и было
    уникальным
---
<p>В WordPress можно <strong>изменить папку загрузки файлов<&#47;strong> с помощью небольшой функции в <em>functions.php<&#47;em>. Стандартно загружаемые файлы распихиваются по папкам <em>год &#47; месяц<&#47;em>, но подобная структура может быть не во всех случаях удобна. Её можно легко изменить. Например, сделать структуру <em>год &#47; месяц &#47; день<&#47;em>. Это можно сделать простым сниппетом (добавить в <em>functions.php<&#47;em>):<br />
[cce lang="php"]<br />
add_filter('upload_dir', 'sp_upload_dir');</p>
<p>function sp_upload_dir($upload) {<br />
	$time = current_time( 'mysql' );<br />
	$day = substr( $time, 8, 2 );<br />
	$upload['subdir'] .= "&#47;" . $day;<br />
	$upload['path'] .= "&#47;" . $day;<br />
	$upload['url'] .= "&#47;" . $day;<br />
	return $upload;<br />
}<br />
[&#47;cce]<br />
Если вы не знаете как вставлять код или у вас возникли проблемы с этим, то читайте статью <a href="http:&#47;&#47;paperplane.su&#47;insert-functions-wordpress&#47;" title="Вставка кода в functions.php" target="_blank">вставка кода в functions.php<&#47;a>.</p>
<p>Всё просто: получаем дату, вырезаем из нее день и прикрепляем его к адресу загрузки. Как вы могли заметить массив <em>$upload<&#47;em> и содержит адрес загрузки в различных варианта (потому в 3х местах дополняем). Чтобы вы понимали с чем имеете дело я покажу стандартную структуру этого массива на примере:<br />
[cce lang="text"]<br />
Array (<br />
	[path] => &#47;www&#47;wordtest&#47;wp-content&#47;uploads&#47;2013&#47;01<br />
	[url] => http:&#47;&#47;wordtest&#47;wp-content&#47;uploads&#47;2013&#47;01<br />
	[subdir] => &#47;2013&#47;01<br />
	[basedir] => &#47;www&#47;wordtest&#47;wp-content&#47;uploads<br />
	[baseurl] => http:&#47;&#47;wordtest&#47;wp-content&#47;uploads<br />
	[error] =><br />
)<br />
[&#47;cce]<br />
Теперь, я думаю, вам стало понятно почему я именно <em>path<&#47;em>, <em>url <&#47;em>и <em>subdir<&#47;em> дополняю. </p>
<p>В принципе, если мысль пойдет дальше, то можно еще изощренней. Например, пусть будет по годам-месяцам, но чтобы для каждого пользователя была отдельная папка. Всё что нам нужно это узнать идентификатор пользователя и загружать в папку названную в честь его идентификатора:<br />
[cce lang="php"]<br />
add_filter('upload_dir', 'sp_upload_dir');</p>
<p>function sp_upload_dir($upload) {<br />
	global $user_ID;<br />
	if ((int)$user_ID > 0) {<br />
		$upload['subdir'] .= "&#47;" . $user_ID;<br />
		$upload['path'] .= "&#47;" . $user_ID;<br />
		$upload['url'] .= "&#47;" . $user_ID;<br />
	}<br />
	return $upload;<br />
}<br />
[&#47;cce]<br />
Примерно так. Особо не отличается от предыдущего. Но это далеко не всё, можно переделывать конечную структуры папки загрузки, как душе угодно. Например, вообще отказаться от раскладки по дате, и сделать свою уникальную структуру. Я особо извращаться не буду и применю всё тот же идентификатор пользователя, но теперь все картинки каждого пользователя будут храниться только в одной папке (без даты):<br />
[cce lang="php"]<br />
add_filter('upload_dir', 'sp_upload_dir');</p>
<p>function sp_upload_dir($upload) {<br />
	global $user_ID;<br />
	if ((int)$user_ID > 0) {<br />
		$upload['subdir'] = "&#47;" . $user_ID;<br />
		$upload['path'] = substr($upload['path'], 0, strlen($upload['path'])-8) . $upload['subdir'];<br />
		$upload['url'] = substr($upload['url'], 0, strlen($upload['url'])-8) . $upload['subdir'];<br />
	}<br />
	return $upload;<br />
}<br />
[&#47;cce]<br />
Всё так же просто: я отрезаю последние 8 символов у <em>path<&#47;em> и <em>url<&#47;em> и заменяю их на идентификатор пользователя. Ведь именно 8 символов занимает строка вида <em>&#47;гггг&#47;мм<&#47;em>.</p>
<p>Надеюсь этого вам хватит для того, чтобы придумать свою уникальную структуру загрузки файлов в WordPress для каких-то там ваших коварных целей. А на сегодня всё! Всем удачи!</p>
<p>PS: в комментариях ещё есть варианты того, как можно генерировать папку для загружаемых файлов.</p>

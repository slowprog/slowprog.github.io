---
layout: post
status: publish
published: true
title: WordPress - количество запросов
author:
  display_name: SlowProg
  login: seoadmin
  email: paperplanesu@rambler.ru
  url: http://paperplane.su
author_login: seoadmin
author_email: paperplanesu@rambler.ru
author_url: http://paperplane.su
wordpress_id: 2377
wordpress_url: http://paperplane.su/?p=2377
date: '2012-05-22 12:34:37 +0400'
date_gmt: '2012-05-22 08:34:37 +0400'
categories:
- Без плагина
tags:
- сниппет
- база данных
comments:
- id: 110524
  author: Fotocol
  author_email: riddicss@mail.ru
  author_url: http://fotocol.livejournal.com/
  date: '2012-11-08 15:18:48 +0400'
  date_gmt: '2012-11-08 11:18:48 +0400'
  content: Я помню, что такая функция есть почти на всех блоговых движках, а у некоторых
    это можно смотреть у настройках. Но это наверно мало кого интересует.
- id: 110525
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-08 15:21:58 +0400'
  date_gmt: '2012-11-08 11:21:58 +0400'
  content: Ну не знаю, очень даже наоборот. Примерно каждый второй блог на который
    я захожу (те что на WordPress) в футуре обладают этими заветными циферками =)
- id: 111835
  author: Olunka
  author_email: olunka-com@yandex.ru
  author_url: http://www.olunka.ru/
  date: '2012-11-12 00:41:58 +0400'
  date_gmt: '2012-11-11 20:41:58 +0400'
  content: А я вижу у вас в футере эту информацию, несмотря на то, что не являюсь
    зарегистрированным пользователем.
- id: 111837
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-12 00:48:28 +0400'
  date_gmt: '2012-11-11 20:48:28 +0400'
  content: А я её и не скрывал, но раз так то скрою =Р
- id: 111861
  author: Olunka
  author_email: olunka-com@yandex.ru
  author_url: http://www.olunka.ru/
  date: '2012-11-12 01:33:30 +0400'
  date_gmt: '2012-11-11 21:33:30 +0400'
  content: "А я ее уже запомнила.\r\n\r\nСпасибо за ваш сайт, сколько ищу полезной
    информации в поисковике, всегда на вашем сайте останавливаюсь, как на самом качественном
    источнике ответом на мои вопросы по веб-мастерингу."
- id: 111864
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-12 01:36:42 +0400'
  date_gmt: '2012-11-11 21:36:42 +0400'
  content: Оу! Спасибо за такие замечательные слова, их мне иногда не хватает =)
- id: 111876
  author: Olunka
  author_email: olunka-com@yandex.ru
  author_url: http://www.olunka.ru/
  date: '2012-11-12 01:57:29 +0400'
  date_gmt: '2012-11-11 21:57:29 +0400'
  content: А каким плагином вы выводите код?
- id: 111880
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-12 02:04:25 +0400'
  date_gmt: '2012-11-11 22:04:25 +0400'
  content: Каким то отстойным плагином =) Пора бы его уже сменить =) А то он обновился
    и перестал мне номер строк выводить. А вообще я использую <em>Auto SyntaxHighlighter<&#47;em>.
- id: 111892
  author: Olunka
  author_email: olunka-com@yandex.ru
  author_url: http://www.olunka.ru/
  date: '2012-11-12 02:29:03 +0400'
  date_gmt: '2012-11-11 22:29:03 +0400'
  content: А мне все варианты SyntaxHighlighter не нравятся, я пользуюсь WP-Syntax,
    рекомендую.
- id: 111894
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-12 02:30:55 +0400'
  date_gmt: '2012-11-11 22:30:55 +0400'
  content: Но с вашей подачи я наконец то начал переход на другой плагин, который
    мне нравится <em>CodeColorer<&#47;em>. Постепенно я весь свой код подсвечу им
    =) Как он выглядит можете заценить уже в этой статье =)
- id: 111895
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-12 02:31:52 +0400'
  date_gmt: '2012-11-11 22:31:52 +0400'
  content: Вот что-то в WP-Syntax мне тоже не подуше =) Нееее, код понятный и очень
    красивый..... но какойто не кодерский =)))))
- id: 111915
  author: Olunka
  author_email: olunka-com@yandex.ru
  author_url: http://www.olunka.ru/
  date: '2012-11-12 03:06:18 +0400'
  date_gmt: '2012-11-11 23:06:18 +0400'
  content: Мне чисто визуально не очень нравится. Контрастность фона самого кода и
    нумерации строк раздражает.
- id: 111916
  author: Olunka
  author_email: olunka-com@yandex.ru
  author_url: http://www.olunka.ru/
  date: '2012-11-12 03:07:25 +0400'
  date_gmt: '2012-11-11 23:07:25 +0400'
  content: А почему мне приходят ответы на почту, хотя я никогда не ставлю галочку,
    чтобы подписаться на комментарии?
- id: 112002
  author: Olunka
  author_email: olunka-com@yandex.ru
  author_url: http://www.olunka.ru/
  date: '2012-11-12 05:38:20 +0400'
  date_gmt: '2012-11-12 01:38:20 +0400'
  content: И кстати отображение кода изменилось только на этой странице, на других
    осталось по-старому, без нумерации строк и с белым фоном.
- id: 112118
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-12 10:43:34 +0400'
  date_gmt: '2012-11-12 06:43:34 +0400'
  content: На вкус и цвет товарищей нет, но нумерация строк просто необходимая вещь.
    Я считаю без нее неприлично показывать код. Это часть синтаксиса. Например, есть
    такой старый язык <em>QBasic<&#47;em>, в синтаксисе которого прописывать нумерацию
    строк просто необходимо. Улучшается восприятие кода и ориентация в нем. Плюс в
    тексте статьи очень удобно ссылаться на номер строки при объяснение, чем на пальцах
    объяснять про какую часть идет речь.
- id: 112119
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-12 10:46:49 +0400'
  date_gmt: '2012-11-12 06:46:49 +0400'
  content: И это круто! Подписаться на комментарии это значит будут приходить ВСЕ
    комменты, а вам приходят только те, что являются ответами на ваши. Это необходимо
    для корректного завершения диалога. Очень часто бывает человек что-то напишет
    или спросит и забудет про это место (просто в процессе серфинга) и если ему ответят,
    то ответ просто не найдет адресата. Это плохо. А так ответы приходят в почту,
    где есть ссылочки на нужную страничку.
- id: 112120
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-12 10:50:00 +0400'
  date_gmt: '2012-11-12 06:50:00 +0400'
  content: И это понятно. Ведь я написал, что постепенно весь код подсвечу им, т.к.
    синтаксис подсвечивания различается. Из этого следует, что для замены одного синтаксиса
    на другой нужно либо вручную пройтись по всем статьям либо автозаменой по базе.
    Но автозамена подразумевает ручной контроль после замены, т.к. есть кое-какие
    скользкие места и для того чтобы все было хорошо нужно проверить. Потому я лучше
    просто вручную пройдусь постепенно =)
- id: 112181
  author: Olunka
  author_email: olunka-com@yandex.ru
  author_url: http://www.olunka.ru/
  date: '2012-11-12 16:33:23 +0400'
  date_gmt: '2012-11-12 12:33:23 +0400'
  content: "Так я о необходимости нумерации строк не спорю. я только за нумерацию.\r\nМне
    кажется не очень комфортно для восприятия то, что нумерация имеет отличный от
    основного кода фон."
- id: 112182
  author: Olunka
  author_email: olunka-com@yandex.ru
  author_url: http://www.olunka.ru/
  date: '2012-11-12 16:35:06 +0400'
  date_gmt: '2012-11-12 12:35:06 +0400'
  content: "Ааа, ну да, у тебя все не запросто.\r\nЯ то, по-старинке, подумала, что
    плагин сменил и код везде автоматически поменялся."
- id: 112207
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-12 20:06:34 +0400'
  date_gmt: '2012-11-12 16:06:34 +0400'
  content: Хотя конечно моно написать код который всё автоматом прогонит, но мне так
    лень. Я лучше на протяжении года подменю весь код.... или нет =)
- id: 112208
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-12 20:08:10 +0400'
  date_gmt: '2012-11-12 16:08:10 +0400'
  content: Ага, ну на вкус и цвет... опять же. Да и к тому же сменить фон циферок
    это пару строк в стилях.
- id: 120270
  author: Димыч
  author_email: ls777d7@gmail.com
  author_url: http://kurs7.ru/
  date: '2012-11-23 17:38:29 +0400'
  date_gmt: '2012-11-23 13:38:29 +0400'
  content: "Спасибо большое! \r\nЗанёс Ваш блок себе  в закладки в папку - нужные
    и полезные . На Вашем блоге очень много ценнейшей для меня информации ."
- id: 120272
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-23 17:44:21 +0400'
  date_gmt: '2012-11-23 13:44:21 +0400'
  content: Не за что! Буду впредь писать полезные статейки. И лучше подписывайтесь
    ВКонтакте, будет всегда свежак ;)
- id: 120413
  author: Димыч
  author_email: ls7779197@gmail.com
  author_url: http://kurs7.ru/
  date: '2012-11-24 02:29:08 +0400'
  date_gmt: '2012-11-23 22:29:08 +0400'
  content: Уже подписался ))) Анонсы Ваших статей буду на почту получать, полдня наверно
    у Вас на блоге просидел... с чем смог справиться то сразу у себя и применил)))
    Теперь вот тему оптимизирую, правда она у меня не совсем шаблонная, в Artisteere3
    делал, но  всё подходит. Только один раз пришлось функцию обратно возвращать.
- id: 120603
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-24 07:19:48 +0400'
  date_gmt: '2012-11-24 03:19:48 +0400'
  content: Артистир - это зло, по мне. Он делает супер-много блоков, да еще вроде
    бы свои невалидные теги какие то ставит. Лично я такие шаблоны не очень люблю.
    Но смотрите сами, если в нем ориентируетесь, то проблем нет - юзайте.
- id: 120692
  author: Димыч
  author_email: ls7779197@gmail.com
  author_url: http://kurs7.ru/
  date: '2012-11-24 10:06:09 +0400'
  date_gmt: '2012-11-24 06:06:09 +0400'
  content: Согласен с Вами, но ведь хочется шаблон чуток отличный от всех и подогнанный
    более удобно под себя ... .Ориентироваться то особо в нём, не ориентируюсь, ток
    где на какую кнопочку тиснуть, что бы сварганить ту или иную колонку ... Его в
    группе посоветовали. хм... может действительно стоит тогда поискать обычный, но
    более менее подходящий .
- id: 120771
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-24 13:42:04 +0400'
  date_gmt: '2012-11-24 09:42:04 +0400'
  content: Я бы вообще рекомендовал взять пустой шаблон и из него сделать, что хотите.
    Есть такие шаблоны, полностью бланковые, у них структура минимальная, что позволит
    в них быстро разобраться. Но придется мозг изрядно попарить и изучать работу шаблона
    WP, без этого никак.
- id: 120807
  author: Димыч
  author_email: ls7779197@gmail.com
  author_url: http://kurs7.ru/
  date: '2012-11-24 15:14:13 +0400'
  date_gmt: '2012-11-24 11:14:13 +0400'
  content: Хех... то то и оно, что надо хоть какими то минимальными знаниями обладать
    ... со временем, когда подучусь ... конечно так и сделаю , а пока, что ... увы
    (((
- id: 120885
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-24 20:05:03 +0400'
  date_gmt: '2012-11-24 16:05:03 +0400'
  content: Тогда я вам рекомендую поглядеть этот <a href="http:&#47;&#47;paperplane.su&#47;urok-1-osnovy-php-dlya-nachinayushhix-blogerov-wordpress&#47;"
    target="_blank" rel="nofollow">урок<&#47;a>, чтобы въехать немного в основы PHP,
    если еще не въехали ))))
---
<p><a href="http:&#47;&#47;image.paperplane.su&#47;2012&#47;04&#47;count-queries.png"><img class="alignleft size-medium wp-image-2511" title="Количество запросов" src="http:&#47;&#47;image.paperplane.su&#47;2012&#47;04&#47;count-queries-300x300.png" alt="Количество запросов" width="300" height="300" &#47;><&#47;a>WordPress обладает довольно богатым функционалам и не перестает удивлять своих пользователей, особенно начинающих. И вот на некоторых блогах под управлением WordPress самые внимательные из вас могли заметить в футере сайта некоторую информацию по типу следующей:</p>
<blockquote><p>25 запросов за 2,1 секунды<&#47;blockquote><br />
Как вы могли догадаться, это такой короткий отчет о том сколько <strong>MySQL запросов<&#47;strong> выполнилось и <strong>сколько времени<&#47;strong> для этого потребовалось при загрузке страницы. В WordPress такое довольно просто сделать, потому что он обладает всем необходимым функционалом. И чтобы заполучить у себя на блоге такое же, конечно же без плагина, необходимо добавить в нужное место (например в <em>footer.php<&#47;em> перед <em><&#47;body><&#47;em>) следующий код:<br />
[cce lang="php"]<?php<br />
	echo '<center>'.get_num_queries().' запросов за ';<br />
	timer_stop(1);<br />
	echo ' секунд<&#47;center>';<br />
?>[&#47;cce]<br />
Все довольно просто. И этот код позволит держать под контролем <strong>количество запросов в WordPress<&#47;strong>. И не забывайте, что разные страницы дадут различные результаты. Притом на некоторых результаты могут отличаться в два, три или даже больше раза. Все зависит от плагинов, которые будут задействованы на той или иной странице. Вы можете потестить одну и ту же страницу с включенным или выключенным плагином и увидеть сколько тот жрет ресурсов. Это иногда бывает важным, чтобы принять решение об использовании какого-нибудь плагина или при выборе между несколькими альтернативами.</p>
<p>Эта информация также понадобится при оптимизации базы данных. Иного способа быстро определить количество запросов в базу у вас не получится, да и он не нужен в общем. Этот кусок кода достаточно прост, чтобы использовать его.</p>
<p>Результат работы приведенного выше кода будет доступен всем кто просматривает странички и прокручивает их до самого футера. Но это положение можно исправить и, например, сделать так чтобы результат был доступен только узкому кругу лиц или вообще только одному админу. В данном мануале я продемонстрирую, как ограничить всех&nbsp;незарегистрированных&nbsp;пользователей от этой информации. В WordPress есть такая хорошая функция&nbsp;<em>is_user_logged_in<&#47;em>, которая возвращает <em>true<&#47;em>, если пользователь зарегистрирован и <em>false<&#47;em> в противном случаи. И с этой функцией у нас получается следующий код:<br />
[cce lang="php"]<?php<br />
	if (is_user_logged_in()) {<br />
		echo '<center>'.get_num_queries().' запросов за ';<br />
		timer_stop(1);<br />
		echo ' секунд<&#47;center>';<br />
	}<br />
?>[&#47;cce]<br />
Теперь количество запросов и время их исполнения будет видно только зарегистрировавшимся пользователям. А если на сайте вы всего один&nbsp;зарегистрировавшийся&nbsp;(админ), как обычно и бывает, то только вам.</p>
<p>Надеюсь этот код вам поможет в улучшении своего блога. А у меня на этом все. Пишите в комментарии свои мысли по этому поводу, может у вас какие предложения будут, не стесняйтесь. Всем удачи!</p>

---
layout: post
status: publish
published: true
title: Редирект после авторизации
author:
  display_name: SlowProg
  login: seoadmin
  email: paperplanesu@rambler.ru
  url: http://paperplane.su
author_login: seoadmin
author_email: paperplanesu@rambler.ru
author_url: http://paperplane.su
wordpress_id: 2528
wordpress_url: http://paperplane.su/?p=2528
date: '2012-05-30 22:37:08 +0400'
date_gmt: '2012-05-30 18:37:08 +0400'
categories:
- Без плагина
tags:
- сниппет
- редирект
comments:
- id: 66909
  author: bear
  author_email: griz_bear@mail.ru
  author_url: ''
  date: '2012-08-07 11:11:22 +0400'
  date_gmt: '2012-08-07 07:11:22 +0400'
  content: И куда этот "сниппет" засунуть?
- id: 66911
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-08-07 11:13:28 +0400'
  date_gmt: '2012-08-07 07:13:28 +0400'
  content: В файл вашей темы <em>functions.php<&#47;em>
- id: 137224
  author: seemoonlight
  author_email: zeebert@yandex.ru
  author_url: ''
  date: '2013-02-15 18:10:03 +0400'
  date_gmt: '2013-02-15 14:10:03 +0400'
  content: "<strong>Добрый день!<&#47;strong>\r\nСпасибо за предоставленный код! Работает
    прекрасно.\r\nНо если существует необходимость чтобы пользователи (все кроме админа),\r\nпосле
    входа, были перенаправлены не на главную страницу <strong>return home_url();<&#47;strong>
    а на ту же страницу (например пользователь просматривал какую-либо новость на
    сайте), \r\nс которой был произведен выход.\r\n\r\nЗаранее спасибо за ответ!"
- id: 137228
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-02-15 18:54:25 +0400'
  date_gmt: '2013-02-15 14:54:25 +0400'
  content: Внес изменения в статью и добавил, то что вы просили =)
- id: 137268
  author: seemoonlight
  author_email: zeebert@yandex.ru
  author_url: ''
  date: '2013-02-16 01:49:07 +0400'
  date_gmt: '2013-02-15 21:49:07 +0400'
  content: "<strong>SlowProg<&#47;strong> Спасибо!\r\nНо при таком коде\r\n<strong>return
    home_url('&#47;wp-admin&#47;');<&#47;strong> - админа перекидывает в консоль (понятно);\r\n<strong>return
    $request;<&#47;strong> - других пользователей - на главную страницу сайта (согласно
    Вашей ссылке на <a href=\"http:&#47;&#47;codex.wordpress.org&#47;Plugin_API&#47;Filter_Reference&#47;login_redirect\"
    rel=\"nofollow\">документацию<&#47;a> <strong>request<&#47;strong> - the URL the
    user is coming from). Тоесть, я так понимаю, ссылка на главную страницу сайта,
    где пользователь зарегистрировался (сайт где прописывается вышеуказанный в Вашей
    новости код) и откуда он, получается, пришел...\r\n<strong>$request <&#47;strong>
    - наверное не совсем то что нужно...\r\n\r\nНапример, я - зарегистрированный пользователь,
    авторизировался на сайте, нашел нужную мне новость для изучения. Сегодня почитал,
    вышел с сайта, и на следующий день я хочу вернуться после авторизации на туже,
    недочитанную, страницу сайта.\r\nВот что я имел ввиду.\r\n\r\nСпасибо за ответ!"
- id: 150584
  author: Игорь
  author_email: igrokxpx@yandex.ua
  author_url: ''
  date: '2013-04-27 17:21:35 +0400'
  date_gmt: '2013-04-27 13:21:35 +0400'
  content: Здравствуйте, недавно поставил форму регистрации себе на сайт и вот что
    заметил. Подписчиков, которые регестрируются на моём сайте выбрасывает после первого
    обновления страницы и ему опть приходится входить на сайт. А меня, админа не выкидывает
    из амдинки. Какова может быть причина, что не запоминает пользователей, которые
    вошли на сайт. Может плагин какой надо?!
- id: 150602
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-04-27 21:16:30 +0400'
  date_gmt: '2013-04-27 17:16:30 +0400'
  content: Вообще, всё должно работать. Думается проблемы в вашем <em>functions.php<&#47;em>.
    Там какой-то код блокирует авторизацию всех у кого нет роли администратора. Ну
    или этот код где-то в другом месте вашей темы, но обычно он в <em>functions.php<&#47;em>.
- id: 186203
  author: Timur
  author_email: gazgaz@big-team.ru
  author_url: http://newsgamesplayers.com
  date: '2013-09-24 11:25:39 +0400'
  date_gmt: '2013-09-24 07:25:39 +0400'
  content: благодарю за наводку!
- id: 186958
  author: Кеша
  author_email: aries.kote@gmail.com
  author_url: ''
  date: '2013-09-29 01:28:51 +0400'
  date_gmt: '2013-09-28 21:28:51 +0400'
  content: "Добрый вечер,\r\n\r\nвсе сделал как Вы написали, и прочитал статью как
    вставить код в functions.php.\r\nОднако ничего не работает. После того как вставил,
    пользователя все равно перенаправляет в консоль, а не на главную страницу.\r\n\r\nчто
    делать? может надо в определенное место код вставить, например в самое начало
    или в середину? Или как вариант этот код не работает с плагином Theme My Login?
    Или .....\r\n\r\nподскажите? \r\nзаранее благодарен."
- id: 186960
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-09-29 01:55:35 +0400'
  date_gmt: '2013-09-28 21:55:35 +0400'
  content: Думаю плагин виноват. Попробуйте без него. Хотя может в этом виноваты последние
    обновления WordPress. Давно не проверял. Но попробуйте без плагина.
- id: 187065
  author: Кеша
  author_email: aries.kote@gmail.com
  author_url: ''
  date: '2013-09-29 22:02:59 +0400'
  date_gmt: '2013-09-29 18:02:59 +0400'
  content: "ничего не помогает, с плагином и без плагина - все равно выводит в консоль.\r\n\r\nЧто
    делать!!!!!?????"
- id: 187066
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-09-29 22:13:14 +0400'
  date_gmt: '2013-09-29 18:13:14 +0400'
  content: Код работает. только что проверил. Проблема в вашем блоге. Возможно что-то
    перехватывает мой хук и делает всё наоборот. Потестите на локалке без плагинов
    и с чистым functions.php.
- id: 187073
  author: Кеша
  author_email: aries.kote@gmail.com
  author_url: ''
  date: '2013-09-29 22:39:29 +0400'
  date_gmt: '2013-09-29 18:39:29 +0400'
  content: Плагины не причем, убрал все - но всё без изменений. А с чистым functions.php.
    - я не профессионал и не могу точно понять что надо сделать.
- id: 187075
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-09-29 22:53:25 +0400'
  date_gmt: '2013-09-29 18:53:25 +0400'
  content: 'тогда обратитесь к профессионалу за помощью. я имею в виду, что я не телепат
    и не могу удалённо увидеть вашу проблему. Обычно мешают плагины или functions.php.
    В вашем случае похоже functions.php. Его надо проанализировать на наличие кода,
    который может мешать. Хотя на самом деле это вряд ли так. Так же, если вы не специалист,
    то я допускаю что вы можете сами делать ошибку при вставке кода, но ошибиться
    так же крайне сложно. Там всё просто. Может быть вы не так немного понимаете работу
    кода: все пользователи с ролью <strong>Администратор<&#47;strong> кидаются на
    Консоль, а все остальные (Редактор, автор, участник и подписчик) кидаются на главную
    страницу. Вы так понимаете?'
- id: 187078
  author: Кеша
  author_email: aries.kote@gmail.com
  author_url: ''
  date: '2013-09-29 23:11:47 +0400'
  date_gmt: '2013-09-29 19:11:47 +0400'
  content: после входа меня кидает в консоль, как администратора. А моих подписчиков
    при входе на блог тоже кидает в консоль, но мне хотелось бы, что бы они попадали
    на главную страницу блога. И вообще было бы классно, если бы они не видели этого
    консоль.
- id: 230191
  author: Ruslan
  author_email: russlansen@gmail.com
  author_url: ''
  date: '2014-05-01 16:06:59 +0400'
  date_gmt: '2014-05-01 12:06:59 +0400'
  content: Огромное спасибо, пол дня продолбался с этой бедой, а тут за 5 минут управился
- id: 243505
  author: Ветальчик
  author_email: denka977@gmail.com
  author_url: http://kodabra.com
  date: '2014-12-01 15:25:21 +0300'
  date_gmt: '2014-12-01 11:25:21 +0300'
  content: 'Нашел статью, где описывается способ редиректа на примере авторизации
    через uLogin: <a href="http:&#47;&#47;kodabra.com&#47;avtorizaciya-na-sajte-wordpress-cherez-ulogin-ubiraem-standartnye-knopki-i-delaem-svoi-s-pereadresaciej-na-stranicu-stati&#47;"
    rel="nofollow">тыц<&#47;a>'
---
<p>Бывает нужно пененаправить пользователя или группу пользователей после авторизации на сайтах под управление WordPress на другую страницу, отличную от панели управления, куда он попадает по умолчанию. Для таких случаев я написал небольшой сниппет, который продемонстрирует, как можно перенаправить всех пользователей, кроме администраторов, на главную страницу:<br />
[cce lang="php"]add_filter("login_redirect", "sp_login_redirect", 10, 3);</p>
<p>function sp_login_redirect($redirect_to, $request, $user){<br />
	if(is_array($user->roles))<br />
		if(in_array('administrator', $user->roles))<br />
			return home_url('&#47;wp-admin&#47;');<br />
	return home_url();<br />
}[&#47;cce]<br />
Если вы не знаете как вставлять код или у вас возникли проблемы с этим, то читайте статью <a href="http:&#47;&#47;paperplane.su&#47;insert-functions-wordpress&#47;" title="Вставка кода в functions.php" target="_blank">вставка кода в functions.php<&#47;a>.</p>
<p>Так же может потребовать сделать редирект на не домашнюю страницу для всех кроме админа, на любую другую, которую вы укажите. Например можно отослать на ту страницу, с которой пришли на авторизацию:<br />
[cce lang="php"]add_filter("login_redirect", "sp_login_redirect", 10, 3);</p>
<p>function sp_login_redirect($redirect_to, $request, $user){<br />
	if(is_array($user->roles))<br />
		if(in_array('administrator', $user->roles))<br />
			return home_url('&#47;wp-admin&#47;');<br />
	return $request;<br />
}[&#47;cce]<br />
Эта переменная <em>$request<&#47;em>, как сказано в <a rel="nofollow" href="http:&#47;&#47;codex.wordpress.org&#47;Plugin_API&#47;Filter_Reference&#47;login_redirect" target="_blank">документации<&#47;a> содержит адрес страницы, с которой пришел пользователь.</p>

---
layout: post
status: publish
published: true
title: WordPress - очистка и оптимизация базы данных
author:
  display_name: SlowProg
  login: seoadmin
  email: paperplanesu@rambler.ru
  url: http://paperplane.su
author_login: seoadmin
author_email: paperplanesu@rambler.ru
author_url: http://paperplane.su
wordpress_id: 2408
wordpress_url: http://paperplane.su/?p=2408
date: '2012-05-22 17:16:44 +0400'
date_gmt: '2012-05-22 13:16:44 +0400'
categories:
- Оптимизация
tags:
- mysql
- база данных
- снижение нагрузки
comments:
- id: 97524
  author: Ильдар Хакимов
  author_email: xakimob@gmail.com
  author_url: http://ihakimov.ru/
  date: '2012-10-19 14:25:13 +0400'
  date_gmt: '2012-10-19 10:25:13 +0400'
  content: Проделал почти все указанное, больше всего помогла оптимизация постов,
    размер базы уменьшился с 30 мб до 25,6. Спасибо!
- id: 98284
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-10-21 22:20:15 +0400'
  date_gmt: '2012-10-21 18:20:15 +0400'
  content: Да, согласен, что оптимизация БД позволяет много выиграть, особенно если
    блог уже давно ведется.
- id: 111294
  author: alexzsoft
  author_email: alexzsoft@mail.ru
  author_url: http://www.alexzsoft.ru/
  date: '2012-11-10 13:38:31 +0400'
  date_gmt: '2012-11-10 09:38:31 +0400'
  content: Почистил, вроде получше стало)
- id: 111296
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-10 13:41:29 +0400'
  date_gmt: '2012-11-10 09:41:29 +0400'
  content: Вряд ли "вроде получше", "точно получше" должно быть =) Особенно если блог
    старый, публикаций много было и спама. Когда это все удаляется, то выборка из
    таблицы происходит гораздо быстрее.
- id: 111464
  author: alexzsoft
  author_email: alexzsoft@mail.ru
  author_url: http://www.alexzsoft.ru
  date: '2012-11-11 01:46:39 +0400'
  date_gmt: '2012-11-10 21:46:39 +0400'
  content: да я чистил от постов, а сейчас удалил нафиг все старые непонятные таблицы,
    которые не идут в стандарте)
- id: 111467
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2012-11-11 01:48:49 +0400'
  date_gmt: '2012-11-10 21:48:49 +0400'
  content: Главное ничего нужного не зацепить =) Но вообще в любой системе самое узкое
    место это именно база данных. Потому стандартная процедура для ускорения работы
    сайта это оптимизация самой БД и запросов к ней. Поскольку запросы мы не трогаем
    (доверимся разработчикам), то очистка и оптимизация это то что надо. Не забывайте
    проводить её периодически раз в полгода-год =)
- id: 111678
  author: alexzsoft
  author_email: alexzsoft@mail.ru
  author_url: http://www.alexzsoft.ru
  date: '2012-11-11 08:46:33 +0400'
  date_gmt: '2012-11-11 04:46:33 +0400'
  content: понял  спасибо) да я запросы еще уменьшил. хочу на максимум в page speed
    ускорить. из критического, осталось слайды обьединить
- id: 134325
  author: Очистка и оптимизация базы данных в wordpress | Выживи сам
  author_email: ''
  author_url: http://vichivisam.ru/?p=17181
  date: '2013-01-22 20:25:36 +0400'
  date_gmt: '2013-01-22 16:25:36 +0400'
  content: "[...] Список таблиц (кликнуть)&hellip; [...]"
- id: 147586
  author: Антон Дьяченко
  author_email: anton@dyachenko.pp.ua
  author_url: http://youpk.ru/
  date: '2013-04-18 10:17:52 +0400'
  date_gmt: '2013-04-18 06:17:52 +0400'
  content: "Здравствуйте\r\nПлагин wpPoolls кажется \r\nтаблицы в БД следующие\r\n\r\npollsa\r\npollsip\r\npollsq"
- id: 147589
  author: Антон Дьяченко
  author_email: anton@dyachenko.pp.ua
  author_url: http://youpk.ru/
  date: '2013-04-18 10:43:57 +0400'
  date_gmt: '2013-04-18 06:43:57 +0400'
  content: "абалдеть. Удалил ревизии постов 4500 записей\r\nЗатем оптимизировал БД
    и размер с 80 МБ! стал 7.9 МБ!\r\nСпасибо огромное!\r\nУспехов Вам!"
- id: 147593
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-04-18 11:17:19 +0400'
  date_gmt: '2013-04-18 07:17:19 +0400'
  content: Хорошо! Спасибо! Добавил в общий список =)
- id: 167135
  author: Dooddy
  author_email: dooddy@yandex.ru
  author_url: ''
  date: '2013-06-14 09:42:33 +0400'
  date_gmt: '2013-06-14 05:42:33 +0400'
  content: а можно удалить таблицу wp_wp_rp_tags?
- id: 167161
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-06-14 14:38:47 +0400'
  date_gmt: '2013-06-14 10:38:47 +0400'
  content: Как я понял, эта таблица от плагина WordPress Related Posts, и если этого
    плагина у вас уже нет и вы его не используете, то можно удалить. Но желательно
    всё таки бэкапом запастись =)
- id: 181412
  author: Olunka
  author_email: olunka-com@yandex.ru
  author_url: http://www.olunka.ru
  date: '2013-08-26 12:15:01 +0400'
  date_gmt: '2013-08-26 08:15:01 +0400'
  content: "По поводу OPTIMIZE TABLE, не согласна, что блогерам стоит ею пользоваться.
    Некоторые даже дают друг другу советы настроить выполнение этой функции ежедневно.\r\n\r\nВо-первых,
    хостеры сами дефрагментируют базы.\r\nВо-вторых во время исполнения OPTIMIZE TABLE
    база заблокирована, а значит и сайт не работает, стоит об этом напоминать, чтобы
    начинающие оптимизаторы баз не кидались бездумно выполнять все советы."
- id: 181445
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-08-26 19:53:16 +0400'
  date_gmt: '2013-08-26 15:53:16 +0400'
  content: "Хохохо, ежедневно это конечно лишнее! через чур лишнее! Но в целом согласная
    я. Думаю предупредить как минимум стоит. Хотя как правило оптимизация довольно
    быстро проходит, но пусть будут предупреждены =)\r\n\r\nА на счёт хостеров, то
    не все такие добросовестные. И лучше потратить самому минуту, чем надеяться, что
    хостер пошевелит своими пальцами."
- id: 189691
  author: Alex
  author_email: shiloff-job@yandex.ru
  author_url: ''
  date: '2013-10-14 05:05:34 +0400'
  date_gmt: '2013-10-14 01:05:34 +0400'
  content: "WordPress Link Directory - плагин обмена ссылками\r\nwp_wplinkdir_cats
    - хранится информация о рубриках\r\nwp_wplinkdir_links - хранятся ссылки\r\n\r\nПлагин
    давненько уже удалил, сегодня подчистил базу от его хвостов. И почему-то всплыло
    2 лишних запроса к базе. Пытаюсь восстановит базу из дампа,  ответ MySQL:\r\n#1062
    - Duplicate entry '33' for key 'PRIMARY' \r\n\r\nругается на таблицу _commentmeta\r\n\r\nЧто
    это может быть ???\r\n\r\nСпасибо."
- id: 189725
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-10-14 09:27:50 +0400'
  date_gmt: '2013-10-14 05:27:50 +0400'
  content: Если это происходит при восстановление из дампа, то скорее всего дело просто
    в восстановлении. Например, в commentmeta уже есть запись с id 33 и вы пытаетесь
    загрузить ещё одну. недопустимо. Как происходит восстановление? какими средствами?
    В общем, необходимо чтобы пере загрузкой данных предыдущих уже не было.
- id: 189807
  author: Alex
  author_email: shiloff-job@yandex.ru
  author_url: ''
  date: '2013-10-14 16:31:14 +0400'
  date_gmt: '2013-10-14 12:31:14 +0400'
  content: "Перед чисткой БД, как и советовали сделал дамп базу из MySQL. Пытаюсь
    откатить опять же средствами MySQL. Базу используют 2 движка: WP и phpBB, но ругается
    почему-то именно на таблицу commentmeta (((\r\n\r\nНа форуме уже появились новые
    темы и сообщения, поэтому теперь я вообще в тупике, как откатить, не удалив ничего
    нужного ..."
- id: 189811
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-10-14 16:48:59 +0400'
  date_gmt: '2013-10-14 12:48:59 +0400'
  content: "Чтобы ничего не появлялось нужно было ещё закрыть доступ всем. Заглушку
    какую повесить на время проведения работ. Сейчас хотя бы повесьте чтобы не было
    больше обновлений в базе и решайте задачу спокойно.\n\nДалее:\n\n1) Перед загрузкой
    дампа удаляете все таблицы? Их нужно, если что, все удалить. \n\n2) Если таблицы
    удаляете, и всё равно ругается, то придёться править дамп в ручную. Для этого
    скопируйте для начала дамп, чтобы был первоначальный исходник. Далее лезете в
    него любым нормальных текстовым редактором (например notepad ++) и ищите заполнение
    таблицы commentmeta, а в ней уже добавление кортежа с meta_id = 33. Удаляете весь
    этот кортеж. Далее сохраняете дамп и пытаетесь загрузить его снова в базу. Если
    возникает ещё какой конфликт, то пытаетесь пофиксить его таким же способом.\n\n3)
    На счёт новых сообщений на форуме. У вас база форума и wordpress является одной
    и той же что ли базой???? Обычно это совершенно разные базы. Или у вас форум построен
    полностью на wordpress и таблицы форума лежат рядом с таблицами блога? Если так,
    то плохо. Чтобы восстановить эти сообщения нужно сделать дамп таблиц форума с
    этими сообщениями, потом проделать всё что написано в пункте два, далее удалить
    всё содержимое форумных таблиц (только форумных таблиц и только содержимого, а
    не сами таблицы) и загрузить в них уже новое содержимое с помощью сделанного ранее
    дампа.\n\n4) Ещё вариант проведения пункта 2 может быть через вашего хостера.
    Если он делает ежедневные бэкапы вашей базы, то рекомендую ей и воспользоваться.
    А если не делает, то у вас отстойный хостер и вам нужно от туда бежать.\n\nНадеюсь
    всё более менее понятно и сломанного телефона не возникнет."
- id: 189814
  author: Alex
  author_email: shiloff-job@yandex.ru
  author_url: ''
  date: '2013-10-14 17:04:09 +0400'
  date_gmt: '2013-10-14 13:04:09 +0400'
  content: "Форум и блог используют одну базу, только имеют свои префиксы. Знаю, что
    плохо так делать. В процессе буду их разносить по разным БД.\r\n\r\nА что если
    из дампа выпилить только таблицы блога, блог закрыть, таблицы его удалить и потом
    из дампа обновить ?\r\n\r\nПросто очень странно, что удаление 2-х таблиц вызвало
    2 лишних запроса. Грешил на новые плагины, но удалил их, а запросы остались."
- id: 189821
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-10-14 17:10:05 +0400'
  date_gmt: '2013-10-14 13:10:05 +0400'
  content: "Если префиксы разные, то это уже сильно облегчает работу. Восстановить
    только таблицы блога будет идеальным, если справитесь с выпиливанием его таблиц
    из дампа. Тогда форум даже ничего не заметит =)\r\n\r\nА на счёт двух лишних запросов,
    то я глубоко сомневаюсь, что удаление двух не используемых таблиц могло привести
    к увеличению количества делаемых в базу запросов. Очень сомнительно. Скорее это
    просто совпадение, а запросы появились в результате чего-то другого, например,
    обновления WP или плагинов или добавление какого-то функционала в шаблон. Или
    может быть даже этих запросов и нет совсем. Как вы их проверяли?"
- id: 189823
  author: Alex
  author_email: shiloff-job@yandex.ru
  author_url: ''
  date: '2013-10-14 17:12:34 +0400'
  date_gmt: '2013-10-14 13:12:34 +0400'
  content: "В подвале стоит код\r\n<code><?php if (is_user_logged_in()) { ?>\r\n<?php\r\n
    \   echo '<div style=\"text-align: center\">'\r\n        . round(memory_get_usage()&#47;1024&#47;1024,
    2) . ' MB '\r\n        .' |  MySQL:' . get_num_queries() . ' | ';\r\n    timer_stop(1);\r\n
    \   echo ' sec<&#47;div>';\r\n?>\r\n<?php } ?><&#47;code>Раньше показывал 20 запросов,
    теперь 22. WP не обновлял, плагины тоже."
- id: 189827
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-10-14 17:24:55 +0400'
  date_gmt: '2013-10-14 13:24:55 +0400'
  content: Я так понимаю сравнение происходило по одной и той же странице? Если да,
    то окей. А если по разным, то там может быть такое. А количество запросов могло
    увеличится и не из-за вас вовсе. А например из-за хостера, он кеширование запросов
    переделал и у вас это число изменилось. Хотя конечно это смотря как работает функция
    <em>get_num_queries()<&#47;em> в WP. Но так или иначе мы узнаем виновата ли была
    база только когда вы её восстановите. Жду результатов с нетерпением =)
- id: 189832
  author: Alex
  author_email: shiloff-job@yandex.ru
  author_url: ''
  date: '2013-10-14 17:53:38 +0400'
  date_gmt: '2013-10-14 13:53:38 +0400'
  content: Мистика прямо какая-то. Перезалил базу блога, запросы остались. Видимо
    реально что-то их делает ... Хотя откуда они нарисовались пока ума не приложу.
    Буду искать. Спасибо за помощь.
- id: 221652
  author: adwrd
  author_email: adward@chelny.com
  author_url: http://cimetrica.ru
  date: '2014-02-01 08:05:54 +0400'
  date_gmt: '2014-02-01 04:05:54 +0400'
  content: "с 52 до 32 уменьшить - так это вообще существенно а считаю ;) \r\n\r\nСпасибо
    автору, что не поленился всё это расписать.\r\nДа, кстати, чтобы целиком все таблицы
    сразу оптимизировать - можно в pma зайти в список всех таблиц (Структура)  -->
    отметить всё --> с отмеченными [оптимизировать]."
- id: 237739
  author: dzhen
  author_email: smitnichka@ukr.net
  author_url: ''
  date: '2014-09-05 12:28:06 +0400'
  date_gmt: '2014-09-05 08:28:06 +0400'
  content: Да, это Related Posts, если не используете этот плагин, смело удаляйте.
- id: 264788
  author: Елена
  author_email: e-lovtzova2010@ya.ru
  author_url: http://kuhatpodano.ru/
  date: '2015-12-07 15:01:48 +0300'
  date_gmt: '2015-12-07 11:01:48 +0300'
  content: Нужный материал, я сейчас как раз занимаюсь ускорением блога и воспользуюсь
    вашими советами, спасибо!
---
<p><a href="http:&#47;&#47;image.paperplane.su&#47;2012&#47;04&#47;cleanup-database.png"><img class="alignleft size-medium wp-image-2508" title="Очиска и оптимизация базы данных" src="http:&#47;&#47;image.paperplane.su&#47;2012&#47;04&#47;cleanup-database-300x300.png" alt="Очиска и оптимизация базы данных" width="300" height="300" &#47;><&#47;a>WordPress пожалуй самый популярный движок для блога и его использует куча народа, но многие ли из них заглядывают в MySQL, который работает в купе с WordPress, часто ли они проводят <strong>очистку и&nbsp;оптимизацию&nbsp;базы данных<&#47;strong> своей?&nbsp;А ведь после долгого использования WordPress база захламляется и требует ухода за собой, но блог работает и так, потому это мало кого волнует.</p>
<p>Но раз вы читаете эту статью, значит по какой-то причине вы решили сделать свою базу лучше. Я вам в этом помогу. Ниже приведу несколько хороших советов, которые помогут очистить базу данных от лишнего хлама и оптимизировать ее работу. Тем самым вы снизите нагрузку на сервер и ускорите работу своего блога.</p>
<p>Прежде чем мы начнем, вы должны выполнить три условия:</p>
<ul>
<li>Во-первых, для оптимизации и очистки вам понадобится &nbsp;<strong>PhpMyAdmin<&#47;strong>. Это&nbsp;веб-интерфейс для администрирования MySQL через браузер и скорее всего он есть у вашего хостера, если ни разу его не видели, то спросите его об этом обязательно.<&#47;li>
<li>Во-вторых, необходимо ограничить доступ пользователей к блогу, чтобы они не смогли вносить изменение в базу данных (например, комментировать) пока вы ее оптимизируете. Для этого можно повесить страницу <em>сайт на реконструкции<&#47;em>,&nbsp;например, с помощью этого <a title="40 разных шаблонов "сайт в разработке", "сайт на реконструкции" и т.д." href="http:&#47;&#47;paperplane.su&#47;40-razlichnyx-tem-i-shablonov-sajt-v-razrabotke&#47;#%3Ch2%3E16.%C2%A0%3Ca+href%3D%22http%3A%2F%2Fwww.cssjockey.com%2Fwordpress-plugins%2Fcustom-coming-soon-pages-wordpress-plugin%22+rel%3D%22nofollow%22+target%3D%22_blank%22%3Ecustom+coming+soon+pages%3C%2Fa%3E%C2%A0%7C%C2%A0%D0%91%D0%B5%D1%81%D0%BF%D0%BB%D0%B0%D1%82%D0%BD%D1%8B%D0%B9%3C%2Fh2%3E" target="_blank">шаблона-плагина<&#47;a>.<&#47;li>
<li>В-третьих, необходимо сделать резервную копию базы данных, чтобы можно было в случаи неудачи все вернуть назад.&nbsp;Если ваш хостер не делает резервные копии автоматически, то ее можно сделать с помощью PhpMyAdmin: &nbsp;вкладка <em>Экспорт<&#47;em>, формат <em>SQL<&#47;em>. После резерва базы можно приступать к очистке и оптимизации. Кстати, если вам понадобится восстановить, то это описано в низу поста.<&#47;li><br />
<&#47;ul></p>
<h2>Удаление лишних таблиц<&#47;h2><br />
При деактивации плагина, он просто перестает функционировать, но это не приводит к удалению таблиц из базы данных. Но некоторые авторы плагинов настолько хороши, что теперь включают кнопку <em>Удалить<&#47;em>&nbsp;в функционал своих плагинов. Эта кнопка позволяет, перед основным удалением через WordPrss, почистить за плагином все что он нагадил в базу данных.</p>
<p>Но такие плагины исключение нежели правило и большинство из них не чистят за собой. В таком случае вы должны &nbsp;почистить базу данных за плагинами самостоятельно. И проще всего начать плагинов, которые создают отдельные таблицы в вашей базе.&nbsp;&nbsp;Но главное не удаляйте ниже приведенный список таблиц, потому что это таблицы самого WordPress, без которых он точно не будет работать:<br />
[cce lang="text"]wp_comments<br />
wp_links<br />
wp_options<br />
wp_postmeta<br />
wp_posts<br />
wp_terms<br />
wp_term_relationships<br />
wp_term_taxonomy<br />
wp_usermeta<br />
wp_users[&#47;cce]<br />
Все остальные таблицы вы должны рассмотреть на предмет схожести с названиями плагинов, которые вы удалили или хотите удалить. Поскольку у вас есть резерная копия, то бояться нечего, но ошибаться все равно лучше не стоит. Ниже я приведу список таблиц, которые&nbsp;наверняка&nbsp;знаю каким плагинам они соответствуют (скрыто под катом):</p>
<p><strong><a onclick="document.getElementById('cut').style.display=(document.getElementById('cut').style.display!='none')?'none':''; return false;" href="#">Список таблиц (кликнуть)...<&#47;a><&#47;strong></p>
<div id="cut" style="display: none;">
[cce lang="text"]404 Notifier					=> wp_ak_404_log</p>
<p>Contact Form 7					=> wp_contact_form_7</p>
<p>FAQ Builder						=> wp_faq_build_category<br />
								=> wp_faq_build_questions<br />
								=> wp_faq_categories<br />
								=> wp_faq_questions</p>
<p>Pretty Link						=> wp_prli_clicks<br />
								=> wp_prli_groups<br />
								=> wp_prli_links<br />
								=> wp_prli_link_metas</p>
<p>Redirection						=> wp_redirection_groups<br />
								=> wp_redirection_items<br />
								=> wp_redirection_logs<br />
								=> wp_redirection_modules</p>
<p>Search Meter					=> wp_searchmeter<br />
								=> wp_searchmeter_recent</p>
<p>Quick Tabs						=> wp_ahm_qt_tabs<br />
								=> wp_ahm_qt_tab_groups</p>
<p>Simply Poll						=> wp_sp_polls</p>
<p>SS Downloads					=> wp_ss_downloads</p>
<p>TDO Mini Forms					=> wp_tdomf_table_edits<br />
								=> wp_tdomf_table_forms<br />
								=> wp_tdomf_table_sessions<br />
								=> wp_tdomf_table_widgets</p>
<p>WP-Filebase Download Manager	=> wp_wpfb_cats<br />
								=> wp_wpfb_files<br />
								=> wp_wpfb_files_id3</p>
<p>wpPoolls						=> wp_pollsa<br />
								=> wp_pollsip<br />
								=> wp_pollsq[&#47;cce]<br />
<&#47;div><br />
Теперь всех читателей я хочу попросить об одной услуге. Если вы нашли таблицы (и соответствующие им плагины), которых нет в этом списке, то отпишите их в комментариях, пожалуйста. Я со временем буду пополнять этот список, чтобы в дальнейшем всем было проще. И помните, что у одного плагина может быть большей одной таблице в базе.</p>
<p>Чтобы удалить таблицу с помощью PhpMyAdmin нужно просто в списке таблиц вашей базы данных нажать кнопку&nbsp;<em>Удалить<&#47;em>&nbsp;(красный крестик) напротив необходимой таблицы:</p>
<p><a href="http:&#47;&#47;image.paperplane.su&#47;2012&#47;04&#47;delete-table.jpg"><img class="aligncenter size-large wp-image-2415" title="Удаление таблицы" src="http:&#47;&#47;image.paperplane.su&#47;2012&#47;04&#47;delete-table.jpg" alt="Удаление таблицы" width="496" height="146" &#47;><&#47;a></p>
<p>Также можно удалить вручную все таблицы разом с помощью запроса. Просто в запросе необходимо будет перечислить все таблицы через запятую:<br />
[cce lang="sql"]DROP TABLE wp_ak_404_log, wp_contact_form_7;[&#47;cce]<br />
Этот запрос нужно поместить в специальное окошко PhpMyAdmin, которое находится на вкладке <em>SQL<&#47;em>. Думаю разберетесь.</p>
<p>Другие плагины не создают для себя целых таблиц, т.к. не используют столько много данных. Они просто хранят свои настройки в таблице <em>wp_options<&#47;em>. &nbsp;Но они так же после своего удаления не отчищают эту таблицу и со временем ее может очень сильно раздуть. &nbsp;Самый простой способ найти их настройки это просмотреть эту таблицу глазками с помощью PhpMyAdmin и удалить все, что покажется ненужным.</p>
<p>Другое дело, что удаление по одной строчке&nbsp;не оправдывает усилий. Максимум это мероприятие вам сэкономит несколько килобайт. Но если вы хотите, чтобы ваша база была супер чистая, то это не займет много времени. Лично я это никогда не делал, но зато я донес до вас, что так тоже можно чистить.</p>
<h2>Очистка ревизий<&#47;h2><br />
WordPress обладает такой "замечательной" вещью, как ревизии. Ревизия - это сохранение копий поста после его изменения. Например, вы написали пост и опубликовали его, через некоторое время что-то изменили в нем и обновили, а WordPress запомнил предыдущую версию поста и сделал ее ревизией, т.е. в крайнем случаи вы сможете вернуться все назад и исправить. Но лично мне это никогда не было нужно. Потому давайте отключим ревизии или хотя бы ограничим их.</p>
<p>Для этого в корне движка найдите файл <em>wp-config.php<&#47;em>, откройте его на редактирование (по FTP) и в самое начало, обязательно после тега <em><?php<&#47;em>,&nbsp;вставьте следующую строку:<br />
[cce lang="php"]define('WP_POST_REVISIONS', false);[&#47;cce]<br />
Эта команда отключит полностью ревизию и у вас не будут вообще сохранятся копии вашего материала. Но если вы все таки хотите её оставить, но ограничить, то просто поменяйте <em>false<&#47;em> на цифру, которая будет обозначать максимальное количество копий для каждого материала:<br />
[cce lang="php"]define('WP_POST_REVISIONS', 5);[&#47;cce]<br />
После этого нам будет необходимо очистить базу данных от всех ревизий, что сейчас существуют. Скорее всего их поднакопилось огромное множество и вручную это не сделать. Потому все сделаем с помощью запроса в базу данных:<br />
[cce lang="sql"]DELETE FROM wp_posts WHERE post_type = "revision"[&#47;cce]<br />
Этот запрос безвозвратно уничтожит все ревизии всех постов. И после этого, скорее всего, у вас прилично освободится места т.к. на один пост бывает не по одной копии.</p>
<h2>Очистка корзины<&#47;h2><br />
Обычно после удаления поста, страницы, аттача и др. это попадает вначале в корзину и только оттуда уже можно удалить объект полностью. Меня это немного всегда напрягало, но и это очень легко решается. Отключим или хотя бы ограничим корзину, как мы это сделали с ревизиями выше.</p>
<p>Опять же нам понадобится <em>wp-config.php<&#47;em>. В самое начало, обязательно после тега <em><?php<&#47;em>,&nbsp;вставьте следующую строку:<br />
[cce lang="php"]define('EMPTY_TRASH_DAYS', 0);[&#47;cce]<br />
Эта команда отключит полностью использование корзины и в случаи удаление чего-либо, это сразу будет безвозвратно стираться. Если вы все таки хотите её оставить, но ограничить, то просто поменяйте <em>0<&#47;em> на цифру, которая будет обозначать максимальное количество дней хранения после удаления объекта:<br />
[cce lang="php"]define('EMPTY_TRASH_DAYS', 5);[&#47;cce]<br />
После этого нам будет необходимо очистить корзину от всего содержимого. Сделаем мы это так же с помощью запроса в базу данных:<br />
[cce lang="sql"]DELETE FROM wp_posts WHERE post_status = 'trash'[&#47;cce]<br />
Этот запрос безвозвратно уничтожит все содержимое корзины.</p>
<h2>Очистка комментариев<&#47;h2><br />
Спамеры не дремлют! И для блогов на WordPress всегда были головной болью спамерские комментарии. Кстати, дополнительно читайте <a title="WordPress и спам" href="http:&#47;&#47;paperplane.su&#47;wordpress-i-spam&#47;" target="_blank">борьба со спамом в WordPress<&#47;a>. А тут я приведу несколько примеров запросов, которые вам позволят удалить те комментарии, которые вам не нужны одним махом. Конечно вы можете удалить спам-комментарии вручную через WordPress, но иногда проще запустить простую команду MySQL.</p>
<p>Для того чтобы удалить все спам-комментарии одни запрос нужно написать следующее:<br />
[cce lang="sql"]DELETE FROM wp_comments WHERE comment_approved = 'spam';[&#47;cce]<br />
Но бывают и не тривиальные задачи. Например, если нужно удалить все комментарии с конкретным URL, то потребуется следующий запрос:<br />
[cce lang="sql"]DELETE FROM wp_comments WHERE comment_author_url ='http:&#47;&#47;www.site.ru';[&#47;cce]<br />
А если нужно удалить комментарии принадлежащие только определенному мылу, то запрос следующий:<br />
[cce lang="sql"]DELETE FROM wp_comments WHERE comment_author_email ='spammer@site.ru';[&#47;cce]<br />
И совсем иногда может потребоваться удалить все неодобренные комментарии, и в этом поможет следующий запрос:<br />
[cce lang="sql"]DELETE FROM wp_comments WHERE comment_approved ='0';[&#47;cce]<br />
Все, теперь ваши комментарии чисты, что также экономит вам место в вашей базе.</p>
<h2>Внутренняя оптимизация MySQL<&#47;h2><br />
MySQL имеет встроенную функцию оптимизации и очистки неиспользуемого пространства в таблицах. Это особенно эффективно, когда вы удалили большой объем данных со своего блога (например, огромное количество спам-комментариев или просто постов).</p>
<blockquote><p><strong>ВНИМАНИЕ!<&#47;strong> Как заметила <a href="http:&#47;&#47;paperplane.su&#47;wordpress-ochistka-i-optimizaciya-bazy-dannyx&#47;#comment-181412">Olunka в комментариях<&#47;a> всех нужно предупредить о том, что во время оптимизации база заблокирована, и соответственно сайт не работает на протяжении всего процесса (исполнения запроса). Потому это лучше проводить в период наименьшей активности посетителей, например, ночью.<&#47;blockquote></p>
<p>Сделать это очень просто с помощью PhpMyAdmin. Необходимо просто выбрать таблицу, перейдите к вкладке <em>Операции<&#47;em>&nbsp;и внизу найти ссылку <em>Оптимизировать таблицы<&#47;em>. Именно эта ссылка вам и нужна.</p>
<p>Если вы хотите запустить процедуру оптимизации вручную, то существует специальный синтаксис для этого. Преимущество перед предыдущим способом в том, что можно сразу указать все таблицы через запятую, которые вы хотите оптимизировать:<br />
[cce lang="sql"]OPTIMIZE TABLE wp_comments, wp_posts[&#47;cce]<br />
Результат работы этой операции тем лучше, чем вы активнее юзали свой блог и чем больше в нем информации. Например, при больших объемах данных в несколько сотен МБ количество освобожденного места может быть более 100 МБ.</p>
<h2>Восстановление базы данных<&#47;h2><br />
Если вдруг что-то пошло не так и вы удалили нужное, то все можно вернуть на прежнее место. Правда, только в том случаи, если вы сделали резервную копию, о чем я вас просил в самом начале.</p>
<p>Первым делом, удаляем все таблицы из базы данных на проч. После идем на вкладку <em>Импорт<&#47;em> и жмем там <em>Обзор...<&#47;em>. В открывшемся окне выбираем файл с резервной копией вашей базы. И не забудьте установить кодировку файла такую же как при экспорте.&nbsp;Выбрали. Жмем <em>ОК<&#47;em>. Обождите немного, все данные загрузятся и база станет как прежде.</p>
<p><a href="http:&#47;&#47;image.paperplane.su&#47;2012&#47;04&#47;mysql-import.jpg"><img class="aligncenter size-large wp-image-2423" title="Восстановление базы данных MySQL" src="http:&#47;&#47;image.paperplane.su&#47;2012&#47;04&#47;mysql-import-640x181.jpg" alt="Восстановление базы данных MySQL" width="640" height="181" &#47;><&#47;a></p>
<p>Но тут могут быть загвоздки. Обратите внимание на <em>Максимальный размер<&#47;em>, если файл с базой превышает этот размер, то импорт не будет произведен. Этот размер ограничивается настройками PHP вашего сервера. У меня стоит 20 МБ и обычно этого хватает. Чтобы вам сделать так же, вам нужно иметь доступ к файлу конфигурации PHP под названием <em>php.ini<&#47;em> или еще каким-то образом на него влиять, например через панель управления хостингом. Находите в нем нужные переменные и ставите на против них необходимый размер файла:<br />
[cce lang="php"]upload_max_filesize = 20M<br />
post_max_size = 20M[&#47;cce]<br />
В случаи если вы не можете никак влиять на эти переменные, то переговорите с вашим хостером, объяснте ситуацию, что нужно залить большую базу данных, и, я думаю, они пойдут вам на встречу.</p>
<p>На этом у меня все. Не забудьте убрать, страницу-заглушку, которую установили в самом начале. И рекомендую повторять всю эту процедуру раз в несколько месяцев, поскольку спам комментарии и остальное будут по немного копиться. Если есть какие вопросы, предложения или благодарности, то пишите в комментарии. Всем удачи!</p>

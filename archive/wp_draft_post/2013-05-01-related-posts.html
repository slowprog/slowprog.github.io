---
layout: post
status: publish
published: true
title: Похожие статьи без плагина
author:
  display_name: SlowProg
  login: seoadmin
  email: paperplanesu@rambler.ru
  url: http://paperplane.su
author_login: seoadmin
author_email: paperplanesu@rambler.ru
author_url: http://paperplane.su
wordpress_id: 2725
wordpress_url: http://paperplane.su/?p=2725
date: '2013-05-01 19:50:37 +0400'
date_gmt: '2013-05-01 15:50:37 +0400'
categories:
- Без плагина
tags:
- Wordpress
- виджет
- пост
- статья
comments:
- id: 152276
  author: Александр
  author_email: alvas1985@rambler.ru
  author_url: ''
  date: '2013-05-01 21:29:30 +0400'
  date_gmt: '2013-05-01 17:29:30 +0400'
  content: Обязательно попробую! Только после того как постов побольше напишу )
- id: 152283
  author: kulinaris
  author_email: kulinaris4you@gmail.com
  author_url: http://zastolie4you.ru/
  date: '2013-05-01 21:40:50 +0400'
  date_gmt: '2013-05-01 17:40:50 +0400'
  content: "5+!!! Закинул куда можно.\r\nПервушин похожее продает ;-)\r\nПопробую
    потестить... \r\nВопрос сразу - откуда выборку стоп слов взял?"
- id: 152287
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-05-01 21:47:24 +0400'
  date_gmt: '2013-05-01 17:47:24 +0400'
  content: "Собрал сам! У меня перед написанием были свои стоп-слова, плюс для уверенности
    ещё прошерстил весь рунет на наличии подобного, и сложил своё с тем что нашёл,
    но точно не знаю добавилось что или нет. Складывал программно, а сравнить лень
    xDDDD\r\n\r\nЕсли есть что добавить, то в комменты - я добавлю."
- id: 152376
  author: morontt
  author_email: morontt@gmail.com
  author_url: http://morontt.info
  date: '2013-05-02 01:26:22 +0400'
  date_gmt: '2013-05-01 21:26:22 +0400'
  content: "Массив стоп-слов впечатляет размерами :-) \r\n\r\nУ меня в отдалённых
    планах тоже стоит задача реализовать список похожих статей, только самих статей
    для начала надо приумножить."
- id: 152408
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-05-02 02:41:39 +0400'
  date_gmt: '2013-05-01 22:41:39 +0400'
  content: Возьми же мой алгоритм! Возьми же, ну пожалуйста! Он почти неплохо работает
    =D А если сделаешь его лучше, то я доработаю свой и отсюда на тебя ссылку сделаю
    xDDD А доработать есть что, хотя при этом кода поприбавится, например, мой импровизированный
    стеммер котам на смех, но зато маленький и работает в первом приближении (если
    смотреть из-за угла и через тёмные очки) почти так же как стеммер Портера xDDDD
- id: 152698
  author: Serpent
  author_email: rubtsov-gel@yandex.ru
  author_url: http://rubtsow.ru
  date: '2013-05-02 18:24:59 +0400'
  date_gmt: '2013-05-02 14:24:59 +0400'
  content: А я пока подожду немного. Через месяц-полтора код доработается - тогда
    и гляну. :)
- id: 152715
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-05-02 19:06:33 +0400'
  date_gmt: '2013-05-02 15:06:33 +0400'
  content: Да, он уже хорош! Я его у себя долго тестил. Но дело конечно твоё =)
- id: 152717
  author: Алексей
  author_email: a_zurn@mail.ru
  author_url: http://na-kruchok.ru
  date: '2013-05-02 19:09:08 +0400'
  date_gmt: '2013-05-02 15:09:08 +0400'
  content: Так далеко пока не смотрю, чтобы поменять свой плагин. Но со временем,
    после тестирования, результат все-таки заинтересовать может
- id: 152748
  author: Serpent
  author_email: rubtsov-gel@yandex.ru
  author_url: http://rubtsow.ru
  date: '2013-05-02 20:16:30 +0400'
  date_gmt: '2013-05-02 16:16:30 +0400'
  content: Он не выводит превьюшки. :-|
- id: 152750
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-05-02 20:18:13 +0400'
  date_gmt: '2013-05-02 16:18:13 +0400'
  content: А должен? Окей, как это сделать? Чтобы выводил миниатюры, а если нет миниатюры,
    то первую картинку в статье, но так чтобы она была привьюшкой (обрублена). Так
    будет норм? Или хватит одних миниатюр?
- id: 152752
  author: Serpent
  author_email: rubtsov-gel@yandex.ru
  author_url: http://rubtsow.ru
  date: '2013-05-02 20:19:38 +0400'
  date_gmt: '2013-05-02 16:19:38 +0400'
  content: Никто никому ничего не должен. Я же не предъявляю никаких претензий, просто
    факты.
- id: 152753
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-05-02 20:26:18 +0400'
  date_gmt: '2013-05-02 16:26:18 +0400'
  content: "Я же пустился в обсуждение просто. Сделать-то можно, проблема не в этом.\r\n\r\nЩас
    ещё подумал и вот что надумал. Привьюшки вроде как не всегда пригодны. Например,
    у меня вроде можно их сделать т.к. включены сниппеты, а если нет сниппетов, то
    одна запись = одной строке и максимум, что можно сделать, это чтобы заголовок
    был по центру относительно высоты привьюшки. Не очень красиво выходит. Т.е. вроде
    сделать можно, но я даже не знаю стоит ли. Плюс увеличение и без того большого
    кода. В защиту могу сказать, что в некоторых случаях (включены сниппеты, достаточной
    длинны чтобы быть в высоту миниатюры и у статей есть эти миниатюры) миниатюры
    будут очень хорошо смотреться.\r\n\r\nВ то же время, включение миниатюры без сниппета
    это проблемы самого пользователя, который это сделал. Ведь можно этого и не делать.
    Так что я совсем запутался.\r\n\r\nЧто ты об этом думаешь?"
- id: 152757
  author: Serpent
  author_email: rubtsov-gel@yandex.ru
  author_url: http://rubtsow.ru
  date: '2013-05-02 20:32:25 +0400'
  date_gmt: '2013-05-02 16:32:25 +0400'
  content: А если текст добавлять через цитату <code>the_excerpt ()<&#47;code>? Тогда
    размер будет больше и можно будет воткнуть превью, хотя минус - очень уж большой
    объём, надо ли оно?
- id: 152768
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-05-02 20:57:38 +0400'
  date_gmt: '2013-05-02 16:57:38 +0400'
  content: Хм, дело даже не в размере. А в том стоит ли увеличивать код и добавлять
    эту возможность? Если её не все будут использовать. Я вот чесслово почти ни у
    кого не видел похожих статей с привьюшками (если не считать тизеры разные). Очень
    редко встречается. Может народ и обойдётся xDDD Хотя мне идея нравится, и у себя
    бы я сделал.
- id: 152769
  author: Serpent
  author_email: rubtsov-gel@yandex.ru
  author_url: http://rubtsow.ru
  date: '2013-05-02 20:59:46 +0400'
  date_gmt: '2013-05-02 16:59:46 +0400'
  content: Может я просто привык к тому, что у меня плагин выводит превьюшки. Текст
    мне, в принципе, и не нужен в "похожих записях". ))
- id: 152771
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-05-02 21:03:14 +0400'
  date_gmt: '2013-05-02 17:03:14 +0400'
  content: Я в общем ещё подумал и решил. В этот код я подобного добавлять не буду,
    т.к. это его раздует до нехорошо. А если будут ещё просьбы сделать с привьюшками,
    то я лучше замучу отдельную статью с модификацией =)))) Пока время пущу на другие
    задчи =)
- id: 152772
  author: Serpent
  author_email: rubtsov-gel@yandex.ru
  author_url: http://rubtsow.ru
  date: '2013-05-02 21:06:41 +0400'
  date_gmt: '2013-05-02 17:06:41 +0400'
  content: Тоже вариант. 8)
- id: 153049
  author: Morontt
  author_email: morontt@gmail.com
  author_url: http://morontt.info
  date: '2013-05-03 17:38:14 +0400'
  date_gmt: '2013-05-03 13:38:14 +0400'
  content: Алгоритм посмотрю, только вот реализация может быть совсем другой, хотя
    бы потому, что использую рукописный движок :)
- id: 153177
  author: kulinaris
  author_email: kulinaris4you@gmail.com
  author_url: http://zastolie4you.ru/
  date: '2013-05-04 01:03:44 +0400'
  date_gmt: '2013-05-03 21:03:44 +0400'
  content: "\"Текст мне, в принципе, и не нужен в \"похожих записях\". ))\" - ну енто
    смотря где и смотря как... \r\nЕсли развлекаловка и многова картиночек - то превьюшки
    самое то!!! \r\nА от если чёйто сурьёзное 8-| и это самое, как оно называицца...
    а, от вспомнил! - пери... не перелинковать что-то нада - дело другое совсем...
    \r\nБлин, из-за этих майских праздников жОна до компа не пущает - усё по шашлЫкам
    хожу-брожу, тока заснет - я за комп, а чайник ужо не варит ничего пока не смог
    попробовать вашу вкусняшку..."
- id: 153225
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-05-04 03:07:39 +0400'
  date_gmt: '2013-05-03 23:07:39 +0400'
  content: "Да, это всё зависит от конкретной задачи. Безусловно. И я думаю, что привьюшки
    вообще почти везде подойдут, ведь голый текст особо никого не радует, а когда
    картинки, да ещё и тематичные, то тут сразу в пляс пуститься хочется.\r\n\r\nИ
    на самом деле привьюшки получить не так сложно. Всё это реализуемо. Главное чтобы
    энтузиазм был =)"
- id: 153229
  author: Serpent
  author_email: rubtsov-gel@yandex.ru
  author_url: http://rubtsow.ru/
  date: '2013-05-04 03:14:29 +0400'
  date_gmt: '2013-05-03 23:14:29 +0400'
  content: Читая вашу переписку в почте мне прямо-таки захотелось пуститься в пляс,
    радуясь грядущим изменениям в коде. ))) Правда, с тростью это немного проблематично,
    но это уже мелочи.
- id: 153431
  author: Serpent
  author_email: rubtsov-gel@yandex.ru
  author_url: http://rubtsow.ru
  date: '2013-05-04 14:18:51 +0400'
  date_gmt: '2013-05-04 10:18:51 +0400'
  content: "А как тебе такой вариант?\n\n<code>                  \n<div class=\"box
    more_from_site\">\n     <h3>Еще с сайта:<&#47;h3>\n     <?php $main_post = $post;\n
    \        $yet_displayed = array();\n         $categories = get_the_category();\n
    \        $del_post = $post->ID;\n         foreach ($categories as $category) :\n
    \    ?>                           \n         <ul class=\"examples\">\n            <?php\n
    \               $posts = get_posts('numberposts=5&category='. $category->term_id.
    '&exclude='.$del_post);\n                foreach($posts as $post) :\n                if(
    !in_array($post->ID, $yet_displayed) ){\n            ?>\n            <li>\n                <a
    href=\"<?php the_permalink() ?>\" title=\"<?php the_title(); ?>\">\n                   <?php
    the_post_thumbnail(); ?>\n                <&#47;a>\n                                        \n
    \               <a href=\"<?php the_permalink(); ?>\"><?php the_title(); ?><&#47;a>\n
    \           <&#47;li>                                                           \n
    \           <?php  }\n                 $yet_displayed[] = $post->ID;    \n                 endforeach;
    \ \n                 endforeach; ?>\n       <?php $post = $main_post; ?>\n          <&#47;ul>
    \       \n <&#47;div><!-- End box -->\t\n<&#47;code>"
- id: 153556
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-05-04 23:05:15 +0400'
  date_gmt: '2013-05-04 19:05:15 +0400'
  content: Ну обычный алгоритм. Простой и с привьюшками. Нормальный. Нечто подобное
    у меня стояло давно.
- id: 153573
  author: Екатерина
  author_email: katrina565@gmail.com
  author_url: http://donturistik.ru/
  date: '2013-05-04 23:57:31 +0400'
  date_gmt: '2013-05-04 19:57:31 +0400'
  content: Отлично все работает, смотрится - просто супер, превьюшки очень украшают,
    спасибо за индивидуальную реализацию :) Что касается "похожести" статей, то тут
    не всегда 100% попадание, но мне даже нравится - некое разнообразие на странице,
    а если посетитель захочет почитать конкретно по теме, то для этого есть рубрики.
- id: 153895
  author: Светлана
  author_email: snegurka.75@mail.ru
  author_url: ''
  date: '2013-05-06 16:30:55 +0400'
  date_gmt: '2013-05-06 12:30:55 +0400'
  content: Простите, что не по теме... Расскажите пожалуйста, как сделать слайдер
    со статьями (как у вас на сайте на гл. странице). Спасибо.
- id: 153901
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-05-06 16:46:07 +0400'
  date_gmt: '2013-05-06 12:46:07 +0400'
  content: |-
    И правда не по теме. В следующий раз наверно лучше либо искать пост по теме, либо в почту. Ну ничего, не расстраивайтесь =)))

    Для карусели используется <a href="http:&#47;&#47;www.dynamicdrive.com&#47;dynamicindex4&#47;stepcarousel.htm" target="_blank" rel="nofollow">это<&#47;a>. Там на английском и относительно сложно, если у вас опыта мало в этом, потому можно любую другую карусель найти. Их огромные кучи. Просто чуток <a href="https:&#47;&#47;www.google.ru&#47;search?q=jquery+карусель" target="_blank" rel="nofollow">погуглите<&#47;a>.
- id: 155997
  author: kulinaris
  author_email: kulinaris4you@gmail.com
  author_url: http://zastolie4you.ru/
  date: '2013-05-12 20:37:34 +0400'
  date_gmt: '2013-05-12 16:37:34 +0400'
  content: "УсЁ фунциклирует в лучшем виде. Еще раз большое спасибо! \r\nА вот отдельная
    функция, но с превьюшками, я думаю пользовалась бы популярностью..."
- id: 156046
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-05-12 23:16:28 +0400'
  date_gmt: '2013-05-12 19:16:28 +0400'
  content: Сделаю как-нибудь отдельно с привьюшками =)
- id: 164581
  author: kotkem
  author_email: kotkem@yandex.ru
  author_url: http://mudrikon.ru/
  date: '2013-06-04 18:57:29 +0400'
  date_gmt: '2013-06-04 14:57:29 +0400'
  content: Здравствуйте. Что-то у меня совсем не похожие статьи вылазиют.  В чем проблема?
    http:&#47;&#47;sport-kosa.ru&#47;
- id: 164599
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-06-05 00:55:14 +0400'
  date_gmt: '2013-06-04 20:55:14 +0400'
  content: "Я надеюсь статью читали. Там сказано, что чем лучше оптимизированы статьи,
    тем лучше работает алгоритм. Хотя конечно раз на раз не приходится =) ПОпытайтесь
    поиграться настройками. Так же может быть такое что вы в ваших статья часто используете
    какое-то слово-паразит, которое к тематике не имеет отношение а вес при отборе
    стати на себя перетягивает. Тогда его можно тоже в стоп-слова добавить =) \n\nТак
    же может быть что для конкретной статьи просто нет похожих или они только  в понимании
    человека похожи а словами в ней это не выражено.\n\nPS: я поглядел результаты
    в разных статьях и мне результаты показались более-менее похожими."
- id: 165868
  author: Поток Сознания
  author_email: hulitolku@gmail.com
  author_url: http://www.ruszud.com
  date: '2013-06-11 00:52:15 +0400'
  date_gmt: '2013-06-10 20:52:15 +0400'
  content: а превьюхи как прикрутить?
- id: 165881
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-06-11 01:31:26 +0400'
  date_gmt: '2013-06-10 21:31:26 +0400'
  content: "Если используются миниатюры для статьи, то можно их получать для каждой
    статьи. Если они не используется, то выдирать первую картинку из статьи, но это
    не всегда будет красиво. Первый вариант примерно так:\r\n<code>\r\nif ( has_post_thumbnail($result->ID)
    ) {\r\n\t$image_id = get_post_thumbnail_id($result->ID);\r\n\t$thumbnail = wp_get_attachment_image_src($image_id,
    'thumbnail', true);\r\n\t$thumbnail = $thumbnail[0];\r\n}\t<&#47;code>\r\nТак
    мы получаем миниатюру для указанного поста. В переменной <em>$thumbnail<&#47;em>
    лежит адрес картинки. Вставить её можно в любое место примерно так:\r\n<code><img
    src=\"'.$thumbnail.'\"&#47;><&#47;code>\r\n\r\nPS: это почти готовое решение,
    но я не проверял. Остальное надеюсь сами додумаете. Я указал Вам дверь, войти
    в нее Вы должны сами! (с)"
- id: 168093
  author: Galina
  author_email: galach63@gmail.com
  author_url: http://dampal.ru/
  date: '2013-06-20 14:57:07 +0400'
  date_gmt: '2013-06-20 10:57:07 +0400'
  content: Внимательно прочитала Вашу статью и сделала все, как написано. Результат
    просто супер! Спасибо большое за то, что так подробно написали. Я не спец по таким
    делам, только начинаю. Поэтому мне необходимо все разжевывать. И Ваша статья именно
    то, что мне нужно. У меня тоже не всегда похожие статьи попадают в десятку. Ничего,
    будем работать.
- id: 177060
  author: Котан
  author_email: freedommailmoney@mail.ru
  author_url: ''
  date: '2013-07-30 16:54:52 +0400'
  date_gmt: '2013-07-30 12:54:52 +0400'
  content: Здравствуйте SlowProg. Простите что пишу не по теме,  но у меня есть вопросик.
    На своем сайте хочу сделать благодарность первого комментария, но не хочу что
    бы она выводилась в новой странице. Возможно ли сделать так, что бы благодарность
    показалась в маленьком всплывающем окне? Я уже на плагины согласен, ради такой
    фишки, но не могу найти... Движ - wordpress.
- id: 177143
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-07-31 00:43:54 +0400'
  date_gmt: '2013-07-30 20:43:54 +0400'
  content: 'Сделать конечно же такое можно, но вот плагинов я таких не припомню. Нужно
    писать клиентскую и серверную часть самому. Можно два подхода: либо после перегузки
    страницы (отправки коммента) показывать окошко, либо сделать ajax-комментарии
    и прямо тут же динамически показывать окошко. Задача конечно не самая тривиальная.
    Если что, то я за такое только платно возьмусь =)'
- id: 182465
  author: Zakhar
  author_email: zmartov@gmail.com
  author_url: ''
  date: '2013-09-02 03:44:33 +0400'
  date_gmt: '2013-09-01 23:44:33 +0400'
  content: "А можно ли используя имеющийся формат вывода похожих записей сделать поиск
    похожих записей непосредственно по рубрикам и&#47;или меткам? Так как используя
    данный алгоритм не всегда выводятся схожие записи. С настройками экспериментировал,
    существенно ситуация не поменялась.\r\nИ еще, по вашему же примеру прикрутил миниатюры,
    но почему-то внекоторых записях у нескольких постов в списке выводятся одинаковые
    миниатюры..."
- id: 182493
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2013-09-02 11:31:50 +0400'
  date_gmt: '2013-09-02 07:31:50 +0400'
  content: Хм хм, сделать конечно можно, но сейчас у меня не особо времени есть на
    это. Но это определённо должно улучшить поиск статей, хотя запрос в базу данных
    будет сложнее, а значит дольше, но не так чтобы было критично =)
- id: 228168
  author: Стас
  author_email: post@stasusenko.com
  author_url: ''
  date: '2014-04-01 02:00:18 +0400'
  date_gmt: '2014-03-31 22:00:18 +0400'
  content: "Здравствуйте! А можно ли исключить из поиска определённые рубрики по ID?
    Я php не знаю в доскональности но интуитивно:\r\n\r\n$stopCat = array('23,34,36');\r\n\r\nЧто
    скажете?"
- id: 228171
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2014-04-01 02:22:28 +0400'
  date_gmt: '2014-03-31 22:22:28 +0400'
  content: Да, конечно это возможно. Но необходимы существенные изменения, которые
    мне сейчас некогда делать (сейчас спать, а завтра и в ближайшие дни я очень занят).
    Но в общем и целом необходимо переписать запрос в базу данных, думаю, он станет
    работать медленнее, но если это необходимо, то оно того стоит. В запросе надо
    будет присоединить таблицу с категориями и уже в ней производить отсеивание. Кода
    добавится&#47;изменится прилично.
- id: 235111
  author: Андрей
  author_email: lethalblo@mail.ru
  author_url: ''
  date: '2014-07-08 16:39:05 +0400'
  date_gmt: '2014-07-08 12:39:05 +0400'
  content: Здравствуй, подскажи как можно вывести картинку, не используя миниатюры,
    то-есть чтоб цепляло первую картинку с поста и показывало в похожих постах. У
    меня по такому принципу работает плагин, от которого хочу избавится, миниатюры
    я не загружал...
- id: 235114
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2014-07-08 17:33:54 +0400'
  date_gmt: '2014-07-08 13:33:54 +0400'
  content: "Придётся из всего текста статьи выдирать первую картинку регуляркой. Например,
    допустим, что в переменной <em>$postContent<&#47;em> находится текст статьи, тогда
    код извлекающий первую картинку будет такой:\r\n\r\n<code>preg_match_all('&#47;<img.+src=[\\'\"]([^\\'\"]+)[\\'\"].*>&#47;i',
    $postContent, $matches);\r\n$firstImg = $matches [1] [0];<&#47;code>\r\n\r\nСоответственно
    в переменной <em>$firstImg<&#47;em> будет адрес первой картинки. А дальше уже
    выводите картинку, где хотите.\r\n\r\nВ моём коде в цикле перебирающем результат
    запроса текст статьи находится в переменной <em>$result->post_content<&#47;em>.
    Эту переменную и парсите. А выводить картинку уже как хотите, но так или иначе
    придётся код формирования всей привьюшки статьи переделать.\r\n\r\nПодсказал =)"
- id: 235118
  author: Андрей
  author_email: lethalblo@mail.ru
  author_url: ''
  date: '2014-07-08 21:19:46 +0400'
  date_gmt: '2014-07-08 17:19:46 +0400'
  content: "Пробовал по разному не получается вывести, можешь показать куда конкретно
    этот кусок кода нужно внедрить на примере этого кода, или своего кода. Заранее
    спасибо.\r\n\r\n<code>preg_match_all('&#47;<img.+src=[\\'\"]([^\\'\"]+)[\\'\"].*>&#47;i',
    $postContent, $matches);\r\n$firstImg = $matches [1] [0];<&#47;code>\r\n\r\n\r\n<code>function
    digatalart_cat_rel_post(){\r\n    global $post;\r\n    $categories = get_the_category($post->ID);\r\n
    \   if($categories){\r\n        $category_ids = array();\r\n        foreach($categories
    as $individual_category) $category_ids[] = $individual_category->term_id;    \r\n
    \       $args = array(\r\n            'category__in' => $category_ids,\r\n            'post__not_in'
    => array($post->ID),\r\n            'showposts'=> 5, &#47;&#47; Количество выводимых
    похожих записей.\r\n            'caller_get_posts' => 1\r\n        );\r\n        $my_query
    = new wp_query($args);\r\n        if($my_query->have_posts()){\r\n            echo
    '<ul id=\"relPost\">';\r\n            while($my_query->have_posts()){\r\n                $my_query->the_post();\r\n
    \           ?>\r\n                <li><a href=\"<?php the_permalink() ?>\" title=\"<?php
    the_title_attribute(); ?>\"><?php the_title(); ?><&#47;a><&#47;li>\r\n            <?php\r\n
    \           }\r\n            echo '<&#47;ul>';\r\n        }\r\n        else{\r\n
    \           echo '<p>Другие записи по теме отсутсвуют.<&#47;p>';\r\n        }\r\n
    \       wp_reset_postdata();\r\n    }\r\n}<&#47;code>"
- id: 235128
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2014-07-09 10:02:00 +0400'
  date_gmt: '2014-07-09 06:02:00 +0400'
  content: "В общем случае выглядит так:\r\n\r\n<code>function digatalart_cat_rel_post(){\r\n
    \   global $post;\r\n    $categories = get_the_category($post->ID);\r\n    if($categories){\r\n
    \       $category_ids = array();\r\n        foreach($categories as $individual_category)
    $category_ids[] = $individual_category->term_id;    \r\n        $args = array(\r\n
    \           'category__in' => $category_ids,\r\n            'post__not_in' =>
    array($post->ID),\r\n            'showposts'=> 5, &#47;&#47; Количество выводимых
    похожих записей.\r\n            'caller_get_posts' => 1\r\n        );\r\n        $my_query
    = new wp_query($args);\r\n        if($my_query->have_posts()){\r\n            echo
    '<ul id=\"relPost\">';\r\n            while($my_query->have_posts()){\r\n                $my_query->the_post();\r\n
    \               preg_match_all('&#47;<img.+src=[\\'\"]([^\\'\"]+)[\\'\"].*>&#47;i',
    get_the_content(), $matches);\r\n                $firstImg = $matches [1] [0];\r\n
    \           ?>\r\n                <li><?php echo $firstImg?'<img src=\"'.$firstImg.'\">':'';
    ?><a href=\"<?php the_permalink() ?>\" title=\"<?php the_title_attribute(); ?>\"><?php
    the_title(); ?><&#47;a><&#47;li>\r\n            <?php\r\n            }\r\n            echo
    '<&#47;ul>';\r\n        }\r\n        else{\r\n            echo '<p>Другие записи
    по теме отсутсвуют.<&#47;p>';\r\n        }\r\n        wp_reset_postdata();\r\n
    \   }\r\n}<&#47;code>\r\n\r\nДальше уже дело за вами: настроить вывод, чтобы всё
    было красиво"
- id: 237241
  author: Никита
  author_email: calmlifee@gmail.com
  author_url: http://calm-life.ru/
  date: '2014-08-22 18:09:10 +0400'
  date_gmt: '2014-08-22 14:09:10 +0400'
  content: Добрый день. Спасибо за качественный скрипт. Все работает прекрасно. одна
    проблема сниппет во всю ширину , и поэтому страница вместе с ним становиться широкой,
    что даже сайдбар улетает в низ . Помоги с этим вопросом знаю что дело скорее всего
    в стилях не пойму что именно...
- id: 237257
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2014-08-22 21:27:31 +0400'
  date_gmt: '2014-08-22 17:27:31 +0400'
  content: |-
    Я не могу сказать что не так со стилями не видя примера. Но поглядев в ваши стили на сайте могу предположить, что вам нужно сделать ширину виджета фиксированной на ширину столбца с контентом, примерно так, наверно:

    <code>.related-posts {
    width: 635px;
    }<&#47;code>
- id: 237273
  author: Никита
  author_email: calmlifee@gmail.com
  author_url: http://calm-life.ru/
  date: '2014-08-23 02:21:03 +0400'
  date_gmt: '2014-08-22 22:21:03 +0400'
  content: К сожалению это не помогло...
- id: 237282
  author: Никита
  author_email: calmlifee@gmail.com
  author_url: http://calm-life.ru/
  date: '2014-08-23 06:12:31 +0400'
  date_gmt: '2014-08-23 02:12:31 +0400'
  content: Может есть еще какие-то идеи на этот счет?
- id: 237283
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2014-08-23 06:17:44 +0400'
  date_gmt: '2014-08-23 02:17:44 +0400'
  content: Я не могу ничего сказать не понимая что происходит. Например, я не представляю
    куда вы вставляете похожие статьи. Предпологаю что после соц. кнопок, но тогда
    всё должно работать. Поскольку я сам проверил. Динамически вставил свой список
    похожих статей вам в страницу и применил стиль выше. Всё было норм. Ну так или
    иначе если виджет растягивается на всю страницу, то надо задать ему стиль width
    соответствующий ширине колонки куда он вставляется. При этом необходимо проверить
    чтобы  других стилей .related-posts с width не было. Может быть у вас в стилях
    лишнее что-то завалялось.
- id: 238864
  author: Никита
  author_email: calmlifee@gmail.com
  author_url: http://calm-life.ru/
  date: '2014-09-26 22:40:03 +0400'
  date_gmt: '2014-09-26 18:40:03 +0400'
  content: Каким то чудом все исправил) Вывел похожие статьи так, как хотел с самого
    начала! Спасибо за скрипт!
- id: 239166
  author: олег
  author_email: byuanov1@rambler.ru
  author_url: http://byuanov-ed.ru
  date: '2014-10-01 09:30:19 +0400'
  date_gmt: '2014-10-01 05:30:19 +0400'
  content: "Всё сделал. Получилось! Главное что функция уникальная. Математически
    находит подходящие слова. В плагинах такого нет, там или по меткам или из рубрики
    и всё. А здесь выводит и из разных рубрик.\r\nНо хотелось бы про картинки подробнее
    куда, что вставлять. И сами похожие заметки в рамочках. К примеру 5 похожих заметок
    - 5 рамочек. А вообще это просто супер вариант. Плагины отдыхают. Спасибо!"
- id: 239177
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2014-10-01 13:10:14 +0400'
  date_gmt: '2014-10-01 09:10:14 +0400'
  content: "Плохо, надо учиться и разбираться хотя бы на базовом уровне чтобы читать
    код, понимать код и вставлять куда нужно код. Манипуляции крайне не сложные.\r\n\r\nДля
    картинок вместо 80 строки вставить следующее:\r\n\r\n<code>$thumbnail = '';\r\nif
    ( has_post_thumbnail($result->ID) ) {\r\n    $image_id = get_post_thumbnail_id($result->ID);\r\n
    \   $thumbnail = wp_get_attachment_image_src($image_id, 'thumbnail', true);\r\n
    \   $thumbnail = $thumbnail[0];\r\n    $thumbnail = '<span class=\"image\"><img
    src=\"'.$thumbnail.'\"&#47;><&#47;span>';\r\n}\r\n$return .= '<li>'.$thumbnail.'<a
    title=\"'.$result->post_title.'\" href=\"'.get_permalink($result->ID).'\">'.$result->post_title.'<&#47;a>';<&#47;code>\r\n\r\nИ
    далее в <em>style.css<&#47;em> вставить стили для этой самой картинки:\r\n\r\n<code>.related-posts
    .image {\r\nfloat: left;\r\nmargin: 0 10px 0 0;\r\nwidth: 80px;\r\n}<&#47;code>\r\n\r\nКод
    я не проверял, потому могут быть баги. Если будут, то ваше домашнее задание их
    пофиксить. Надо же учиться.\r\n\r\nПод рамочками имеется в виду бордер? Если я
    правильно понял, то нужно добавить следующий стиль:\r\n\r\n<code>.related-posts
    li {\r\nborder: 1px solid #777;\r\npadding: 5px;\r\n}<&#47;code>\r\n\r\nНо я бы
    не сказал, что это затея хороша. Бордеры редко когда смотрятся красиво. Я ими
    не злоупотребляю никогда. Только в исключительных случаях."
- id: 239843
  author: Никита
  author_email: calmlifee@gmail.com
  author_url: http://calm-life.ru/
  date: '2014-10-14 20:24:03 +0400'
  date_gmt: '2014-10-14 16:24:03 +0400'
  content: таким образом подключаются миниатюры или выдергиваются первые картинки
    с поста?
- id: 239845
  author: Никита
  author_email: calmlifee@gmail.com
  author_url: http://calm-life.ru/
  date: '2014-10-14 20:37:02 +0400'
  date_gmt: '2014-10-14 16:37:02 +0400'
  content: кстати код не работает, миниатюры не появились
- id: 239889
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2014-10-15 13:58:23 +0400'
  date_gmt: '2014-10-15 09:58:23 +0400'
  content: Код должен подключать миниатюры. Но как я и написал он может и не работать
    поскольку я не проверял. Смотрите какие ошибки выводятся в лог и исправляйте что
    не так. В общем, код верный, но с багами =)
- id: 247877
  author: Сергей
  author_email: siglov.s@yandex.ru
  author_url: ''
  date: '2015-03-04 21:49:46 +0300'
  date_gmt: '2015-03-04 17:49:46 +0300'
  content: Спасибо за код, поставил, работает всё прекрасно. Есть одна неприятность,
    после того как поставил код, мой счетчик картинка feedburner стал мне показывать
    10 подписчиков вместо 10450 подписчиков, может подскажешь что не так? Кстати,
    я заходил на свой фид и там действительно стоит на счетчике- картинке 10 подписчиков,
    а когда перехожу в Управление подписчиками, то там уже стоит цифра в 10090.
- id: 247898
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2015-03-05 14:53:24 +0300'
  date_gmt: '2015-03-05 10:53:24 +0300'
  content: Сомневаюсь что код безплагина как-то может влиять на это. Тем более если
    в самом фиде цифра поменялась. Думаю тут проблема в чём-то другом. Может само
    пройдёт =)
---
<p><a href="http:&#47;&#47;image.paperplane.su&#47;2013&#47;05&#47;related-posts.png"><img src="http:&#47;&#47;image.paperplane.su&#47;2013&#47;05&#47;related-posts-300x300.png" alt="Похожие статьи без плагина" title="Похожие статьи без плагина" width="300" height="300" class="alignleft size-medium wp-image-2899" &#47;><&#47;a>Долго я обещал сделать скрипт для создания виджета похожих статей без плагина на WordPress и наконец-то мои руки дошли до этого. Вообще сам по себе скрипт был написан мной уже достаточно давно и применяется с тех пор на моих проектах, но то скрипт! Статью же про него написать это уже отдельная история и сегодня я вам о ней поведаю. Примененный мной алгоритма поиск похожих статей не является кардинально новым, в том смысле, что идея довольно очевидна, потому, думаю, я не первый. Но тем не менее, подобной реализации под WordPress я еще не видел нигде, так что встречайте.</p>
<h2>Немного о печеньках<&#47;h2><br />
Вкратце суть алгоритма можно описать так. Берется весь текст статьи, для которой нужно найти похожие, подсчитываем сколько раз встречается то или иное слово, находим самые популярные (за вычетом стоп-слов), которые как бы должны отражать суть статьи, и при помощи них строем запрос в базу, который ищет самые релевантные статьи под эти популярные слова. Т.е. всё упирается в поиск правильных слов, которые бы отражали суть поста, но обычно так и бывает, если статья о помидорах, то слово <em>помидор<&#47;em> в разных вариациях в ней должно встречаться часто. Потому этот алгоритм будет особенно хорошо работать на грамотно оптимизированных статья, где частота вхождения ключевых слов чуть больше, чем других ну или что-то около того.</p>
<p>Плюс хорошей фичей является возможность вывода описания текста в виде отрывка из его начала (сниппета). Кому такой подход не нравится тот конечно может его и не применять, но, мне кажется, что это принесёт только пользу. Во-первых, читателя могут заманить ключевые фразы из описания (которые при правильной оптимизации текста всегда будут находится в самом начале и будут попадать в этот сниппет), что продлит его пребывание на вашем сайте, увеличит просмотры, и как следствие, конверсию. Во-вторых, это увеличит общий объём вашего контента на странице, да ещё и насытит его похожими ключевыми словами (т.к. посты-то похожие), что безусловно понравится поисковикам. Так что в свете этих двух фактов, я рекомендую включить описательные сниппеты для похожих статей, хотя бы короткие.</p>
<p>Так же заранее предупреждаю, что функция работает немного дольше, чем простенькие алгоритмы подбора похожих постов, по типу посты из одной категории или по меткам. Я конечно этого не проверял, но мне так кажется, что работать она должна немного дольше, зато результат будет по-настоящему похожие статьи не взирая на метки и категории.</p>
<h2>Код функции<&#47;h2><br />
Ближе к делу. Код функции получился большой, так что не пугайтесь, всё таки он проводит небольшой контент-анализ поста. Весь ниже представленный код вам нужно разместить в <em>functions.php<&#47;em>:</p>
<p>[cce_php]<br />
&#47;*<br />
 * функция нахождения похожих статей<br />
 *<br />
 * @param integer $id - идентификатор анализируемого поста<br />
 *&#47;<br />
function sp_related_posts($id){<br />
	global $wpdb;</p>
<p>	$countArticle = 5;	&#47;&#47; количество похожих статей<br />
	$isDescription = true;	&#47;&#47; описание для каждой статьи<br />
	$descriptionLen = 200;	&#47;&#47; если включено описание, то какой длинные его делать</p>
<p>	$countWords = 6;	&#47;&#47; количество слов в конечном итоге для анализа<br />
	$minLengthWord = 3;	&#47;&#47; минимальная длинна анализируемого слова, остальные отсеиваются<br />
	$factorTitle = 0.2;	&#47;&#47; эмпирический коэффициент участвующий в расчёте веса слов из заголовка<br />
	$factorText = 0.9;	&#47;&#47; эмпирический коэффициент участвующий в расчёте веса слов из текста<br />
	$stopWords = array('они', 'том', 'тот', 'обо', 'она', 'три', 'без', 'ста', 'сто', 'них', 'там', 'тем', 'тут', 'оба', 'той', 'оно', 'под', 'сам', 'чьё', 'эта', 'эти', 'про', 'ней', 'это', 'чье', 'ото', 'ним', 'час', 'при', 'чей', 'чем', 'чья', 'что', 'уже', 'всю', 'ему', 'его', 'для', 'два', 'еще', 'ещё', 'изо', 'ибо', 'нет', 'год', 'где', 'вас', 'вам', 'был', 'вне', 'вот', 'вся', 'всё', 'все', 'или', 'эту', 'мой', 'мог', 'мне', 'так', 'над', 'нам', 'неё', 'нее', 'наш', 'нас', 'кто', 'мои', 'как', 'раз', 'моя', 'буду', 'этой', 'свое', 'тема', 'того', 'темы', 'тему', 'теме', 'твой', 'себе', 'этом', 'чуть', 'тебя', 'чтоб', 'куда', 'свою', 'чего', 'хотя', 'хоть', 'часу', 'этот', 'тоже', 'меня', 'могу', 'либо', 'ином', 'иной', 'надо', 'него', 'пять', 'сами', 'оный', 'один', 'ноль', 'есть', 'если', 'быть', 'ведь', 'было', 'были', 'была', 'весь', 'вниз', 'день', 'даже', 'всех', 'всей', 'свой', 'лишь', 'себя', 'семь', 'стал', 'из-за', 'кроме', 'можно', 'какой', 'через', 'таких', 'разве', 'когда', 'лучше', 'какое', 'потом', 'может', 'такою', 'такую', 'такие', 'перед', 'таком', 'также', 'между', 'вдоль', 'много', 'такое', 'точно', 'стали', 'стать', 'будем', 'давай', 'среди', 'всего', 'стала', 'видно', 'тогда', 'внизу', 'давно', 'сразу', 'здесь', 'знать', 'иметь', 'назад', 'зачем', 'таким', 'долго', 'такой', 'будут', 'такая', 'снова', 'тысяч', 'самим', 'опять', 'около', 'чтобы', 'после', 'самой', 'темою', 'будет', 'будто', 'редко', 'шесть', 'самая', 'часто', 'очень', 'темой', 'жизнь', 'самый', 'пусть', 'темам', 'вдруг', 'самым', 'этого', 'прямо', 'некто', 'никто', 'равно', 'какая', 'темах', 'почти', 'более', 'только', 'четыре', 'самому', 'десять', 'вместо', 'будете', 'теперь', 'девять', 'далеко', 'всегда', 'будешь', 'ребята', 'восемь', 'внутри', 'вокруг', 'давать', 'похоже', 'однако', 'иногда', 'такого', 'ничего', 'сказал', 'хорошо', 'нельзя', 'тысячу', 'тысячи', 'темами', 'тысяча', 'такому', 'больше', 'отчего', 'почему', 'потому', 'совсем', 'сейчас', 'другие', 'именно', 'другой', 'нибудь', 'каждым', 'такими', 'другое', 'каждый', 'большой', 'каждому', 'которые', 'конечно', 'человек', 'сначала', 'каждого', 'впрочем', 'кажется', 'никогда', 'сказали', 'сказать', 'недавно', 'сегодня', 'который', 'говорил', 'говорят', 'спасибо', 'говорим', 'другого', 'наконец', 'сказала', 'особенно', 'говорили', 'навсегда', 'говорить', 'которого', 'несколько', 'достаточно', 'пожалуйста');<br />
	$stopSymbols = array('&mdash;', '&ndash;', '_', '"', '&lsquo;', '&rsquo;', '&sbquo;', '&ldquo;', '&rdquo;', '&bdquo;', '"', 'x27', 'x22', 'x60', '\t', '\n', '\r', '\'', ',', '.', '&#47;', '\\\', '&laquo;', '&raquo;', '#', ';', ':', '@', '~', '[', ']', '{', '}', '=', '-', '+', ')', '(', '*', '&', '^', '%', '$', '<', '>', '?', '!');</p>
<p>	$post = get_post($id);<br />
	$title = $post->title;<br />
	$text = $post->post_content;</p>
<p>	$text = strip_tags($title.' '.$text);<br />
	&#47;&#47; вначале убираем все стоп-символы и лишние пробелы из текста<br />
	foreach ($stopSymbols as $symbol)<br />
			$text = str_replace($symbol, ' ',$text);<br />
	&#47;&#47; переводим текст в массив, разделяя элементы пробелом<br />
	$text = explode(' ', mb_strtolower(trim($text)));<br />
	&#47;&#47; убираем все стоп-слова<br />
	$text = array_diff($text, $stopWords);<br />
	&#47;&#47; считаем частоту повторения каждого слова<br />
	$text = array_count_values($text);<br />
	arsort($text);<br />
	$text = array_keys($text);<br />
	&#47;&#47; убираем окончания<br />
	$words=array();<br />
	foreach($text as $word) {<br />
		if (strlen($word) >= $minLengthWord) {	&#47;&#47; оставляем слова только длинной больше $minLengthWord<br />
			&#47;&#47; От слов длиннее 7 символов отрезать 2 последних буквы<br />
			if (strlen($word) > 7) {<br />
				$word=substr($word,0,(strlen($word)-2));<br />
			}<br />
			&#47;&#47; От слов длиннее 5 символов отрезать последнюю букву<br />
			elseif (strlen($word) > 5) {<br />
				$word=substr($word,0,(strlen($word)-1));<br />
			}<br />
			$words[]=addcslashes(addslashes($word),'%_');<br />
		}<br />
	}</p>
<p>	$words = array_slice($words, 0, $countWords);</p>
<p>	$where = "";<br />
	$select = "(";<br />
	&#47;&#47; Условия для каждого из слов<br />
	foreach($words as $word) {<br />
		$select .= "IF (post_title LIKE '%".$word."%', ".$factorTitle.", 0) + IF (post_content LIKE '%".$word."%', ".$factorText.", 0) + ";<br />
		$where .= "post_title LIKE '%".$word."%' OR post_content LIKE '%".$word."%' OR ";<br />
	}<br />
	$select = substr($select, 0, -2);	&#47;&#47; убираем последние два символа (плюсик и пробел)<br />
	$select.=") AS relevant";<br />
	$where = substr($where, 0, -3);	&#47;&#47; убираем последние три символа (OR и пробел)</p>
<p>	$results = $wpdb->get_results('<br />
		SELECT<br />
			ID, post_title, '.($isDescription?'post_content, ':'').$select.'<br />
		FROM<br />
			'.$wpdb->posts.'<br />
		WHERE<br />
			('.$where.' ) AND post_status = "publish" AND post_type = "post" AND ID <> '.$id.'<br />
		ORDER BY<br />
			relevant DESC<br />
		LIMIT '.$countArticle<br />
	);</p>
<p>	if (!empty($results)) {<br />
		$return = '
<div class="related-posts">
<ul>';<br />
		foreach($results as $result){<br />
			$return .= '
<li><a title="'.$result->post_title.'" href="'.get_permalink($result->ID).'">'.$result->post_title.'<&#47;a>';<br />
			if ($isDescription and $descriptionLen > 0 and $result->post_content) {	&#47;&#47; если описание для статей нужно, то вставляем его убрав лишние теги сократив до нужной длинны до пробела<br />
				$descriptionSrc = strip_tags($result->post_content);<br />
				$len = (mb_strlen($descriptionSrc) > $descriptionLen)<br />
					? mb_strripos(mb_substr($descriptionSrc, 0, $descriptionLen), ' ')<br />
					: $descriptionLen<br />
				;<br />
				$description = mb_substr($descriptionSrc, 0, $len);<br />
				$description = (mb_strlen($descriptionSrc) > $descriptionLen)<br />
					? $description . '...'<br />
					: $description<br />
				;</p>
<p>				$return .= ' - <span class="post-description">'.$description.'<&#47;span>';<br />
			}<br />
			$return .= '<&#47;li>';<br />
		}<br />
		$return .= '<&#47;ul><&#47;div>';<br />
		echo $return;<br />
	}<br />
}<br />
[&#47;cce_php]</p>
<p>Если вы не знаете, как вставлять код или у вас возникли проблемы с этим, то читайте статью о <a href="http:&#47;&#47;paperplane.su&#47;insert-functions-wordpress&#47;" title="Вставка кода в functions.php" target="_blank">вставке кода в functions.php<&#47;a>.</p>
<p>Как я уже говорил, функция получилась довольно большой, но зато работает и выполняет, то что от неё требуется. И плюс ко всему, как всегда, функция получилась довольно гибкая благодаря нескольким переменным в самом её начале. Давайте разберём, что значит каждая из этих переменных, и как они влияют на процесс отбора похожих статей:</p>
<ul>
<li><em>$countArticle<&#47;em> &mdash; переменная для обозначения максимального количества похожих статей, которое вам нужно получить. По умолчанию равно 5, т.е. вам выведутся 5 похожих постов.<&#47;li>
<li><em>$isDescription<&#47;em> &mdash; булеановская переменная, отвечающая за вывод описательного сниппета к каждой статье. Если true &mdash; сниппет будет выводится, false &mdash; не будет.<&#47;li>
<li><em>$descriptionLen<&#47;em> &mdash; переменная отвечающая за длину выводимого сниппета. Она имеет смысл только когда <em>$isDescription = true<&#47;em>, в противном случае эта переменная не используется. Прошу обратить внимание, что сниппет обрезается на последнем пробеле перед превышением максимальной разрешённой длинны. Это значит, что у вас не будет оборванных на середине слов.<&#47;li>
<li><em>$countWords<&#47;em> &mdash; переменная отвечающая за максимальное количество слов, которое будет отобрано из всего анализируемого текста для подбора похожих статей. Играясь с этой переменной вы можете улучшить (ухудшить) результата работы функции.<&#47;li>
<li><em>$minLengthWord<&#47;em> &mdash; переменная отвечающая за минимальную длину анализируемого слова, все слова короче будут автоматически отброшены. Она необходима, чтобы ускорить работу функции и откинуть лишние короткие слова. Играясь с этой переменной вы можете улучшить (ухудшить) результата работы функции. Хотя по умолчанию она равна 3, что, я думаю, довольно компромиссно.<&#47;li>
<li><em>$factorTitle<&#47;em> &mdash; переменная содержащая эмпирический коэффициент для расчёта веса слов из заголовка поста в запросе в базу. Ей можно присваивать любые числа. Играясь с этой переменной вы можете улучшить (ухудшить) результата работы функции.<&#47;li>
<li><em>$factorText<&#47;em> &mdash; переменная содержащая эмпирический коэффициент для расчёта веса слов из текста поста в запросе в базу. Ей можно присваивать любые числа. Играясь с этой переменной вы можете улучшить (ухудшить) результата работы функции.<&#47;li>
<li><em>$stopWords<&#47;em> &mdash; массив со стоп-словами, которые отсеиваются на этапе контент-анализа текста. Более подробно читайте ниже.<&#47;li>
<li><em>$stopSymbols<&#47;em> &mdash; массив со стоп-символов, которые отсеиваются на этапе контент-анализа текста. Этот список содержит все символы, которые могут помешать и являются лишними.<&#47;li><br />
<&#47;ul><br />
Как видите, часть из всех переменных влияют своим значением на то, какие посты будут отобраны. Потому вы можете ими поиграться (поприсваивать различные значения) и выделить самый результативный для вас набор. От сайта к сайту эти значения могут различаться, т.к. статьи пишутся разными людьми и оптимизируются (или вообще не оптимизируются) по разному, потому пробуйте. Но результат игры будет тем заметнее, чем больше статей в блоге, потому если у вас блог молодой, то вам не особо принципиально.</p>
<h2>Применяемые стили<&#47;h2><br />
В виджете похожих статей применено всего пару CSS-стилей, которые вы можете по своему усмотрению использовать и дополнять. Поскольку у меня основная часть стилей берётся из стилей для всего блога, то мне достаточно этого (добавьте в <em>style.css<&#47;em>):<br />
[cce_css]<br />
.related-posts {<br />
	margin:5px 0;<br />
	padding:0;<br />
}<br />
.related-posts .post-description{<br />
	font-size:.9em;<br />
}<br />
[&#47;cce_css]<br />
Где <em>.related-posts<&#47;em> отвечает за весь контейнер, в котором находятся похожие посты, а <em>.post-description<&#47;em> за отображение описательного сниппета для каждого поста. У себя вы можете изменить отображения на свой вкус, например, если понадобится применить другие стили для ссылок, то необходимо будет добавить стиль <em>.related-posts a {}<&#47;em>.</p>
<h2>Вызов функции<&#47;h2><br />
Как вы могли заметить, функция принимает один аргумент: идентификатор поста. Там, где вы будете вызывать эту функцию, необходимо вручную получить и передать идентификатор. Допустим, что вызвать вы её хотите в шаблоне <em>single.php<&#47;em> после статьи. В этом случаем получить идентификатор можно с помощью функции <em>get_the_ID()<&#47;em>:<br />
[cce_html]</p>
<h2>Похожие статьи<&#47;h2><br />
<?php sp_related_posts(get_the_ID()); ?><br />
[&#47;cce_html]<br />
Как видите ничего сложного. И заметьте, что вывод заголовка я не разместил в самой функции, это продиктовано тем, что функция может быть вызвана где угодно и заголовок может быть по разному оформлен (разный текст, разные стили, разные теги) в зависимости от вашего шаблона, потому это я уже оставил на ваше усмотрение.</p>
<p>Все, теперь можете наслаждаться работой этой функции и тешить себя мыслью, что вы избавились еще от одного плагина. Кстати, пример работы функции вы можете поглядеть у меня под статьёй. Теперь немного на сторонние темы.</p>
<h2>Стоп-слова<&#47;h2><br />
Как вы могли заметить, для отсеивания ненужных слов используется массив со стоп-словами, но в нем почему-то нет таких очевидных стоп-слов, как разные союзы, предлоги и др. Это объясняется тем, что минимальная длинна анализируемого слова (переменная <em>$minLengthWord<&#47;em>) равна 3 (по умолчанию). Из этого вытекает, то что всё, что короче 3х символов автоматически выбрасывается и потому в стоп-слова помещаются только то, что имеет в себе 3 или больше символов.</p>
<p>Если вы вдруг захотите уменьшить (или увеличить) минимальное количество символов в анализируемом слове, то вам придётся изменить и массив стоп-слов. Чтобы вам было легче, я предоставлю такой массив для условия, когда минимальное количество символов равно 1. И вы уже будете отталкиваться от него и удалять лишние слова (например если захотите использовать минимальное количество равное 2), тем более что он упорядочен по количеству символов в слове (удалять просто). В противном случае, если вы не удалите лишние, то алгоритм будет работать чуть дольше, чем он бы работал без этих слов, всё таки он это всё сравнивает (344 слова):<br />
[cce_php]<br />
$stopWords = array ('6', '8', '9', '5', '4', '1', '2', '3', '0', '7', 'п', 'ж', 'н', 'м', 'р', 'т', 'ч', 'ц', 'х', 'ф', 'а', 'с', 'д', 'е', 'ё', 'г', 'ш', 'л', 'я', 'в', 'б', 'з', 'щ', 'ы', 'ю', 'у', 'к', 'ь', 'о', 'э', 'и', 'со', 'ну', 'бы', 'да', 'ни', 'до', 'об', 'же', 'за', 'мы', 'их', 'во', 'вы', 'уж', 'по', 'из', 'ли', 'от', 'то', 'но', 'им', 'на', 'ты', 'он', 'не', 'те', 'ко', 'её', 'ей', 'ее', 'они', 'том', 'тот', 'обо', 'она', 'три', 'без', 'ста', 'сто', 'них', 'там', 'тем', 'тут', 'оба', 'той', 'оно', 'под', 'сам', 'чьё', 'эта', 'эти', 'про', 'ней', 'это', 'чье', 'ото', 'ним', 'час', 'при', 'чей', 'чем', 'чья', 'что', 'уже', 'всю', 'ему', 'его', 'для', 'два', 'еще', 'ещё', 'изо', 'ибо', 'нет', 'год', 'где', 'вас', 'вам', 'был', 'вне', 'вот', 'вся', 'всё', 'все', 'или', 'эту', 'мой', 'мог', 'мне', 'так', 'над', 'нам', 'неё', 'нее', 'наш', 'нас', 'кто', 'мои', 'как', 'раз', 'моя', 'буду', 'этой', 'свое', 'тема', 'того', 'темы', 'тему', 'теме', 'твой', 'себе', 'этом', 'чуть', 'тебя', 'чтоб', 'куда', 'свою', 'чего', 'хотя', 'хоть', 'часу', 'этот', 'тоже', 'меня', 'могу', 'либо', 'ином', 'иной', 'надо', 'него', 'пять', 'сами', 'оный', 'один', 'ноль', 'есть', 'если', 'быть', 'ведь', 'было', 'были', 'была', 'весь', 'вниз', 'день', 'даже', 'всех', 'всей', 'свой', 'лишь', 'себя', 'семь', 'стал', 'из-за', 'кроме', 'можно', 'какой', 'через', 'таких', 'разве', 'когда', 'лучше', 'какое', 'потом', 'может', 'такою', 'такую', 'такие', 'перед', 'таком', 'также', 'между', 'вдоль', 'много', 'такое', 'точно', 'стали', 'стать', 'будем', 'давай', 'среди', 'всего', 'стала', 'видно', 'тогда', 'внизу', 'давно', 'сразу', 'здесь', 'знать', 'иметь', 'назад', 'зачем', 'таким', 'долго', 'такой', 'будут', 'такая', 'снова', 'тысяч', 'самим', 'опять', 'около', 'чтобы', 'после', 'самой', 'темою', 'будет', 'будто', 'редко', 'шесть', 'самая', 'часто', 'очень', 'темой', 'жизнь', 'самый', 'пусть', 'темам', 'вдруг', 'самым', 'этого', 'прямо', 'некто', 'никто', 'равно', 'какая', 'темах', 'почти', 'более', 'только', 'четыре', 'самому', 'десять', 'вместо', 'будете', 'теперь', 'девять', 'далеко', 'всегда', 'будешь', 'ребята', 'восемь', 'внутри', 'вокруг', 'давать', 'похоже', 'однако', 'иногда', 'такого', 'ничего', 'сказал', 'хорошо', 'нельзя', 'тысячу', 'тысячи', 'темами', 'тысяча', 'такому', 'больше', 'отчего', 'почему', 'потому', 'совсем', 'сейчас', 'другие', 'именно', 'другой', 'нибудь', 'каждым', 'такими', 'другое', 'каждый', 'большой', 'каждому', 'которые', 'конечно', 'человек', 'сначала', 'каждого', 'впрочем', 'кажется', 'никогда', 'сказали', 'сказать', 'недавно', 'сегодня', 'который', 'говорил', 'говорят', 'спасибо', 'говорим', 'другого', 'наконец', 'сказала', 'особенно', 'говорили', 'навсегда', 'говорить', 'которого', 'несколько', 'достаточно', 'пожалуйста');<br />
[&#47;cce_php]<br />
Так же может случится, что вы захотите использовать этот алгоритм для применения на англоязычных сайтах, где весь контент на английском. Для этого вам нужно сменить все стоп-слова на соответствующие. Чтобы вам было легче я предоставлю свой список английских стоп-слов для условия, что минимальная длинна анализируемого слова 1 символ (596 слов):<br />
[cce_php]<br />
$stopWords = array ('6', '8', '9', '5', '4', '1', '2', '3', '0', '7', 'a', 's', 'p', 'o', 'r', 'n', 'j', 'g', 'v', 'b', 'l', 'k', 'q', 'm', 'h', 'e', 'f', 'w', 't', 'd', 'u', 'z', 'i', 'y', 'x', 'c', 'on', 'an', 'to', 'if', 'he', 'ie', 'be', 'et', 'de', 'am', 'th', 'or', 'id', 'im', 've', 'ok', 'oh', 'in', 'at', 'hi', 'as', 'vs', 'it', 'go', 'of', 'is', 'me', 'no', 'un', 'ex', 'up', 'rd', 'qv', 'us', 'do', 'll', 'nd', 'co', 'by', 'we', 're', 'my', 'so', 'eg', 'new', 'but', 'nor', 'not', 'que', 'cry', 'con', 'due', 'one', 'can', 'off', 'per', 'saw', 'old', 'yes', 'yet', 'why', 'see', 'say', 'any', 'put', 'our', 'ask', 'isn', 'com', 'top', 'are', 'non', 'you', 'own', 'ten', 'who', 'now', 'few', 'was', 'edu', 'she', 'etc', 'his', 'sup', 'six', 'may', 'ltd', 'let', 'viz', 'did', 'the', 'how', 'him', 'way', 'its', 'her', 'far', 'sub', 'has', 'too', 'use', 'via', 'all', 'and', 'had', 'got', 'two', 'for', 'inc', 'try', 'get', 'out', 'away', 'full', 'side', 'part', 'thin', 'show', 'back', 'fify', 'fire', 'move', 'call', 'bill', 'zero', 'best', 'well', 'each', 'also', 'even', 'want', 'else', 'find', 'hers', 'done', 'mill', 'made', 'mine', 'both', 'down', 'give', 'took', 'very', 'uses', 'this', 'gone', 'uucp', 'goes', 'hasn', 'hadn', 'wasn', 'went', 'shan', 'aren', 'didn', 'used', 'help', 'here', 'upon', 'unto', 'does', 'fill', 'ever', 'five', 'from', 'thus', 'thru', 'four', 'gets', 'have', 'been', 'into', 'says', 'name', 'much', 'look', 'know', 'must', 'near', 'like', 'self', 'they', 'mean', 'many', 'most', 'over', 'than', 'them', 'able', 'ours', 'then', 'take', 'plus', 'tell', 'once', 'onto', 'okay', 'that', 'were', 'only', 'more', 'ones', 'when', 'what', 'whom', 'will', 'need', 'last', 'wish', 'with', 'seem', 'your', 'come', 'cant', 'came', 'same', 'just', 'next', 'kept', 'sure', 'nine', 'seen', 'sent', 'lest', 'less', 'some', 'keep', 'none', 'said', 'such', 'soon', 'doing', 'often', 'eight', 'first', 'aside', 'below', 'inner', 'given', 'liked', 'hence', 'going', 'later', 'could', 'about', 'apart', 'needs', 'every', 'fifth', 'hello', 'might', 'alone', 'allow', 'comes', 'along', 'keeps', 'mustn', 'weren', 'among', 'doesn', 'haven', 'again', 'noone', 'forth', 'looks', 'after', 'brief', 'cause', 'gives', 'known', 'knows', 'novel', 'other', 'tries', 'three', 'hasnt', 'thank', 'found', 'their', 'forty', 'seems', 'seven', 'until', 'right', 'front', 'those', 'sixty', 'think', 'these', 'third', 'empty', 'there', 'tried', 'quite', 'above', 'thanx', 'which', 'thats', 'under', 'whose', 'twice', 'tends', 'where', 'ought', 'never', 'least', 'being', 'maybe', 'taken', 'would', 'shall', 'still', 'sorry', 'value', 'using', 'wants', 'yours', 'whole', 'while', 'truly', 'since', 'myself', 'saying', 'mostly', 'namely', 'nearly', 'second', 'always', 'little', 'mainly', 'really', 'likely', 'twenty', 'seeing', 'anyhow', 'selves', 'twelve', 'others', 'anyone', 'latter', 'almost', 'system', 'should', 'couldn', 'wouldn', 'itself', 'thickv', 'rather', 'thanks', 'seemed', 'placed', 'lately', 'please', 'anyway', 'inward', 'merely', 'either', 'asking', 'across', 'around', 'though', 'beside', 'within', 'wonder', 'course', 'detail', 'hardly', 'having', 'hither', 'hereby', 'toward', 'gotten', 'appear', 'thence', 'trying', 'nobody', 'theirs', 'causes', 'herein', 'during', 'become', 'indeed', 'unless', 'theres', 'better', 'enough', 'allows', 'before', 'former', 'behind', 'bottom', 'cannot', 'beyond', 'amount', 'became', 'whence', 'useful', 'except', 'eleven', 'instead', 'ignored', 'insofar', 'somehow', 'towards', 'happens', 'thereby', 'anyways', 'example', 'however', 'therein', 'howbeit', 'sincere', 'getting', 'several', 'further', 'looking', 'serious', 'shouldn', 'someone', 'hundred', 'anybody', 'follows', 'awfully', 'exactly', 'because', 'various', 'becomes', 'seeming', 'whether', 'welcome', 'contain', 'outside', 'already', 'couldnt', 'without', 'nowhere', 'another', 'overall', 'perhaps', 'regards', 'against', 'amongst', 'despite', 'neither', 'fifteen', 'willing', 'wherein', 'herself', 'usually', 'certain', 'himself', 'whoever', 'through', 'specify', 'besides', 'between', 'whereby', 'clearly', 'changes', 'whereas', 'nothing', 'whither', 'believe', 'followed', 'whatever', 'whenever', 'somebody', 'probably', 'sometime', 'amoungst', 'everyone', 'consider', 'normally', 'inasmuch', 'entirely', 'provides', 'contains', 'wherever', 'possible', 'yourself', 'anywhere', 'formerly', 'sensible', 'describe', 'anything', 'interest', 'somewhat', 'becoming', 'together', 'although', 'indicate', 'actually', 'hereupon', 'secondly', 'thorough', 'latterly', 'moreover', 'unlikely', 'ourselves', 'following', 'whereupon', 'immediate', 'certainly', 'currently', 'hereafter', 'specified', 'described', 'greetings', 'available', 'indicates', 'therefore', 'indicated', 'hopefully', 'seriously', 'necessary', 'otherwise', 'somewhere', 'everybody', 'obviously', 'regarding', 'sometimes', 'meanwhile', 'elsewhere', 'downwards', 'different', 'something', 'according', 'thereupon', 'definitely', 'associated', 'everything', 'concerning', 'especially', 'whereafter', 'relatively', 'yourselves', 'beforehand', 'particular', 'containing', 'presumably', 'thoroughly', 'thereafter', 'everywhere', 'regardless', 'throughout', 'afterwards', 'reasonably', 'appreciate', 'specifying', 'themselves', 'furthermore', 'appropriate', 'considering', 'accordingly', 'particularly', 'respectively', 'consequently', 'nevertheless', 'corresponding', 'unfortunately')<br />
[&#47;cce_php]<br />
Для других языков вам уже придётся составлять самим, извините. И если вы и правда их будете составлять, то я прошу скидывать свои варианты списков стоп-слов как русски, так и любых других языков. Всё таки я не претендую на то, что мои списки исчерпывающие. Так что не стесняйтесь и скидывайте свои варианты в комментарии.</p>
<h2>Примечание<&#47;h2><br />
Если у вас плохой хостинг, то функция может не сработать. Ведь для того, чтобы она работала нужно, чтобы работали функции <em>mb_substr()<&#47;em>, <em>mb_strlen()<&#47;em> и другие функции <em>mb_<&#47;em>. А они работают только если ваш PHP поддерживает библиотеку <em>mbstring<&#47;em>, которая предоставляет функции для работы с мультибайтовыми строками. Обычно, эта библиотека везде подключена, но ваш хостер может оказаться недобросовестным и по умолчанию у него она может быть выключена. Вы можете написать в поддержку и попросить её включить, думаю вам пойдут на встречу. А если вы сами имеете доступ к <em>php.ini<&#47;em>, то просто раскомментируйте или допишите (если нет) строку <em>extension = php_mbstring.dll<&#47;em>.</p>
<p>И еще раз напоминаю, что алгоритм будет работать лучше в хорошо оптимизированных под конкретный запрос статьях, нежели в сумбурной писанине с применением нецензурной лексики.</p>
<blockquote><p>
Любая помощь по данному коду (вопросы, установка, доработка и т.д.)<strong> являются платными услугами<&#47;strong>. Пишите через форму обратной связи, если готовы оплатить мою работу. Если вопрос нет, то берём и устанавливаем &ndash; благо, я всё дал и разжевал.<br />
<&#47;blockquote></p>
<p>На этом у меня всё, если будут вопросы, пожелания или предложения, то прошу в комментарии. Рад буду обсудить своё поделие. Всем удачи!</p>

---
layout: post
status: publish
published: true
title: HTML5 - предзагрузка
author:
  display_name: SlowProg
  login: seoadmin
  email: paperplanesu@rambler.ru
  url: http://paperplane.su
author_login: seoadmin
author_email: paperplanesu@rambler.ru
author_url: http://paperplane.su
wordpress_id: 1327
wordpress_url: http://paperplane.su/?p=1327
date: '2012-05-31 20:25:51 +0400'
date_gmt: '2012-05-31 16:25:51 +0400'
categories:
- Мастерская
tags:
- ускорение
- предзагрузка
comments:
- id: 94162
  author: Александр Маврин
  author_email: keeper888@hotmail.com
  author_url: http://serblog.ru/
  date: '2012-10-09 04:25:18 +0400'
  date_gmt: '2012-10-09 00:25:18 +0400'
  content: Хорошая идея. Спасибо.
- id: 131690
  author: Лилия
  author_email: po4ta@po4ta.ug
  author_url: ''
  date: '2013-01-01 00:38:27 +0400'
  date_gmt: '2012-12-31 20:38:27 +0400'
  content: Оставьте мой кеш в покое.
- id: 150299
  author: Danas
  author_email: lggbzhsuxe@gmail.com
  author_url: http://news-portalka.ru/
  date: '2013-04-27 00:51:25 +0400'
  date_gmt: '2013-04-26 20:51:25 +0400'
  content: Была бы я автором - писала бы аналогично. Доходчиво
- id: 241988
  author: smbv
  author_email: hello@sambuev.com
  author_url: ''
  date: '2014-11-15 13:32:47 +0300'
  date_gmt: '2014-11-15 09:32:47 +0300'
  content: Можно ли подружать сразу несколько страниц? Например 5 страниц?
- id: 242351
  author: SlowProg
  author_email: paperplanesu@rambler.ru
  author_url: http://paperplane.su
  date: '2014-11-18 16:16:39 +0300'
  date_gmt: '2014-11-18 12:16:39 +0300'
  content: Думаю да, но как мне кажется эффективнее подгружать не страницы целиком,
    а именно связанные стили и скрипты, которые используются на многих страницах сайта,
    чтобы за раз все необходимые файлы закешировать, а потом только html с сервера
    гонять и всё.
- id: 274031
  author: Антон
  author_email: polunin-site@mail.ru
  author_url: http://web-brothers.ru
  date: '2016-04-29 11:37:28 +0300'
  date_gmt: '2016-04-29 07:37:28 +0300'
  content: "Для дозагрузки бекграундов из css можно использовать тег  как ссылку с
    атрибутами rel=&rsquo;prefetch&rsquo;.  А затем поместить его внутри  и . \r\n\r\nНапример
    \r\n\r\n\r\n\r\nИли мета\r\n<meta content=\"; rel=prefetch\" http-equiv=\"Link\"&#47;>"
- id: 274032
  author: Антон
  author_email: polunin-site@mail.ru
  author_url: http://web-brothers.ru
  date: '2016-04-29 11:41:58 +0300'
  date_gmt: '2016-04-29 07:41:58 +0300'
  content: "Если нужно загрузить картинку из css, например background-image то нужно
    \ использовать тег link как ссылку с атрибутами rel=&rsquo;prefetch&rsquo; и href.
    \ Поместить его внутри тегов head и &#47;head .\r\n\r\nНапример\r\n<code><link
    href=\"http:&#47;&#47;www.example.com&#47;page1\" rel=\"prefetch\" &#47;><&#47;code>\r\n<code><link
    href=\"&#47;images&#47;big.jpeg\" rel=\"prefetch\" &#47;><&#47;code>\r\n\r\nИли
    мета\r\n<code> <meta content=\"<&#47;images&#47;big.jpeg>; rel=prefetch\" http-equiv=\"Link\"&#47;><&#47;code>\r\n\r\nПрошу
    удалить предыдущую запись."
---
<p><a href="http:&#47;&#47;image.paperplane.su&#47;2012&#47;05&#47;prefetch.png"><img class="alignleft size-medium wp-image-2529" title="Предзагрузка" src="http:&#47;&#47;image.paperplane.su&#47;2012&#47;05&#47;prefetch-289x300.png" alt="Предзагрузка" width="289" height="300" &#47;><&#47;a> Сегодня мы поговорим об одной замечательной возможности HTML5 о предварительной загрузке или просто <strong>о предзагрузке<&#47;strong>. Что же это такое? Эта функция указывает браузеру какие документы (страницы, файлы стилей, картинки и др.) загружать к себе в кэш до того, как их запросит пользователь, чтобы предугадать его действия. Если предугаданные страницы и изображения будут открыты пользователем, то они мгновенно подгрузяться из кэша, что для пользователя не будет даже заметно. И конечный результат этого всего, то что у пользователя создастся впечатление мгновенной загрузки всех ресурсов.</p>
<p>Так как время загрузки страниц сайта является важным фактором, указывающим на его качество, предварительная загрузка может в значительной степени повлиять на мнение пользователей о сайте. Если сайт будет "летать" в глаза пользователя, то он будет очень доволен и соответственно наоборот. Но с этим следует быть осторожным и все ресурсы страницы одновременно пихать в кэш не лучшее решение.</p>
<h2>Как сделать предзагрузку<&#47;h2><br />
Сделать предзагрузку у себя на странице очень легко. Все, что вам нужно это использовать
<link> с атрибутами <em>rel='prefetch'<&#47;em> и <em>href<&#47;em>. А поместить все это нужно между тегами <em><head><&#47;em> и <em><&#47;head><&#47;em>&nbsp;в заголовке страницы. В случаи предзагрузки страницы выглядеть это должно примерно так:<br />
[cce lang="xml"]
<link rel="prefetch" href="http:&#47;&#47;example.com&#47;page1" &#47;>[&#47;cce]<br />
А предварительная загрузка изображения примерно так:<br />
[cce lang="xml"]
<link rel="prefetch" href="http:&#47;&#47;example.com&#47;images&#47;image.jpg" &#47;>[&#47;cce]</p>
<h2>Поддерживаемые браузеры<&#47;h2><br />
Хотя предварительная загрузка и является простой и очевидной функцией, но далеко не каждый веб-браузер ее поддерживает на данный момент:</p>
<ul>
<li><strong>iCab<&#47;strong> полностью поддерживает<&#47;li>
<li><strong>Mozilla Firefox<&#47;strong> полностью поддерживает<&#47;li>
<li><strong>Google Chrome<&#47;strong> поддерживает начиная с 13 версии (используется альтернативный синтаксис)<&#47;li>
<li><strong>Internet Explorer<&#47;strong>: поддерживает начиная с 9 версии<&#47;li>
<li><strong>Safari<&#47;strong> не поддерживает<&#47;li>
<li><strong>Opera<&#47;strong> не поддерживает<&#47;li><br />
<&#47;ul><br />
И хоть пока предварительную загрузку поддерживают не все браузеры, использовать ее безусловно необходимо, если это требуется на вашем сайте. Кроме того, если посетитель зашел с браузера, который не поддерживает предзагрузку, то ничего плохого не произойдет. Так что в этом смысле бояться нечего, предзагрузка никому не навредит, если браузер ее не понимает.</p>
<p>А что же на счет Google Chrome? Как я ранее упомянул, у него используется альтернативный атрибут для указания предзагрузки: вместо <em>prefetch<&#47;em> необходимо писать <em>prerender<&#47;em>. Это означает, что для охвата всех браузеров необходимо писать примерно так:<br />
[cce lang="xml"]
<link rel="prefetch" href="http:&#47;&#47;example.com&#47;page1" &#47;>
<link rel="prerender" href="http:&#47;&#47;example.com&#47;page1" &#47;> <!-- Chrome -->[&#47;cce]<br />
Но это не очень универсальный метод. Можно уменьшить количество кода объединив содержимое атрибута следующим образом:<br />
[cce lang="xml"]
<link rel="prefetch prerender" href="http:&#47;&#47;example.com&#47;page1" &#47;>[&#47;cce]</p>
<h2>Примеры использования предзагрузки<&#47;h2><br />
Использование предзагрузки, как я уже упоминал, подходит не везде. Необходимо точно уметь предугадывать поведение пользователя и направлять в кэш только то, что необходимо. В противном случаи, если предварительная загрузка будет использоваться без повода, то это повысит нагрузку на сервер без какого-либо результата для вас. Но есть некоторый классы задач, где предугадать поведение пользователя довольно просто:</p>
<ul>
<li><strong>Предзагрузка последовательности страниц<&#47;strong>, по которым пользователь обязательно будет идти без отклонений. Пример тому может быть форма заказа разбитая на несколько шагов или слайдшоу, где подгружаются одно изображение за другим.<&#47;li>
<li><strong>Предзагрузка страницах с пагинация<&#47;strong>. Примерами тому могут быть страницы поиска на сайтах, длинные посты разбитые на несколько страниц, огромные списки пользователей и др.<&#47;li>
<li><strong>Предзагрузка изображений, файлов CSS и JavaScript<&#47;strong>, которые будут использоваться на следующих страницах, особенно если они значительных размеров. Например, нынче целые сайты делают на основе JS и файлы со скриптами получаются огромных размеров, вот такие файлы можно пускать на предзагрузку.<&#47;li><br />
<&#47;ul></p>
<h2>Предзагрузка в WordPress<&#47;h2><br />
Поскольку движок WordPress является сильно распространенным, то парочка решений для него думаю будет актуально. И стоит помнить, что куда попало пихать предзагрузку не надо.</p>
<p>Первое, что приходит в голову это предзагрузка для фотоблогов, где присутствуют бесконечные галереи с фотографиями. И суть в том, чтобы когда очередная страница загружается указать для предзагрузки все вложения (аттачи) в полном размере (или какой у вас там отображается в галереях). Затем, когда пользователь нажмет на одну из миниатюр увеличенное изображение появится практически мгновенно. На самом деле это подойдет не только для галерей, но и для любой другой страницы, где полный размер картинок скорее всего будут просматривать.&nbsp;Чтобы это реализовать необходимо в <em>header.php<&#47;em> разместить следующий код:<br />
[cce lang="php"]<?php<br />
&#47;&#47; если это страница с отдельной статей, то<br />
if(is_single()){<br />
	&#47;&#47; формируем массив для получения аттачей<br />
	$args = array( 'post_type' => 'attachment', 'numberposts' => -1, 'post_status' => null, 'post_parent' => $myId, 'order' => 'ASC' );<br />
	&#47;&#47; получаем аттачи<br />
	$attachments = get_posts($args);<br />
	&#47;&#47; если аттачи нашлись, то<br />
	if ($attachments){<br />
		&#47;&#47; перебираем все аттачи в цикле и для каждого формируем тег
<link>
		foreach ( $attachments as $attachment ){<br />
			echo "
<link rel='prefetch prerender' href='".$attachment->guid."' &#47;>";<br />
		}<br />
	}<br />
}?>[&#47;cce]<br />
Так же предзагрузка пригодится для архивов. Когда пользователь просматривает один архив за другим, то предугадать его поведение можно. И например, если посетитель уже просматривает вторую страницу архива, то скорее всего он перейдет на третью и далее. Вот код для обработки этого момента:<br />
[cce lang="php"]<?php if (is_archive() &amp;&amp; ($paged > 1) &amp;&amp; ($paged < $wp_query->max_num_pages)) { ?></p>
<link rel="prerender prefetch next" href="<?php echo get_next_posts_page_link(); ?>" &#47;><br />
<?php } ?>[&#47;cce]<br />
Следующее, что могу посоветовать это сделать предзагрузку для главной страницы, когда открыт пост. Ведь довольно часто пользователь после прочтения статьи идет на главную т.к. почти у всех там расположены анонсы свежих статей. Хотя это спорный момент и все зависит от ресурса, ведь кто-то главную страницу делает статичной и весит туда какой-нибудь вступительный текст. В общем смотрите по обстоятельствам, но код для предзагрузки главной страницы следующий:<br />
[cce lang="php"]<?php if (is_singular()) { ?></p>
<link rel="prefetch prerender" href="<?php bloginfo('home'); ?>"&#47;><br />
<?php } ?>[&#47;cce]<br />
А теперь, если кто хочет добавить все эти возможности к себе в шаблон, я объединю всё в единый код:<br />
[cce lang="php"]<?php if (is_singular()) {<br />
	echo '
<link rel="prefetch prerender" href="'.bloginfo('home').'" &#47;>';<br />
	if(is_single()){<br />
		$args = array( 'post_type' => 'attachment', 'numberposts' => -1, 'post_status' => null, 'post_parent' => $myId, 'order' => 'ASC' );<br />
		$attachments = get_posts($args);<br />
		if ($attachments){<br />
			foreach ( $attachments as $attachment ){<br />
				echo "
<link rel='prefetch prerender' href='".$attachment->guid."' &#47;>";<br />
			}<br />
		}<br />
	}<br />
}  elseif (is_archive() &amp;&amp; ($paged > 1) &amp;&amp; ($paged < $wp_query->max_num_pages)) {<br />
	echo '
<link rel="prerender prefetch next" href="'.get_next_posts_page_link().'" &#47;>';<br />
}<br />
?>[&#47;cce]<br />
Этот код необходимо разместить в <em>header.php<&#47;em>, но думаю это вы уже уяснили. Правда на самом деле, я не рекомендую использовать объединенный код, т.к. очевидно, что никто не будет&nbsp;посещать&nbsp;весь сайт&nbsp;в один присест. Обычно возвращаются позже и смотрят другие посты. И получится, что вместо ускорения загрузки страниц вы просто увеличите нагрузку на свой сервер. Я вам рекомендую использовать аналитику и статистику, с помощью которых можно отследить пути брожения пользователей по сайту и с большей долей вероятности предсказать куда пойдут будущие посетители.</p>
<p>На этом у меня все. Надеюсь эта информация вам пригодится. Если у вас есть какие-то предложения или замечания по поводу предзагрузки, то я их выслушаю в комментариях. И вообще, что вы думаете по этому поводу, для HTML5 это нужная функция? Жду ваших мнений. Всем стремительной загрузки!</p>
<p>А если делать самому сайт невмоготу, то существует <a href="http:&#47;&#47;lowcostos.ru&#47;interesnoe&#47;interesnoe-2&#47;kak-sdelat-besplatnyy-sayt&#47;" title="Конструктор сайтов" target="_blank">конструктор сайтов<&#47;a>, который очень прост в использовании, удобен и не требует богатых познаний. Теперь каждый желающий сможет за считанные часы создать свой собственный сайт.</p>
